const IMG_DIM=512;let loaded=!1;(async()=>{let a=new FontFace("Bree Serif","url(/static/font/BreeSerif-Regular.ttf)");self.fonts&&fonts.add(a),await a.load(),a=new FontFace("Lato","url(/static/font/Lato-Bold.ttf)"),self.fonts&&fonts.add(a),await a.load(),loaded=!0})(),onmessage=async a=>{if(!loaded)return setTimeout(()=>onmessage(a),3e3);const{data:b}=a;if(!b)return;let c;try{const a=new OffscreenCanvas(0,500),d=a.getContext("2d");d.font="bold 320px Lato",d.fillStyle="white",d.strokeStyle="black",d.textAlign="center",d.lineWidth=26,d.textBaseline="middle";const e=d.measureText(b.name);e.width&&(a.width=Math.ceil(e.width+40),d.font="bold 320px Lato",d.fillStyle="white",d.strokeStyle="black",d.textAlign="center",d.lineWidth=26,d.textBaseline="middle",d.clearRect(0,0,a.width,a.height),d.strokeText(b.name,a.width>>1,a.height>>1),d.fillText(b.name,a.width>>1,a.height>>1),c=a.transferToImageBitmap())}catch(a){console.error(b,a)}try{if(!/https?:\/\//.test(b.skin)&&"/static/img/virus.png"!=b.skin)throw new Error("Invalid skin");const a=await fetch(b.skin),d=await a.blob(),e=await createImageBitmap(d,{premultiplyAlpha:"none",resizeQuality:"high",resizeWidth:IMG_DIM,resizeHeight:IMG_DIM});postMessage({id:b.id,skin:e,name:c},c?[e,c]:[e])}catch(a){console.log(`Failed to load skin: "${b.skin}" (pid: ${b.id})`),postMessage({id:b.id,skin:null,name:c})}};