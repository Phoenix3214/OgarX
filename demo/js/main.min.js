(function(){function b(d,e,g){function a(j,i){if(!e[j]){if(!d[j]){var f="function"==typeof require&&require;if(!i&&f)return f(j,!0);if(h)return h(j,!0);var c=new Error("Cannot find module '"+j+"'");throw c.code="MODULE_NOT_FOUND",c}var k=e[j]={exports:{}};d[j][0].call(k.exports,function(b){var c=d[j][1][b];return a(c||b)},k,k.exports,b,d,e,g)}return e[j].exports}for(var h="function"==typeof require&&require,c=0;c<g.length;c++)a(g[c]);return a}return b})()({1:[function(require,module,exports){const Mouse=require("./mouse"),State=require("./state"),Viewport=require("./viewport"),Keyboard=require("./keyboard");module.exports=class{constructor(){if(this.canvas=document.getElementById("canvas"),this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight,this.showing=!0,this.mouse=new Mouse,this.state=new State,this.viewport=new Viewport,navigator.userAgent.includes("Chrome")){this.worker=new Worker("js/renderer.min.js");const a=this.canvas.transferControlToOffscreen(),b={offscreen:a,mouse:this.mouse.sharedBuffer,state:this.state.sharedBuffer,viewport:this.viewport.sharedBuffer};this.worker.postMessage(b,[a]),this.worker.onmessage=a=>{const{data:b}=a;"ready"===b.event&&(this.ready=!0),"chat"===b.event&&this.onChat(b.pid,b.player,b.message),"leaderboard"===b.event&&this.onLeaderboard(b.lb)},this.registerEvents(),this.resize(),this.initUIComponents()}else navigator.userAgent.includes("Firefox")&&fetch("js/renderer.min.js").then(a=>a.text()).then(code=>{eval(code),this.renderer=new Renderer(this.canvas),this.renderer.mouse=this.mouse,this.renderer.state=this.state,this.renderer.viewport=this.viewport}).then(()=>this.renderer.initEngine()).then(()=>{this.registerEvents(),this.resize(),this.initUIComponents()})}show(a=this.hudElem){a.focus(),a.style.opacity=1,a.style.zIndex=1}hide(a=this.hudElem){a.blur(),a.style.opacity=0,setTimeout(()=>a.style.zIndex=0,250)}toggle(a=this.hudElem){1==a.style.opacity?this.hide(a):this.show(a)}resize(){this.viewport.width=window.devicePixelRatio*window.innerWidth,this.viewport.height=window.devicePixelRatio*window.innerHeight,this.canvas.style.width=window.innerWidth,this.canvas.style.height=window.innerHeight}registerEvents(){window.onresize=this.resize.bind(this),this.keys=new Keyboard(this),this.pressing=new Set;const a=this.state;window.addEventListener("keydown",a=>{"Tab"==a.key&&a.preventDefault(),"Escape"==a.key&&this.toggle(),"Enter"==a.key&&this.toggle(this.chatInput);this.pressing.has(a.key)||(this.keys.keyDown(a.key),this.pressing.add(a.key))}),window.addEventListener("keyup",a=>{this.keys.keyUp(a.key),this.pressing.delete(a.key)}),window.addEventListener("blur",()=>a.focused=0),window.addEventListener("focus",()=>a.focused=1),a.focused=1,canvas.addEventListener("mousemove",a=>(this.mouse.x=a.clientX,this.mouse.y=a.clientY)),canvas.addEventListener("wheel",a=>this.mouse.updateScroll(a.deltaY),{passive:!0})}initUIComponents(){this.hudElem=document.getElementById("hud"),this.skinElem=document.getElementById("skin"),this.skinInput=document.getElementById("skin-input"),this.serverInput=document.getElementById("server-input"),this.nameInput=document.getElementById("name-input");const a=(a=!1)=>{const b=new Image;b.onload=()=>{this.skinInput.classList.remove("danger"),this.skinElem.src=this.skin},a||(b.onerror=()=>this.skinInput.classList.add("danger")),b.src=this.skin};this.skinInput.addEventListener("blur",a),this.connectButton=document.getElementById("connect"),this.connectButton.addEventListener("click",()=>{this.spawn(),this.hide(),this.connectButton.blur()}),this.chatElem=document.getElementById("chat"),this.chatInput=document.getElementById("chat-input"),this.chatInput.addEventListener("keydown",a=>{if(a.stopPropagation(),"Enter"==a.key){const a=this.chatInput.value.trim();a&&(this.sendChat(a),this.chatInput.value=""),this.hide(this.chatInput),this.canvas.focus()}}),this.chatElem.addEventListener("focus",()=>{this.chatElem.blur(),this.canvas.focus()}),this.chatElem.addEventListener("wheel",a=>a.stopPropagation(),{passive:!0}),this.serverInput.value=localStorage.getItem("ogarx_server")||window.origin.replace("http","ws")+":3000",this.nameInput.value=localStorage.getItem("ogarx_name")||"",this.skinInput.value=localStorage.getItem("ogarx_skin")||"",a(!0),this.chatInput.addEventListener("blur",()=>this.hide(this.chatInput)),this.lbElem=document.getElementById("leaderboard-data")}sendChat(a){this.worker&&this.worker.postMessage({chat:a})}onChat(a,b,c){const d=document.createElement("p");d.textContent=a?`${b.name||"Unnamed"}: ${c}`:c,d.classList.add(`player-${a}`),this.chatElem.appendChild(d),this.chatElem.scrollTo(0,this.chatElem.scrollHeight)}onLeaderboard(a){const{players:b,rank:c,me:d}=a;for(const d in this.lbElem.innerHTML="",b){const a=document.createElement("p");a.textContent=`${~~d+1}. ${b[d]?b[d].name:""}`,d==c&&a.classList.add("me"),this.lbElem.appendChild(a)}if(!b[c]){const a=document.createElement("p");a.textContent=`${c+1}. ${d.name||""}`,a.classList.add("me"),this.lbElem.appendChild(a)}}get skin(){return this.skinInput.value}get name(){return this.nameInput.value}get server(){return this.serverInput.value}spawn(){const a=this.server,b=this.name,c=this.skin;if("local"==a?this.connectToLocal():this.connectToURL(a),localStorage.setItem("ogarx_server",a),localStorage.setItem("ogarx_name",b),localStorage.setItem("ogarx_skin",c),this.worker)this.worker.postMessage({spawn:!0,name:b,skin:c});else{const a=this.renderer.protocol;a.once("open",()=>a.spawn(b,c))}}connectToLocal(){const a=new SharedWorker("js/sw.min.js","ogar-x-server");this.worker?this.worker.postMessage({connect:a.port,name:this.name,skin:this.skin},[a.port]):this.renderer.protocol.connect(a.port,this.name,this.skin)}connectToURL(a){this.worker?this.worker.postMessage({connect:a,name:this.name,skin:this.skin}):this.renderer.protocol.connect(a,this.name,this.skin)}}},{"./keyboard":2,"./mouse":4,"./state":5,"./viewport":6}],2:[function(a,b){const c=["Feed","Split","Double Split","Triple Split","Quad Split","Respawn"],d={" ":"SPACE"};b.exports=class{constructor(a){this.hud=a;try{const a=JSON.parse(localStorage.getItem("ogarx-keys"));if(!Array.isArray(a)||a.length!=c.length||!a.every(a=>"string"==typeof a))throw new Error("Error parsing keybinds, resetting");this.keys=a}catch(a){console.error(a),this.keys=["w"," ","g","z","q","n"]}this.menuElem=document.getElementById("key-menu"),this.openElem=document.getElementById("keyboard"),this.openElem.addEventListener("click",()=>{this.openElem.style.opacity=0,this.hud.toggle(this.menuElem),this.menuElem.style.left="0px"}),this.closeElem=document.getElementById("close-key-menu"),this.closeElem.addEventListener("click",()=>{this.openElem.style.opacity=1,this.hud.toggle(this.menuElem),this.menuElem.style.left="-200px"}),this.updateKeys(),this.save()}save(){localStorage.setItem("ogarx-keys",JSON.stringify(this.keys))}updateKeys(){const a=document.getElementById("keys");for(const e in a.innerHTML="",this.labels=[],c){const f=document.createElement("h4"),g=this.keys[e].toUpperCase();f.textContent=`${c[e]}: `;const h=document.createElement("b");h.innerText=(d[g]||g).toUpperCase(),h.classList.add("hot-key"),f.appendChild(h),a.appendChild(f),this.labels.push(h),h.addEventListener("mouseenter",()=>{this.hovered=h}),h.addEventListener("mouseleave",()=>{this.hovered=null})}}keyDown(a=""){if(this.hovered){const b=this.labels.indexOf(this.hovered);this.hovered.innerText=(d[a]||a).toUpperCase(),this.keys[b]=a,this.save()}const b=c[this.keys.indexOf(a)];if(b){const a=this.hud.state;"Feed"===b?a.macro=1:"Split"===b?a.splits=1:"Double Split"===b?a.splits=2:"Triple Split"===b?a.splits=3:"Quad Split"===b?a.splits=4:"Respawn"===b?a.respawn=1:void 0}}keyUp(a=""){const b=c[this.keys.indexOf(a)];if(b){const a=this.hud.state;"Feed"===b?a.macro=0:void 0}}}},{}],3:[function(a){const b=a("./hud");window.onload=()=>window.app=new b},{"./hud":1}],4:[function(a,b){b.exports=class{constructor(){this.setBuffer()}setBuffer(a){a||(self.SharedArrayBuffer?a=new SharedArrayBuffer(12):a=new ArrayBuffer(12)),this.sharedBuffer=a,this.buffer=new Int32Array(this.sharedBuffer)}get x(){return Atomics.load(this.buffer,0)}set x(a){Atomics.store(this.buffer,0,a)}get y(){return Atomics.load(this.buffer,1)}set y(a){Atomics.store(this.buffer,1,a)}get scroll(){return Atomics.load(this.buffer,2)}set scroll(a){Atomics.store(this.buffer,2,a)}updateScroll(a){Atomics.add(this.buffer,2,a)}resetScroll(){return Atomics.exchange(this.buffer,2,0)}}},{}],5:[function(a,b){b.exports=class{constructor(){this.setBuffer()}setBuffer(a){a||(self.SharedArrayBuffer?a=new SharedArrayBuffer(6):a=new ArrayBuffer(6)),this.sharedBuffer=a,this.buffer=new Uint8Array(this.sharedBuffer)}get spectate(){return Atomics.load(this.buffer,0)}set spectate(a){Atomics.store(this.buffer,0,a)}get splits(){return Atomics.load(this.buffer,1)}set splits(a){Atomics.add(this.buffer,1,a)}get ejects(){return Atomics.load(this.buffer,2)}set ejects(a){Atomics.add(this.buffer,2,a)}get macro(){return Atomics.load(this.buffer,3)}set macro(a){Atomics.store(this.buffer,3,a)}get respawn(){return Atomics.load(this.buffer,4)}set respawn(a){Atomics.store(this.buffer,4,a)}get focused(){return Atomics.load(this.buffer,5)}set focused(a){Atomics.store(this.buffer,5,a)}exchange(){return{spectate:Atomics.exchange(this.buffer,0,0),splits:Atomics.exchange(this.buffer,1,0),ejects:Atomics.exchange(this.buffer,2,0),macro:this.macro,respawn:Atomics.exchange(this.buffer,4,0)}}}},{}],6:[function(a,b){b.exports=class{constructor(){this.setBuffer()}setBuffer(a){a||(self.SharedArrayBuffer?a=new SharedArrayBuffer(8):a=new ArrayBuffer(8)),this.sharedBuffer=a,this.buffer=new Int32Array(this.sharedBuffer)}get width(){return Atomics.load(this.buffer,0)}set width(a){Atomics.store(this.buffer,0,a)}get height(){return Atomics.load(this.buffer,1)}set height(a){Atomics.store(this.buffer,1,a)}}},{}]},{},[3]);