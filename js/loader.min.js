let loaded=!1;(async()=>{const a=new FontFace("Lato","url(/static/font/Lato-Bold.ttf)");fonts.add(a),await a.load(),loaded=!0})(),onmessage=async a=>{var b=Math.ceil;if(!loaded)return setTimeout(()=>onmessage(a),3e3);const{data:c}=a;if(c&&c.id){if(c.name)try{const a=new OffscreenCanvas(0,500),d=a.getContext("2d");d.font="bold 320px Lato",d.fillStyle="white",d.strokeStyle="black",d.textAlign="center",d.lineWidth=26,d.textBaseline="middle";const e=d.measureText(c.name);if(e.width){a.width=b(e.width+40),d.font="bold 320px Lato",d.fillStyle="white",d.strokeStyle="black",d.textAlign="center",d.lineWidth=26,d.textBaseline="middle",d.clearRect(0,0,a.width,a.height),d.strokeText(c.name,a.width>>1,a.height>>1),d.fillText(c.name,a.width>>1,a.height>>1);const f=a.transferToImageBitmap();self.postMessage({id:c.id,name:f},[f])}}catch(a){console.log(`Failed to load name: "${c.name}" (pid: ${c.id})`,a)}if(c.skin)try{if(!/https?:\/\//.test(c.skin)&&!/^\/static\/img\/virus-\d+.png/.test(c.skin))throw new Error("Invalid skin");const a=await fetch(c.skin),b=await a.blob(),d=await createImageBitmap(b,{premultiplyAlpha:"none",resizeQuality:"high",resizeWidth:c.skin_dim,resizeHeight:c.skin_dim});postMessage({id:c.id,skin:d},[d])}catch(a){console.log(`Failed to load skin: "${c.skin}" (pid: ${c.id})`,a)}}};