(function(){function s(d,e,r){function t(o,i){if(!e[o]){if(!d[o]){var l="function"==typeof require&&require;if(!i&&l)return l(o,!0);if(n)return n(o,!0);var _=new Error("Cannot find module '"+o+"'");throw _.code="MODULE_NOT_FOUND",_}var a=e[o]={exports:{}};d[o][0].call(a.exports,function(e){var a=d[o][1][e];return t(a||e)},a,a.exports,s,d,e,r)}return e[o].exports}for(var n="function"==typeof require&&require,a=0;a<r.length;a++)t(r[a]);return t}return s})()({1:[function(e,t){'use strict';function a(e){console&&console.warn&&console.warn(e)}function r(){r.init.call(this)}function s(e){if("function"!=typeof e)throw new TypeError("The \"listener\" argument must be of type Function. Received type "+typeof e)}function n(e){return void 0===e._maxListeners?r.defaultMaxListeners:e._maxListeners}function i(e,t,r,i){var o,d,l;if(s(r),d=e._events,void 0===d?(d=e._events=Object.create(null),e._eventsCount=0):(void 0!==d.newListener&&(e.emit("newListener",t,r.listener?r.listener:r),d=e._events),l=d[t]),void 0===l)l=d[t]=r,++e._eventsCount;else if("function"==typeof l?l=d[t]=i?[r,l]:[l,r]:i?l.unshift(r):l.push(r),o=n(e),0<o&&l.length>o&&!l.warned){l.warned=!0;var _=new Error("Possible EventEmitter memory leak detected. "+l.length+" "+(t+" listeners added. Use emitter.setMaxListeners() to increase limit"));_.name="MaxListenersExceededWarning",_.emitter=e,_.type=t,_.count=l.length,a(_)}return e}function o(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function d(e,t,a){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:a},s=o.bind(r);return s.listener=a,r.wrapFn=s,s}function l(e,t,a){var r=e._events;if(r===void 0)return[];var s=r[t];return void 0===s?[]:"function"==typeof s?a?[s.listener||s]:[s]:a?p(s):f(s,s.length)}function _(e){var t=this._events;if(t!==void 0){var a=t[e];if("function"==typeof a)return 1;if(void 0!==a)return a.length}return 0}function f(e,t){for(var a=Array(t),r=0;r<t;++r)a[r]=e[r];return a}function u(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}function p(e){for(var t=Array(e.length),a=0;a<t.length;++a)t[a]=e[a].listener||e[a];return t}var c,h="object"==typeof Reflect?Reflect:null,g=h&&"function"==typeof h.apply?h.apply:function(e,t,a){return Function.prototype.apply.call(e,t,a)};c=h&&"function"==typeof h.ownKeys?h.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var m=Number.isNaN||function(e){return e!==e};t.exports=r,t.exports.once=function(e,t){return new Promise(function(a,r){function s(){n!==void 0&&e.removeListener("error",n),a([].slice.call(arguments))}var n;"error"!==t&&(n=function(a){e.removeListener(t,s),r(a)},e.once("error",n)),e.once(t,s)})},r.EventEmitter=r,r.prototype._events=void 0,r.prototype._eventsCount=0,r.prototype._maxListeners=void 0;var b=10;Object.defineProperty(r,"defaultMaxListeners",{enumerable:!0,get:function(){return b},set:function(e){if("number"!=typeof e||0>e||m(e))throw new RangeError("The value of \"defaultMaxListeners\" is out of range. It must be a non-negative number. Received "+e+".");b=e}}),r.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},r.prototype.setMaxListeners=function(e){if("number"!=typeof e||0>e||m(e))throw new RangeError("The value of \"n\" is out of range. It must be a non-negative number. Received "+e+".");return this._maxListeners=e,this},r.prototype.getMaxListeners=function(){return n(this)},r.prototype.emit=function(e){for(var t=[],a=1;a<arguments.length;a++)t.push(arguments[a]);var r="error"===e,s=this._events;if(s!==void 0)r=r&&s.error===void 0;else if(!r)return!1;if(r){var n;if(0<t.length&&(n=t[0]),n instanceof Error)throw n;var o=new Error("Unhandled error."+(n?" ("+n.message+")":""));throw o.context=n,o}var d=s[e];if(d===void 0)return!1;if("function"==typeof d)g(d,this,t);else for(var l=d.length,_=f(d,l),a=0;a<l;++a)g(_[a],this,t);return!0},r.prototype.addListener=function(e,t){return i(this,e,t,!1)},r.prototype.on=r.prototype.addListener,r.prototype.prependListener=function(e,t){return i(this,e,t,!0)},r.prototype.once=function(e,t){return s(t),this.on(e,d(this,e,t)),this},r.prototype.prependOnceListener=function(e,t){return s(t),this.prependListener(e,d(this,e,t)),this},r.prototype.removeListener=function(e,t){var a,r,n,o,d;if(s(t),r=this._events,void 0===r)return this;if(a=r[e],void 0===a)return this;if(a===t||a.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,a.listener||t));else if("function"!=typeof a){for(n=-1,o=a.length-1;0<=o;o--)if(a[o]===t||a[o].listener===t){d=a[o].listener,n=o;break}if(0>n)return this;0===n?a.shift():u(a,n),1===a.length&&(r[e]=a[0]),void 0!==r.removeListener&&this.emit("removeListener",e,d||t)}return this},r.prototype.off=r.prototype.removeListener,r.prototype.removeAllListeners=function(e){var t,a,r;if(a=this._events,void 0===a)return this;if(void 0===a.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==a[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete a[e]),this;if(0===arguments.length){var s,n=Object.keys(a);for(r=0;r<n.length;++r)s=n[r],"removeListener"!==s&&this.removeAllListeners(s);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(t=a[e],"function"==typeof t)this.removeListener(e,t);else if(void 0!==t)for(r=t.length-1;0<=r;r--)this.removeListener(e,t[r]);return this},r.prototype.listeners=function(e){return l(this,e,!0)},r.prototype.rawListeners=function(e){return l(this,e,!1)},r.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):_.call(e,t)},r.prototype.listenerCount=_,r.prototype.eventNames=function(){return 0<this._eventsCount?c(this._events):[]}},{}],2:[function(e,t){'use strict';const{Deflate:a,deflate:r,deflateRaw:s,gzip:n}=e("./lib/deflate"),{Inflate:i,inflate:o,inflateRaw:d,ungzip:l}=e("./lib/inflate"),_=e("./lib/zlib/constants");t.exports.Deflate=a,t.exports.deflate=r,t.exports.deflateRaw=s,t.exports.gzip=n,t.exports.Inflate=i,t.exports.inflate=o,t.exports.inflateRaw=d,t.exports.ungzip=l,t.exports.constants=_},{"./lib/deflate":3,"./lib/inflate":4,"./lib/zlib/constants":8}],3:[function(e,t){'use strict';function a(e){this.options=n.assign({level:g,method:b,chunkSize:16384,windowBits:15,memLevel:8,strategy:m},e||{});let t=this.options;t.raw&&0<t.windowBits?t.windowBits=-t.windowBits:t.gzip&&0<t.windowBits&&16>t.windowBits&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new d,this.strm.avail_out=0;let a=s.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(a!==c)throw new Error(o[a]);if(t.header&&s.deflateSetHeader(this.strm,t.header),t.dictionary){let e;if(e="string"==typeof t.dictionary?i.string2buf(t.dictionary):"[object ArrayBuffer]"===l.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,a=s.deflateSetDictionary(this.strm,e),a!==c)throw new Error(o[a]);this._dict_set=!0}}function r(e,t){const r=new a(t);if(r.push(e,!0),r.err)throw r.msg||o[r.err];return r.result}const s=e("./zlib/deflate"),n=e("./utils/common"),i=e("./utils/strings"),o=e("./zlib/messages"),d=e("./zlib/zstream"),l=Object.prototype.toString,{Z_NO_FLUSH:_,Z_SYNC_FLUSH:f,Z_FULL_FLUSH:u,Z_FINISH:p,Z_OK:c,Z_STREAM_END:h,Z_DEFAULT_COMPRESSION:g,Z_DEFAULT_STRATEGY:m,Z_DEFLATED:b}=e("./zlib/constants");a.prototype.push=function(e,t){const a=this.strm,r=this.options.chunkSize;let n,o;if(this.ended)return!1;for(o=t===~~t?t:!0===t?p:_,a.input="string"==typeof e?i.string2buf(e):"[object ArrayBuffer]"===l.call(e)?new Uint8Array(e):e,a.next_in=0,a.avail_in=a.input.length;;){if(0===a.avail_out&&(a.output=new Uint8Array(r),a.next_out=0,a.avail_out=r),(o===f||o===u)&&6>=a.avail_out){this.onData(a.output.subarray(0,a.next_out)),a.avail_out=0;continue}if(n=s.deflate(a,o),n===h)return 0<a.next_out&&this.onData(a.output.subarray(0,a.next_out)),n=s.deflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===c;if(0===a.avail_out){this.onData(a.output);continue}if(0<o&&0<a.next_out){this.onData(a.output.subarray(0,a.next_out)),a.avail_out=0;continue}if(0===a.avail_in)break}return!0},a.prototype.onData=function(e){this.chunks.push(e)},a.prototype.onEnd=function(e){e===c&&(this.result=n.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},t.exports.Deflate=a,t.exports.deflate=r,t.exports.deflateRaw=function(e,t){return t=t||{},t.raw=!0,r(e,t)},t.exports.gzip=function(e,t){return t=t||{},t.gzip=!0,r(e,t)},t.exports.constants=e("./zlib/constants")},{"./utils/common":5,"./utils/strings":6,"./zlib/constants":8,"./zlib/deflate":10,"./zlib/messages":15,"./zlib/zstream":17}],4:[function(e,t){'use strict';function a(e){this.options=n.assign({chunkSize:65536,windowBits:15,to:""},e||{});const t=this.options;t.raw&&0<=t.windowBits&&16>t.windowBits&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),0<=t.windowBits&&16>t.windowBits&&!(e&&e.windowBits)&&(t.windowBits+=32),15<t.windowBits&&48>t.windowBits&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new d,this.strm.avail_out=0;let a=s.inflateInit2(this.strm,t.windowBits);if(a!==p)throw new Error(o[a]);if(this.header=new l,s.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=i.string2buf(t.dictionary):"[object ArrayBuffer]"===_.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(a=s.inflateSetDictionary(this.strm,t.dictionary),a!==p)))throw new Error(o[a])}function r(e,t){const r=new a(t);if(r.push(e),r.err)throw r.msg||o[r.err];return r.result}const s=e("./zlib/inflate"),n=e("./utils/common"),i=e("./utils/strings"),o=e("./zlib/messages"),d=e("./zlib/zstream"),l=e("./zlib/gzheader"),_=Object.prototype.toString,{Z_NO_FLUSH:f,Z_FINISH:u,Z_OK:p,Z_STREAM_END:c,Z_NEED_DICT:h,Z_STREAM_ERROR:g,Z_DATA_ERROR:m,Z_MEM_ERROR:b}=e("./zlib/constants");a.prototype.push=function(e,t){const a=this.strm,r=this.options.chunkSize,n=this.options.dictionary;let o,d,l;if(this.ended)return!1;for(d=t===~~t?t:!0===t?u:f,a.input="[object ArrayBuffer]"===_.call(e)?new Uint8Array(e):e,a.next_in=0,a.avail_in=a.input.length;;){for(0===a.avail_out&&(a.output=new Uint8Array(r),a.next_out=0,a.avail_out=r),o=s.inflate(a,d),o===h&&n&&(o=s.inflateSetDictionary(a,n),o===p?o=s.inflate(a,d):o===m&&(o=h));0<a.avail_in&&o===c&&0<a.state.wrap&&0!==e[a.next_in];)s.inflateReset(a),o=s.inflate(a,d);switch(o){case g:case m:case h:case b:return this.onEnd(o),this.ended=!0,!1;}if(l=a.avail_out,a.next_out&&(0===a.avail_out||o===c))if("string"===this.options.to){let e=i.utf8border(a.output,a.next_out),t=a.next_out-e,s=i.buf2string(a.output,e);a.next_out=t,a.avail_out=r-t,t&&a.output.set(a.output.subarray(e,e+t),0),this.onData(s)}else this.onData(a.output.length===a.next_out?a.output:a.output.subarray(0,a.next_out));if(o!==p||0!==l){if(o===c)return o=s.inflateEnd(this.strm),this.onEnd(o),this.ended=!0,!0;if(0===a.avail_in)break}}return!0},a.prototype.onData=function(e){this.chunks.push(e)},a.prototype.onEnd=function(e){e===p&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=n.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},t.exports.Inflate=a,t.exports.inflate=r,t.exports.inflateRaw=function(e,t){return t=t||{},t.raw=!0,r(e,t)},t.exports.ungzip=r,t.exports.constants=e("./zlib/constants")},{"./utils/common":5,"./utils/strings":6,"./zlib/constants":8,"./zlib/gzheader":11,"./zlib/inflate":13,"./zlib/messages":15,"./zlib/zstream":17}],5:[function(e,t){'use strict';const a=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);t.exports.assign=function(e){for(const t=Array.prototype.slice.call(arguments,1);t.length;){const r=t.shift();if(r){if("object"!=typeof r)throw new TypeError(r+"must be non-object");for(const t in r)a(r,t)&&(e[t]=r[t])}}return e},t.exports.flattenChunks=e=>{let t=0;for(let a=0,r=e.length;a<r;a++)t+=e[a].length;const a=new Uint8Array(t);for(let t,r=0,s=0,n=e.length;r<n;r++)t=e[r],a.set(t,s),s+=t.length;return a}},{}],6:[function(e,t){'use strict';var a=String.fromCharCode;let r=!0;try{a.apply(null,new Uint8Array(1))}catch(e){r=!1}const s=new Uint8Array(256);for(let a=0;256>a;a++)s[a]=252<=a?6:248<=a?5:240<=a?4:224<=a?3:192<=a?2:1;s[254]=s[254]=1,t.exports.string2buf=e=>{let t,a,r,s,n,o=e.length,d=0;for(s=0;s<o;s++)a=e.charCodeAt(s),55296==(64512&a)&&s+1<o&&(r=e.charCodeAt(s+1),56320==(64512&r)&&(a=65536+(a-55296<<10)+(r-56320),s++)),d+=128>a?1:2048>a?2:65536>a?3:4;for(t=new Uint8Array(d),n=0,s=0;n<d;s++)a=e.charCodeAt(s),55296==(64512&a)&&s+1<o&&(r=e.charCodeAt(s+1),56320==(64512&r)&&(a=65536+(a-55296<<10)+(r-56320),s++)),128>a?t[n++]=a:2048>a?(t[n++]=192|a>>>6,t[n++]=128|63&a):65536>a?(t[n++]=224|a>>>12,t[n++]=128|63&a>>>6,t[n++]=128|63&a):(t[n++]=240|a>>>18,t[n++]=128|63&a>>>12,t[n++]=128|63&a>>>6,t[n++]=128|63&a);return t};const n=(e,t)=>{if(65534>t&&e.subarray&&r)return a.apply(null,e.length===t?e:e.subarray(0,t));let s="";for(let r=0;r<t;r++)s+=a(e[r]);return s};t.exports.buf2string=(e,t)=>{let a,r;const o=t||e.length,d=Array(2*o);for(r=0,a=0;a<o;){let t=e[a++];if(128>t){d[r++]=t;continue}let n=s[t];if(4<n){d[r++]=65533,a+=n-1;continue}for(t&=2===n?31:3===n?15:7;1<n&&a<o;)t=t<<6|63&e[a++],n--;if(1<n){d[r++]=65533;continue}65536>t?d[r++]=t:(t-=65536,d[r++]=55296|1023&t>>10,d[r++]=56320|1023&t)}return n(d,r)},t.exports.utf8border=(e,t)=>{t=t||e.length,t>e.length&&(t=e.length);let a=t-1;for(;0<=a&&128==(192&e[a]);)a--;return 0>a?t:0==a?t:a+s[e[a]]>t?a:t}},{}],7:[function(e,t){'use strict';t.exports=(e,t,a,r)=>{let s=0|65535&e,i=0|65535&e>>>16,o=0;for(;0!==a;){o=2e3<a?2e3:a,a-=o;do s=0|s+t[r++],i=0|i+s;while(--o);s%=65521,i%=65521}return 0|(s|i<<16)}},{}],8:[function(e,t){'use strict';t.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],9:[function(e,t){'use strict';const a=new Uint32Array((()=>{let e,t=[];for(var a=0;256>a;a++){e=a;for(var r=0;8>r;r++)e=1&e?3988292384^e>>>1:e>>>1;t[a]=e}return t})());t.exports=(e,t,r,s)=>{e^=-1;for(let n=s;n<s+r;n++)e=e>>>8^a[255&(e^t[n])];return-1^e}},{}],10:[function(e,t){'use strict';function a(e,t,a,r,s){this.good_length=e,this.max_lazy=t,this.nice_length=a,this.max_chain=r,this.func=s}function r(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=I,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),j(this.dyn_ltree),j(this.dyn_dtree),j(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),j(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),j(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const{_tr_init:n,_tr_stored_block:i,_tr_flush_block:o,_tr_tally:d,_tr_align:l}=e("./trees"),_=e("./adler32"),f=e("./crc32"),u=e("./messages"),{Z_NO_FLUSH:p,Z_PARTIAL_FLUSH:c,Z_FULL_FLUSH:h,Z_FINISH:g,Z_BLOCK:m,Z_OK:b,Z_STREAM_END:E,Z_STREAM_ERROR:w,Z_DATA_ERROR:x,Z_BUF_ERROR:R,Z_DEFAULT_COMPRESSION:T,Z_FILTERED:v,Z_HUFFMAN_ONLY:y,Z_RLE:A,Z_FIXED:S,Z_DEFAULT_STRATEGY:k,Z_UNKNOWN:U,Z_DEFLATED:I}=e("./constants"),D=3,L=258,F=L+D+1,P=42,z=69,C=73,B=91,N=103,O=113,M=666,X=1,Z=2,G=3,H=4,V=(e,t)=>(e.msg=u[t],t),Y=e=>(e<<1)-(4<e?9:0),j=e=>{for(let t=e.length;0<=--t;)e[t]=0};let W=(e,t,a)=>(t<<e.hash_shift^a)&e.hash_mask;const K=e=>{const t=e.state;let a=t.pending;a>e.avail_out&&(a=e.avail_out);0===a||(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+a),e.next_out),e.next_out+=a,t.pending_out+=a,e.total_out+=a,e.avail_out-=a,t.pending-=a,0===t.pending&&(t.pending_out=0))},q=(e,t)=>{o(e,0<=e.block_start?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,K(e.strm)},Q=(e,t)=>{e.pending_buf[e.pending++]=t},J=(e,t)=>{e.pending_buf[e.pending++]=255&t>>>8,e.pending_buf[e.pending++]=255&t},$=(e,t,a,r)=>{let s=e.avail_in;return(s>r&&(s=r),0===s)?0:(e.avail_in-=s,t.set(e.input.subarray(e.next_in,e.next_in+s),a),1===e.state.wrap?e.adler=_(e.adler,t,s,a):2===e.state.wrap&&(e.adler=f(e.adler,t,s,a)),e.next_in+=s,e.total_in+=s,s)},ee=(e,t)=>{let a,r,s=e.max_chain_length,n=e.strstart,i=e.prev_length,o=e.nice_match;const d=e.strstart>e.w_size-F?e.strstart-(e.w_size-F):0,l=e.window,_=e.w_mask,f=e.prev,u=e.strstart+L;let p=l[n+i-1],c=l[n+i];e.prev_length>=e.good_match&&(s>>=2),o>e.lookahead&&(o=e.lookahead);do{if(a=t,l[a+i]!==c||l[a+i-1]!==p||l[a]!==l[n]||l[++a]!==l[n+1])continue;n+=2,a++;do;while(l[++n]===l[++a]&&l[++n]===l[++a]&&l[++n]===l[++a]&&l[++n]===l[++a]&&l[++n]===l[++a]&&l[++n]===l[++a]&&l[++n]===l[++a]&&l[++n]===l[++a]&&n<u);if(r=L-(u-n),n=u-L,r>i){if(e.match_start=t,i=r,r>=o)break;p=l[n+i-1],c=l[n+i]}}while((t=f[t&_])>d&&0!=--s);return i<=e.lookahead?i:e.lookahead},te=e=>{const t=e.w_size;let a,r,s,i,o;do{if(i=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-F)){e.window.set(e.window.subarray(t,t+t),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,r=e.hash_size,a=r;do s=e.head[--a],e.head[a]=s>=t?s-t:0;while(--r);r=t,a=r;do s=e.prev[--a],e.prev[a]=s>=t?s-t:0;while(--r);i+=t}if(0===e.strm.avail_in)break;if(r=$(e.strm,e.window,e.strstart+e.lookahead,i),e.lookahead+=r,e.lookahead+e.insert>=D)for(o=e.strstart-e.insert,e.ins_h=e.window[o],e.ins_h=W(e,e.ins_h,e.window[o+1]);e.insert&&(e.ins_h=W(e,e.ins_h,e.window[o+D-1]),e.prev[o&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=o,o++,e.insert--,!(e.lookahead+e.insert<D)););}while(e.lookahead<F&&0!==e.strm.avail_in)},ae=(e,t)=>{let a,r;for(;;){if(e.lookahead<F){if(te(e),e.lookahead<F&&t===p)return X;if(0===e.lookahead)break}if(a=0,e.lookahead>=D&&(e.ins_h=W(e,e.ins_h,e.window[e.strstart+D-1]),a=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==a&&e.strstart-a<=e.w_size-F&&(e.match_length=ee(e,a)),!(e.match_length>=D))r=d(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;else if(r=d(e,e.strstart-e.match_start,e.match_length-D),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=D){e.match_length--;do e.strstart++,e.ins_h=W(e,e.ins_h,e.window[e.strstart+D-1]),a=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart;while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=W(e,e.ins_h,e.window[e.strstart+1]);if(r&&(q(e,!1),0===e.strm.avail_out))return X}return e.insert=e.strstart<D-1?e.strstart:D-1,t===g?(q(e,!0),0===e.strm.avail_out?G:H):e.last_lit&&(q(e,!1),0===e.strm.avail_out)?X:Z},re=(e,t)=>{let a,r,s;for(;;){if(e.lookahead<F){if(te(e),e.lookahead<F&&t===p)return X;if(0===e.lookahead)break}if(a=0,e.lookahead>=D&&(e.ins_h=W(e,e.ins_h,e.window[e.strstart+D-1]),a=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=D-1,0!==a&&e.prev_length<e.max_lazy_match&&e.strstart-a<=e.w_size-F&&(e.match_length=ee(e,a),5>=e.match_length&&(e.strategy===v||e.match_length===D&&4096<e.strstart-e.match_start)&&(e.match_length=D-1)),e.prev_length>=D&&e.match_length<=e.prev_length){s=e.strstart+e.lookahead-D,r=d(e,e.strstart-1-e.prev_match,e.prev_length-D),e.lookahead-=e.prev_length-1,e.prev_length-=2;do++e.strstart<=s&&(e.ins_h=W(e,e.ins_h,e.window[e.strstart+D-1]),a=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart);while(0!=--e.prev_length);if(e.match_available=0,e.match_length=D-1,e.strstart++,r&&(q(e,!1),0===e.strm.avail_out))return X}else if(!e.match_available)e.match_available=1,e.strstart++,e.lookahead--;else if(r=d(e,0,e.window[e.strstart-1]),r&&q(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return X}return e.match_available&&(r=d(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<D-1?e.strstart:D-1,t===g?(q(e,!0),0===e.strm.avail_out?G:H):e.last_lit&&(q(e,!1),0===e.strm.avail_out)?X:Z},se=(e,t)=>{let a,r,s,n;for(const i=e.window;;){if(e.lookahead<=L){if(te(e),e.lookahead<=L&&t===p)return X;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=D&&0<e.strstart&&(s=e.strstart-1,r=i[s],r===i[++s]&&r===i[++s]&&r===i[++s])){n=e.strstart+L;do;while(r===i[++s]&&r===i[++s]&&r===i[++s]&&r===i[++s]&&r===i[++s]&&r===i[++s]&&r===i[++s]&&r===i[++s]&&s<n);e.match_length=L-(n-s),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=D?(a=d(e,1,e.match_length-D),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(a=d(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),a&&(q(e,!1),0===e.strm.avail_out))return X}return e.insert=0,t===g?(q(e,!0),0===e.strm.avail_out?G:H):e.last_lit&&(q(e,!1),0===e.strm.avail_out)?X:Z},ne=(e,t)=>{for(let a;;){if(0===e.lookahead&&(te(e),0===e.lookahead)){if(t===p)return X;break}if(e.match_length=0,a=d(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,a&&(q(e,!1),0===e.strm.avail_out))return X}return e.insert=0,t===g?(q(e,!0),0===e.strm.avail_out?G:H):e.last_lit&&(q(e,!1),0===e.strm.avail_out)?X:Z},ie=[new a(0,0,0,0,(e,t)=>{let a=65535;for(a>e.pending_buf_size-5&&(a=e.pending_buf_size-5);;){if(1>=e.lookahead){if(te(e),0===e.lookahead&&t===p)return X;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;const r=e.block_start+a;if((0===e.strstart||e.strstart>=r)&&(e.lookahead=e.strstart-r,e.strstart=r,q(e,!1),0===e.strm.avail_out))return X;if(e.strstart-e.block_start>=e.w_size-F&&(q(e,!1),0===e.strm.avail_out))return X}return e.insert=0,t===g?(q(e,!0),0===e.strm.avail_out?G:H):e.strstart>e.block_start&&(q(e,!1),0===e.strm.avail_out)?X:X}),new a(4,4,8,4,ae),new a(4,5,16,8,ae),new a(4,6,32,32,ae),new a(4,4,16,16,re),new a(8,16,32,32,re),new a(8,16,128,128,re),new a(8,32,128,256,re),new a(32,128,258,1024,re),new a(32,258,258,4096,re)],oe=e=>{e.window_size=2*e.w_size,j(e.head),e.max_lazy_match=ie[e.level].max_lazy,e.good_match=ie[e.level].good_length,e.nice_match=ie[e.level].nice_length,e.max_chain_length=ie[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=D-1,e.match_available=0,e.ins_h=0},de=e=>{if(!e||!e.state)return V(e,w);e.total_in=e.total_out=0,e.data_type=U;const t=e.state;return t.pending=0,t.pending_out=0,0>t.wrap&&(t.wrap=-t.wrap),t.status=t.wrap?P:O,e.adler=2===t.wrap?0:1,t.last_flush=p,n(t),b},le=e=>{const t=de(e);return t===b&&oe(e.state),t},_e=(e,t,a,n,i,o)=>{if(!e)return w;let d=1;if(t===T&&(t=6),0>n?(d=0,n=-n):15<n&&(d=2,n-=16),1>i||i>9||a!==I||8>n||15<n||0>t||9<t||0>o||o>S)return V(e,w);8===n&&(n=9);const l=new r;return e.state=l,l.strm=e,l.wrap=d,l.gzhead=null,l.w_bits=n,l.w_size=1<<l.w_bits,l.w_mask=l.w_size-1,l.hash_bits=i+7,l.hash_size=1<<l.hash_bits,l.hash_mask=l.hash_size-1,l.hash_shift=~~((l.hash_bits+D-1)/D),l.window=new Uint8Array(2*l.w_size),l.head=new Uint16Array(l.hash_size),l.prev=new Uint16Array(l.w_size),l.lit_bufsize=1<<i+6,l.pending_buf_size=4*l.lit_bufsize,l.pending_buf=new Uint8Array(l.pending_buf_size),l.d_buf=1*l.lit_bufsize,l.l_buf=3*l.lit_bufsize,l.level=t,l.strategy=o,l.method=a,le(e)};t.exports.deflateInit=(e,t)=>_e(e,t,I,15,8,k),t.exports.deflateInit2=_e,t.exports.deflateReset=le,t.exports.deflateResetKeep=de,t.exports.deflateSetHeader=(e,t)=>e&&e.state?2===e.state.wrap?(e.state.gzhead=t,b):w:w,t.exports.deflate=(e,t)=>{let a,r;if(!e||!e.state||t>m||0>t)return e?V(e,w):w;const n=e.state;if(!e.output||!e.input&&0!==e.avail_in||n.status===M&&t!==g)return V(e,0===e.avail_out?R:w);n.strm=e;const s=n.last_flush;if(n.last_flush=t,n.status===P)if(2===n.wrap)e.adler=0,Q(n,31),Q(n,139),Q(n,8),n.gzhead?(Q(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),Q(n,255&n.gzhead.time),Q(n,255&n.gzhead.time>>8),Q(n,255&n.gzhead.time>>16),Q(n,255&n.gzhead.time>>24),Q(n,9===n.level?2:n.strategy>=y||2>n.level?4:0),Q(n,255&n.gzhead.os),n.gzhead.extra&&n.gzhead.extra.length&&(Q(n,255&n.gzhead.extra.length),Q(n,255&n.gzhead.extra.length>>8)),n.gzhead.hcrc&&(e.adler=f(e.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=z):(Q(n,0),Q(n,0),Q(n,0),Q(n,0),Q(n,0),Q(n,9===n.level?2:n.strategy>=y||2>n.level?4:0),Q(n,3),n.status=O);else{let t=I+(n.w_bits-8<<4)<<8,a=-1;a=n.strategy>=y||2>n.level?0:6>n.level?1:6===n.level?2:3,t|=a<<6,0!==n.strstart&&(t|=32),t+=31-t%31,n.status=O,J(n,t),0!==n.strstart&&(J(n,e.adler>>>16),J(n,65535&e.adler)),e.adler=1}if(n.status===z)if(n.gzhead.extra){for(a=n.pending;n.gzindex<(65535&n.gzhead.extra.length)&&!(n.pending===n.pending_buf_size&&(n.gzhead.hcrc&&n.pending>a&&(e.adler=f(e.adler,n.pending_buf,n.pending-a,a)),K(e),a=n.pending,n.pending===n.pending_buf_size));)Q(n,255&n.gzhead.extra[n.gzindex]),n.gzindex++;n.gzhead.hcrc&&n.pending>a&&(e.adler=f(e.adler,n.pending_buf,n.pending-a,a)),n.gzindex===n.gzhead.extra.length&&(n.gzindex=0,n.status=C)}else n.status=C;if(n.status===C)if(n.gzhead.name){a=n.pending;do{if(n.pending===n.pending_buf_size&&(n.gzhead.hcrc&&n.pending>a&&(e.adler=f(e.adler,n.pending_buf,n.pending-a,a)),K(e),a=n.pending,n.pending===n.pending_buf_size)){r=1;break}r=n.gzindex<n.gzhead.name.length?255&n.gzhead.name.charCodeAt(n.gzindex++):0,Q(n,r)}while(0!==r);n.gzhead.hcrc&&n.pending>a&&(e.adler=f(e.adler,n.pending_buf,n.pending-a,a)),0===r&&(n.gzindex=0,n.status=B)}else n.status=B;if(n.status===B)if(n.gzhead.comment){a=n.pending;do{if(n.pending===n.pending_buf_size&&(n.gzhead.hcrc&&n.pending>a&&(e.adler=f(e.adler,n.pending_buf,n.pending-a,a)),K(e),a=n.pending,n.pending===n.pending_buf_size)){r=1;break}r=n.gzindex<n.gzhead.comment.length?255&n.gzhead.comment.charCodeAt(n.gzindex++):0,Q(n,r)}while(0!==r);n.gzhead.hcrc&&n.pending>a&&(e.adler=f(e.adler,n.pending_buf,n.pending-a,a)),0===r&&(n.status=N)}else n.status=N;if(n.status===N&&(n.gzhead.hcrc?(n.pending+2>n.pending_buf_size&&K(e),n.pending+2<=n.pending_buf_size&&(Q(n,255&e.adler),Q(n,255&e.adler>>8),e.adler=0,n.status=O)):n.status=O),0!==n.pending){if(K(e),0===e.avail_out)return n.last_flush=-1,b;}else if(0===e.avail_in&&Y(t)<=Y(s)&&t!==g)return V(e,R);if(n.status===M&&0!==e.avail_in)return V(e,R);if(0!==e.avail_in||0!==n.lookahead||t!==p&&n.status!==M){let a=n.strategy===y?ne(n,t):n.strategy===A?se(n,t):ie[n.level].func(n,t);if((a===G||a===H)&&(n.status=M),a===X||a===G)return 0===e.avail_out&&(n.last_flush=-1),b;if(a===Z&&(t===c?l(n):t!==m&&(i(n,0,0,!1),t===h&&(j(n.head),0===n.lookahead&&(n.strstart=0,n.block_start=0,n.insert=0))),K(e),0===e.avail_out))return n.last_flush=-1,b}return t===g?0>=n.wrap?E:(2===n.wrap?(Q(n,255&e.adler),Q(n,255&e.adler>>8),Q(n,255&e.adler>>16),Q(n,255&e.adler>>24),Q(n,255&e.total_in),Q(n,255&e.total_in>>8),Q(n,255&e.total_in>>16),Q(n,255&e.total_in>>24)):(J(n,e.adler>>>16),J(n,65535&e.adler)),K(e),0<n.wrap&&(n.wrap=-n.wrap),0===n.pending?E:b):b},t.exports.deflateEnd=e=>{if(!e||!e.state)return w;const t=e.state.status;return t!==P&&t!==z&&t!==C&&t!==B&&t!==N&&t!==O&&t!==M?V(e,w):(e.state=null,t===O?V(e,x):b)},t.exports.deflateSetDictionary=(e,t)=>{let a=t.length;if(!e||!e.state)return w;const r=e.state,s=r.wrap;if(2===s||1===s&&r.status!==P||r.lookahead)return w;if(1===s&&(e.adler=_(e.adler,t,a,0)),r.wrap=0,a>=r.w_size){0===s&&(j(r.head),r.strstart=0,r.block_start=0,r.insert=0);let e=new Uint8Array(r.w_size);e.set(t.subarray(a-r.w_size,a),0),t=e,a=r.w_size}const n=e.avail_in,i=e.next_in,o=e.input;for(e.avail_in=a,e.next_in=0,e.input=t,te(r);r.lookahead>=D;){let e=r.strstart,t=r.lookahead-(D-1);do r.ins_h=W(r,r.ins_h,r.window[e+D-1]),r.prev[e&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=e,e++;while(--t);r.strstart=e,r.lookahead=D-1,te(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=D-1,r.match_available=0,e.next_in=i,e.input=o,e.avail_in=n,r.wrap=s,b},t.exports.deflateInfo="pako deflate (from Nodeca project)"},{"./adler32":7,"./constants":8,"./crc32":9,"./messages":15,"./trees":16}],11:[function(e,t){'use strict';t.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],12:[function(e,t){'use strict';const a=30;t.exports=function(e,t){let r,s,n,i,o,d,l,_,f,u,p,c,h,g,m,b,E,w,x,R,T,v,y,A;const S=e.state;r=e.next_in,y=e.input,s=r+(e.avail_in-5),n=e.next_out,A=e.output,i=n-(t-e.avail_out),o=n+(e.avail_out-257),d=S.dmax,l=S.wsize,_=S.whave,f=S.wnext,u=S.window,p=S.hold,c=S.bits,h=S.lencode,g=S.distcode,m=(1<<S.lenbits)-1,b=(1<<S.distbits)-1;top:do{15>c&&(p+=y[r++]<<c,c+=8,p+=y[r++]<<c,c+=8),E=h[p&m];dolen:for(;;){if(w=E>>>24,p>>>=w,c-=w,w=255&E>>>16,0===w)A[n++]=65535&E;else if(16&w){x=65535&E,w&=15,w&&(c<w&&(p+=y[r++]<<c,c+=8),x+=p&(1<<w)-1,p>>>=w,c-=w),15>c&&(p+=y[r++]<<c,c+=8,p+=y[r++]<<c,c+=8),E=g[p&b];dodist:for(;;){if(w=E>>>24,p>>>=w,c-=w,w=255&E>>>16,16&w){if(R=65535&E,w&=15,c<w&&(p+=y[r++]<<c,c+=8,c<w&&(p+=y[r++]<<c,c+=8)),R+=p&(1<<w)-1,R>d){e.msg="invalid distance too far back",S.mode=a;break top}if(p>>>=w,c-=w,w=n-i,R>w){if(w=R-w,w>_&&S.sane){e.msg="invalid distance too far back",S.mode=a;break top}if(T=0,v=u,0===f){if(T+=l-w,w<x){x-=w;do A[n++]=u[T++];while(--w);T=n-R,v=A}}else if(f<w){if(T+=l+f-w,w-=f,w<x){x-=w;do A[n++]=u[T++];while(--w);if(T=0,f<x){w=f,x-=w;do A[n++]=u[T++];while(--w);T=n-R,v=A}}}else if(T+=f-w,w<x){x-=w;do A[n++]=u[T++];while(--w);T=n-R,v=A}for(;2<x;)A[n++]=v[T++],A[n++]=v[T++],A[n++]=v[T++],x-=3;x&&(A[n++]=v[T++],1<x&&(A[n++]=v[T++]))}else{T=n-R;do A[n++]=A[T++],A[n++]=A[T++],A[n++]=A[T++],x-=3;while(2<x);x&&(A[n++]=A[T++],1<x&&(A[n++]=A[T++]))}}else if(0==(64&w)){E=g[(65535&E)+(p&(1<<w)-1)];continue dodist}else{e.msg="invalid distance code",S.mode=a;break top}break}}else if(0==(64&w)){E=h[(65535&E)+(p&(1<<w)-1)];continue dolen}else if(32&w){S.mode=12;break top}else{e.msg="invalid literal/length code",S.mode=a;break top}break}}while(r<s&&n<o);return x=c>>3,r-=x,c-=x<<3,p&=(1<<c)-1,e.next_in=r,e.next_out=n,e.avail_in=r<s?5+(s-r):5-(r-s),e.avail_out=n<o?257+(o-n):257-(n-o),S.hold=p,void(S.bits=c)}},{}],13:[function(e,t){'use strict';var r=String.fromCharCode;function a(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const s=e("./adler32"),i=e("./crc32"),o=e("./inffast"),d=e("./inftrees"),l=1,_=2,{Z_FINISH:f,Z_BLOCK:u,Z_TREES:p,Z_OK:c,Z_STREAM_END:h,Z_NEED_DICT:g,Z_STREAM_ERROR:m,Z_DATA_ERROR:b,Z_MEM_ERROR:E,Z_BUF_ERROR:w,Z_DEFLATED:x}=e("./constants"),R=1,T=2,v=3,y=4,A=5,S=6,k=7,U=8,I=9,D=10,L=11,F=12,P=13,z=14,C=15,B=16,N=17,O=18,M=19,X=20,Z=21,G=22,H=23,V=24,Y=25,j=26,W=27,K=28,q=29,Q=30,J=31,$=e=>(255&e>>>24)+(65280&e>>>8)+((65280&e)<<8)+((255&e)<<24),ee=e=>{if(!e||!e.state)return m;const t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=R,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,c},te=e=>{if(!e||!e.state)return m;const t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,ee(e)},ae=(e,t)=>{let a;if(!e||!e.state)return m;const r=e.state;return(0>t?(a=0,t=-t):(a=(t>>4)+1,48>t&&(t&=15)),t&&(8>t||15<t))?m:(null!==r.window&&r.wbits!==t&&(r.window=null),r.wrap=a,r.wbits=t,te(e))},re=(e,t)=>{if(!e)return m;const r=new a;e.state=r,r.window=null;const s=ae(e,t);return s!==c&&(e.state=null),s};let se,ne,ie=!0;const oe=e=>{if(ie){se=new Int32Array(512),ne=new Int32Array(32);let t=0;for(;144>t;)e.lens[t++]=8;for(;256>t;)e.lens[t++]=9;for(;280>t;)e.lens[t++]=7;for(;288>t;)e.lens[t++]=8;for(d(l,e.lens,0,288,se,0,e.work,{bits:9}),t=0;32>t;)e.lens[t++]=5;d(_,e.lens,0,32,ne,0,e.work,{bits:5}),ie=!1}e.lencode=se,e.lenbits=9,e.distcode=ne,e.distbits=5},de=(e,t,a,r)=>{let s;const n=e.state;return null===n.window&&(n.wsize=1<<n.wbits,n.wnext=0,n.whave=0,n.window=new Uint8Array(n.wsize)),r>=n.wsize?(n.window.set(t.subarray(a-n.wsize,a),0),n.wnext=0,n.whave=n.wsize):(s=n.wsize-n.wnext,s>r&&(s=r),n.window.set(t.subarray(a-r,a-r+s),n.wnext),r-=s,r?(n.window.set(t.subarray(a-r,a),0),n.wnext=r,n.whave=n.wsize):(n.wnext+=s,n.wnext===n.wsize&&(n.wnext=0),n.whave<n.wsize&&(n.whave+=s))),0};t.exports.inflateReset=te,t.exports.inflateReset2=ae,t.exports.inflateResetKeep=ee,t.exports.inflateInit=e=>re(e,15),t.exports.inflateInit2=re,t.exports.inflate=(e,t)=>{let a,ee,te,ae,re,se,ne,ie,le,_e,fe,ue,pe,ce,he,ge,me,be,Ee,we,xe,Re,Te=0;const ve=new Uint8Array(4);let ye,Ae;const Se=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return m;a=e.state,a.mode===F&&(a.mode=P),re=e.next_out,te=e.output,ne=e.avail_out,ae=e.next_in,ee=e.input,se=e.avail_in,ie=a.hold,le=a.bits,_e=se,fe=ne,Re=c;inf_leave:for(;;)switch(a.mode){case R:if(0===a.wrap){a.mode=P;break}for(;16>le;){if(0===se)break inf_leave;se--,ie+=ee[ae++]<<le,le+=8}if(2&a.wrap&&35615===ie){a.check=0,ve[0]=255&ie,ve[1]=255&ie>>>8,a.check=i(a.check,ve,2,0),ie=0,le=0,a.mode=T;break}if(a.flags=0,a.head&&(a.head.done=!1),!(1&a.wrap)||(((255&ie)<<8)+(ie>>8))%31){e.msg="incorrect header check",a.mode=Q;break}if((15&ie)!==x){e.msg="unknown compression method",a.mode=Q;break}if(ie>>>=4,le-=4,xe=(15&ie)+8,0===a.wbits)a.wbits=xe;else if(xe>a.wbits){e.msg="invalid window size",a.mode=Q;break}a.dmax=1<<a.wbits,e.adler=a.check=1,a.mode=512&ie?D:F,ie=0,le=0;break;case T:for(;16>le;){if(0===se)break inf_leave;se--,ie+=ee[ae++]<<le,le+=8}if(a.flags=ie,(255&a.flags)!==x){e.msg="unknown compression method",a.mode=Q;break}if(57344&a.flags){e.msg="unknown header flags set",a.mode=Q;break}a.head&&(a.head.text=1&ie>>8),512&a.flags&&(ve[0]=255&ie,ve[1]=255&ie>>>8,a.check=i(a.check,ve,2,0)),ie=0,le=0,a.mode=v;case v:for(;32>le;){if(0===se)break inf_leave;se--,ie+=ee[ae++]<<le,le+=8}a.head&&(a.head.time=ie),512&a.flags&&(ve[0]=255&ie,ve[1]=255&ie>>>8,ve[2]=255&ie>>>16,ve[3]=255&ie>>>24,a.check=i(a.check,ve,4,0)),ie=0,le=0,a.mode=y;case y:for(;16>le;){if(0===se)break inf_leave;se--,ie+=ee[ae++]<<le,le+=8}a.head&&(a.head.xflags=255&ie,a.head.os=ie>>8),512&a.flags&&(ve[0]=255&ie,ve[1]=255&ie>>>8,a.check=i(a.check,ve,2,0)),ie=0,le=0,a.mode=A;case A:if(1024&a.flags){for(;16>le;){if(0===se)break inf_leave;se--,ie+=ee[ae++]<<le,le+=8}a.length=ie,a.head&&(a.head.extra_len=ie),512&a.flags&&(ve[0]=255&ie,ve[1]=255&ie>>>8,a.check=i(a.check,ve,2,0)),ie=0,le=0}else a.head&&(a.head.extra=null);a.mode=S;case S:if(1024&a.flags&&(ue=a.length,ue>se&&(ue=se),ue&&(a.head&&(xe=a.head.extra_len-a.length,!a.head.extra&&(a.head.extra=new Uint8Array(a.head.extra_len)),a.head.extra.set(ee.subarray(ae,ae+ue),xe)),512&a.flags&&(a.check=i(a.check,ee,ue,ae)),se-=ue,ae+=ue,a.length-=ue),a.length))break inf_leave;a.length=0,a.mode=k;case k:if(2048&a.flags){if(0===se)break inf_leave;ue=0;do xe=ee[ae+ue++],a.head&&xe&&65536>a.length&&(a.head.name+=r(xe));while(xe&&ue<se);if(512&a.flags&&(a.check=i(a.check,ee,ue,ae)),se-=ue,ae+=ue,xe)break inf_leave}else a.head&&(a.head.name=null);a.length=0,a.mode=U;case U:if(4096&a.flags){if(0===se)break inf_leave;ue=0;do xe=ee[ae+ue++],a.head&&xe&&65536>a.length&&(a.head.comment+=r(xe));while(xe&&ue<se);if(512&a.flags&&(a.check=i(a.check,ee,ue,ae)),se-=ue,ae+=ue,xe)break inf_leave}else a.head&&(a.head.comment=null);a.mode=I;case I:if(512&a.flags){for(;16>le;){if(0===se)break inf_leave;se--,ie+=ee[ae++]<<le,le+=8}if(ie!==(65535&a.check)){e.msg="header crc mismatch",a.mode=Q;break}ie=0,le=0}a.head&&(a.head.hcrc=1&a.flags>>9,a.head.done=!0),e.adler=a.check=0,a.mode=F;break;case D:for(;32>le;){if(0===se)break inf_leave;se--,ie+=ee[ae++]<<le,le+=8}e.adler=a.check=$(ie),ie=0,le=0,a.mode=L;case L:if(0===a.havedict)return e.next_out=re,e.avail_out=ne,e.next_in=ae,e.avail_in=se,a.hold=ie,a.bits=le,g;e.adler=a.check=1,a.mode=F;case F:if(t===u||t===p)break inf_leave;case P:if(a.last){ie>>>=7&le,le-=7&le,a.mode=W;break}for(;3>le;){if(0===se)break inf_leave;se--,ie+=ee[ae++]<<le,le+=8}switch(a.last=1&ie,ie>>>=1,le-=1,3&ie){case 0:a.mode=z;break;case 1:if(oe(a),a.mode=X,t===p){ie>>>=2,le-=2;break inf_leave}break;case 2:a.mode=N;break;case 3:e.msg="invalid block type",a.mode=Q;}ie>>>=2,le-=2;break;case z:for(ie>>>=7&le,le-=7&le;32>le;){if(0===se)break inf_leave;se--,ie+=ee[ae++]<<le,le+=8}if((65535&ie)!=(65535^ie>>>16)){e.msg="invalid stored block lengths",a.mode=Q;break}if(a.length=65535&ie,ie=0,le=0,a.mode=C,t===p)break inf_leave;case C:a.mode=B;case B:if(ue=a.length,ue){if(ue>se&&(ue=se),ue>ne&&(ue=ne),0===ue)break inf_leave;te.set(ee.subarray(ae,ae+ue),re),se-=ue,ae+=ue,ne-=ue,re+=ue,a.length-=ue;break}a.mode=F;break;case N:for(;14>le;){if(0===se)break inf_leave;se--,ie+=ee[ae++]<<le,le+=8}if(a.nlen=(31&ie)+257,ie>>>=5,le-=5,a.ndist=(31&ie)+1,ie>>>=5,le-=5,a.ncode=(15&ie)+4,ie>>>=4,le-=4,286<a.nlen||30<a.ndist){e.msg="too many length or distance symbols",a.mode=Q;break}a.have=0,a.mode=O;case O:for(;a.have<a.ncode;){for(;3>le;){if(0===se)break inf_leave;se--,ie+=ee[ae++]<<le,le+=8}a.lens[Se[a.have++]]=7&ie,ie>>>=3,le-=3}for(;19>a.have;)a.lens[Se[a.have++]]=0;if(a.lencode=a.lendyn,a.lenbits=7,ye={bits:a.lenbits},Re=d(0,a.lens,0,19,a.lencode,0,a.work,ye),a.lenbits=ye.bits,Re){e.msg="invalid code lengths set",a.mode=Q;break}a.have=0,a.mode=M;case M:for(;a.have<a.nlen+a.ndist;){for(;;){if(Te=a.lencode[ie&(1<<a.lenbits)-1],he=Te>>>24,ge=255&Te>>>16,me=65535&Te,he<=le)break;if(0===se)break inf_leave;se--,ie+=ee[ae++]<<le,le+=8}if(16>me)ie>>>=he,le-=he,a.lens[a.have++]=me;else{if(16===me){for(Ae=he+2;le<Ae;){if(0===se)break inf_leave;se--,ie+=ee[ae++]<<le,le+=8}if(ie>>>=he,le-=he,0===a.have){e.msg="invalid bit length repeat",a.mode=Q;break}xe=a.lens[a.have-1],ue=3+(3&ie),ie>>>=2,le-=2}else if(17===me){for(Ae=he+3;le<Ae;){if(0===se)break inf_leave;se--,ie+=ee[ae++]<<le,le+=8}ie>>>=he,le-=he,xe=0,ue=3+(7&ie),ie>>>=3,le-=3}else{for(Ae=he+7;le<Ae;){if(0===se)break inf_leave;se--,ie+=ee[ae++]<<le,le+=8}ie>>>=he,le-=he,xe=0,ue=11+(127&ie),ie>>>=7,le-=7}if(a.have+ue>a.nlen+a.ndist){e.msg="invalid bit length repeat",a.mode=Q;break}for(;ue--;)a.lens[a.have++]=xe}}if(a.mode===Q)break;if(0===a.lens[256]){e.msg="invalid code -- missing end-of-block",a.mode=Q;break}if(a.lenbits=9,ye={bits:a.lenbits},Re=d(l,a.lens,0,a.nlen,a.lencode,0,a.work,ye),a.lenbits=ye.bits,Re){e.msg="invalid literal/lengths set",a.mode=Q;break}if(a.distbits=6,a.distcode=a.distdyn,ye={bits:a.distbits},Re=d(_,a.lens,a.nlen,a.ndist,a.distcode,0,a.work,ye),a.distbits=ye.bits,Re){e.msg="invalid distances set",a.mode=Q;break}if(a.mode=X,t===p)break inf_leave;case X:a.mode=Z;case Z:if(6<=se&&258<=ne){e.next_out=re,e.avail_out=ne,e.next_in=ae,e.avail_in=se,a.hold=ie,a.bits=le,o(e,fe),re=e.next_out,te=e.output,ne=e.avail_out,ae=e.next_in,ee=e.input,se=e.avail_in,ie=a.hold,le=a.bits,a.mode===F&&(a.back=-1);break}for(a.back=0;;){if(Te=a.lencode[ie&(1<<a.lenbits)-1],he=Te>>>24,ge=255&Te>>>16,me=65535&Te,he<=le)break;if(0===se)break inf_leave;se--,ie+=ee[ae++]<<le,le+=8}if(ge&&0==(240&ge)){for(be=he,Ee=ge,we=me;;){if(Te=a.lencode[we+((ie&(1<<be+Ee)-1)>>be)],he=Te>>>24,ge=255&Te>>>16,me=65535&Te,be+he<=le)break;if(0===se)break inf_leave;se--,ie+=ee[ae++]<<le,le+=8}ie>>>=be,le-=be,a.back+=be}if(ie>>>=he,le-=he,a.back+=he,a.length=me,0===ge){a.mode=j;break}if(32&ge){a.back=-1,a.mode=F;break}if(64&ge){e.msg="invalid literal/length code",a.mode=Q;break}a.extra=15&ge,a.mode=G;case G:if(a.extra){for(Ae=a.extra;le<Ae;){if(0===se)break inf_leave;se--,ie+=ee[ae++]<<le,le+=8}a.length+=ie&(1<<a.extra)-1,ie>>>=a.extra,le-=a.extra,a.back+=a.extra}a.was=a.length,a.mode=H;case H:for(;;){if(Te=a.distcode[ie&(1<<a.distbits)-1],he=Te>>>24,ge=255&Te>>>16,me=65535&Te,he<=le)break;if(0===se)break inf_leave;se--,ie+=ee[ae++]<<le,le+=8}if(0==(240&ge)){for(be=he,Ee=ge,we=me;;){if(Te=a.distcode[we+((ie&(1<<be+Ee)-1)>>be)],he=Te>>>24,ge=255&Te>>>16,me=65535&Te,be+he<=le)break;if(0===se)break inf_leave;se--,ie+=ee[ae++]<<le,le+=8}ie>>>=be,le-=be,a.back+=be}if(ie>>>=he,le-=he,a.back+=he,64&ge){e.msg="invalid distance code",a.mode=Q;break}a.offset=me,a.extra=15&ge,a.mode=V;case V:if(a.extra){for(Ae=a.extra;le<Ae;){if(0===se)break inf_leave;se--,ie+=ee[ae++]<<le,le+=8}a.offset+=ie&(1<<a.extra)-1,ie>>>=a.extra,le-=a.extra,a.back+=a.extra}if(a.offset>a.dmax){e.msg="invalid distance too far back",a.mode=Q;break}a.mode=Y;case Y:if(0===ne)break inf_leave;if(ue=fe-ne,a.offset>ue){if(ue=a.offset-ue,ue>a.whave&&a.sane){e.msg="invalid distance too far back",a.mode=Q;break}ue>a.wnext?(ue-=a.wnext,pe=a.wsize-ue):pe=a.wnext-ue,ue>a.length&&(ue=a.length),ce=a.window}else ce=te,pe=re-a.offset,ue=a.length;ue>ne&&(ue=ne),ne-=ue,a.length-=ue;do te[re++]=ce[pe++];while(--ue);0===a.length&&(a.mode=Z);break;case j:if(0===ne)break inf_leave;te[re++]=a.length,ne--,a.mode=Z;break;case W:if(a.wrap){for(;32>le;){if(0===se)break inf_leave;se--,ie|=ee[ae++]<<le,le+=8}if(fe-=ne,e.total_out+=fe,a.total+=fe,fe&&(e.adler=a.check=a.flags?i(a.check,te,fe,re-fe):s(a.check,te,fe,re-fe)),fe=ne,(a.flags?ie:$(ie))!==a.check){e.msg="incorrect data check",a.mode=Q;break}ie=0,le=0}a.mode=K;case K:if(a.wrap&&a.flags){for(;32>le;){if(0===se)break inf_leave;se--,ie+=ee[ae++]<<le,le+=8}if(ie!==(4294967295&a.total)){e.msg="incorrect length check",a.mode=Q;break}ie=0,le=0}a.mode=q;case q:Re=h;break inf_leave;case Q:Re=b;break inf_leave;case J:return E;case 32:default:return m;}return(e.next_out=re,e.avail_out=ne,e.next_in=ae,e.avail_in=se,a.hold=ie,a.bits=le,(a.wsize||fe!==e.avail_out&&a.mode<Q&&(a.mode<W||t!==f))&&de(e,e.output,e.next_out,fe-e.avail_out))?(a.mode=J,E):(_e-=e.avail_in,fe-=e.avail_out,e.total_in+=_e,e.total_out+=fe,a.total+=fe,a.wrap&&fe&&(e.adler=a.check=a.flags?i(a.check,te,fe,e.next_out-fe):s(a.check,te,fe,e.next_out-fe)),e.data_type=a.bits+(a.last?64:0)+(a.mode===F?128:0)+(a.mode===X||a.mode===C?256:0),(0===_e&&0===fe||t===f)&&Re===c&&(Re=w),Re)},t.exports.inflateEnd=e=>{if(!e||!e.state)return m;let t=e.state;return t.window&&(t.window=null),e.state=null,c},t.exports.inflateGetHeader=(e,t)=>{if(!e||!e.state)return m;const a=e.state;return 0==(2&a.wrap)?m:(a.head=t,t.done=!1,c)},t.exports.inflateSetDictionary=(e,t)=>{const a=t.length;let r,n,i;return e&&e.state?(r=e.state,0!==r.wrap&&r.mode!==L)?m:r.mode===L&&(n=1,n=s(n,t,a,0),n!==r.check)?b:(i=de(e,t,a,a),i)?(r.mode=J,E):(r.havedict=1,c):m},t.exports.inflateInfo="pako inflate (from Nodeca project)"},{"./adler32":7,"./constants":8,"./crc32":9,"./inffast":12,"./inftrees":14}],14:[function(e,t){'use strict';const a=15,r=852,s=592,n=0,i=1,o=2,d=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),l=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),_=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),f=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);t.exports=(e,t,u,p,c,h,g,m)=>{const b=m.bits;let E,w,x,R,T,v,y=0,A=0,S=0,k=0,U=0,I=0,D=0,L=0,F=0,P=0,z=null,C=0;const B=new Uint16Array(16),N=new Uint16Array(16);let O,M,X,Z=null,G=0;for(y=0;y<=a;y++)B[y]=0;for(A=0;A<p;A++)B[t[u+A]]++;for(U=b,k=a;1<=k&&0===B[k];k--);if(U>k&&(U=k),0===k)return c[h++]=20971520,c[h++]=20971520,m.bits=1,0;for(S=1;S<k&&0===B[S];S++);for(U<S&&(U=S),L=1,y=1;y<=a;y++)if(L<<=1,L-=B[y],0>L)return-1;if(0<L&&(e===n||1!==k))return-1;for(N[1]=0,y=1;y<a;y++)N[y+1]=N[y]+B[y];for(A=0;A<p;A++)0!==t[u+A]&&(g[N[t[u+A]]++]=A);if(e===n?(z=Z=g,v=19):e===i?(z=d,C-=257,Z=l,G-=257,v=256):(z=_,Z=f,v=-1),P=0,A=0,y=S,T=h,I=U,D=0,x=-1,F=1<<U,R=F-1,e===i&&F>r||e===o&&F>s)return 1;for(;;){O=y-D,g[A]<v?(M=0,X=g[A]):g[A]>v?(M=Z[G+g[A]],X=z[C+g[A]]):(M=96,X=0),E=1<<y-D,w=1<<I,S=w;do w-=E,c[T+(P>>D)+w]=0|(O<<24|M<<16|X);while(0!==w);for(E=1<<y-1;P&E;)E>>=1;if(0===E?P=0:(P&=E-1,P+=E),A++,0==--B[y]){if(y===k)break;y=t[u+g[A]]}if(y>U&&(P&R)!==x){for(0===D&&(D=U),T+=S,I=y-D,L=1<<I;I+D<k&&(L-=B[I+D],!(0>=L));)I++,L<<=1;if(F+=1<<I,e===i&&F>r||e===o&&F>s)return 1;x=P&R,c[x]=0|(U<<24|I<<16|T-h)}}return 0!==P&&(c[T+P]=0|(4194304|y-D<<24)),m.bits=U,0}},{}],15:[function(e,t){'use strict';t.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],16:[function(e,t){'use strict';function a(e){for(let t=e.length;0<=--t;)e[t]=0}function r(e,t,a,r,s){this.static_tree=e,this.extra_bits=t,this.extra_base=a,this.elems=r,this.max_length=s,this.has_stree=e&&e.length}function n(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}const i=0,o=1,d=1,l=29,_=256,f=_+1+l,u=30,p=19,c=2*f+1,h=15,g=16,m=256,b=16,E=17,w=18,x=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),R=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),T=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),v=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),y=Array(2*(f+2));a(y);const A=Array(2*u);a(A);const S=Array(512);a(S);const k=Array(258-3+1);a(k);const U=Array(l);a(U);const I=Array(u);a(I);let D,L,F;const P=e=>256>e?S[e]:S[256+(e>>>7)],z=(e,t)=>{e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=255&t>>>8},C=(e,t,a)=>{e.bi_valid>g-a?(e.bi_buf|=65535&t<<e.bi_valid,z(e,e.bi_buf),e.bi_buf=t>>g-e.bi_valid,e.bi_valid+=a-g):(e.bi_buf|=65535&t<<e.bi_valid,e.bi_valid+=a)},B=(e,t,a)=>{C(e,a[2*t],a[2*t+1])},N=(e,t)=>{let a=0;do a|=1&e,e>>>=1,a<<=1;while(0<--t);return a>>>1},O=e=>{16===e.bi_valid?(z(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):8<=e.bi_valid&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)},M=(e,t)=>{const a=t.dyn_tree,r=t.max_code,s=t.stat_desc.static_tree,i=t.stat_desc.has_stree,o=t.stat_desc.extra_bits,d=t.stat_desc.extra_base,l=t.stat_desc.max_length;let _,u,p,g,b,E,w=0;for(g=0;g<=h;g++)e.bl_count[g]=0;for(a[2*e.heap[e.heap_max]+1]=0,_=e.heap_max+1;_<c;_++)(u=e.heap[_],g=a[2*a[2*u+1]+1]+1,g>l&&(g=l,w++),a[2*u+1]=g,!(u>r))&&(e.bl_count[g]++,b=0,u>=d&&(b=o[u-d]),E=a[2*u],e.opt_len+=E*(g+b),i&&(e.static_len+=E*(s[2*u+1]+b)));if(0!==w){do{for(g=l-1;0===e.bl_count[g];)g--;e.bl_count[g]--,e.bl_count[g+1]+=2,e.bl_count[l]--,w-=2}while(0<w);for(g=l;0!==g;g--)for(u=e.bl_count[g];0!==u;)(p=e.heap[--_],!(p>r))&&(a[2*p+1]!==g&&(e.opt_len+=(g-a[2*p+1])*a[2*p],a[2*p+1]=g),u--)}},X=(e,t,a)=>{const r=Array(h+1);let s,i,o=0;for(s=1;s<=h;s++)r[s]=o=o+a[s-1]<<1;for(i=0;i<=t;i++){let t=e[2*i+1];0!==t&&(e[2*i]=N(r[t]++,t))}},Z=()=>{let e,t,a,s,i;const o=Array(h+1);for(a=0,s=0;s<l-1;s++)for(U[s]=a,e=0;e<1<<x[s];e++)k[a++]=s;for(k[a-1]=s,i=0,s=0;16>s;s++)for(I[s]=i,e=0;e<1<<R[s];e++)S[i++]=s;for(i>>=7;s<u;s++)for(I[s]=i<<7,e=0;e<1<<R[s]-7;e++)S[256+i++]=s;for(t=0;t<=h;t++)o[t]=0;for(e=0;143>=e;)y[2*e+1]=8,e++,o[8]++;for(;255>=e;)y[2*e+1]=9,e++,o[9]++;for(;279>=e;)y[2*e+1]=7,e++,o[7]++;for(;287>=e;)y[2*e+1]=8,e++,o[8]++;for(X(y,f+1,o),e=0;e<u;e++)A[2*e+1]=5,A[2*e]=N(e,5);D=new r(y,x,_+1,f,h),L=new r(A,R,0,u,h),F=new r([],T,0,p,7)},G=e=>{let t;for(t=0;t<f;t++)e.dyn_ltree[2*t]=0;for(t=0;t<u;t++)e.dyn_dtree[2*t]=0;for(t=0;t<p;t++)e.bl_tree[2*t]=0;e.dyn_ltree[2*m]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0},H=e=>{8<e.bi_valid?z(e,e.bi_buf):0<e.bi_valid&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},V=(e,t,a,r)=>{H(e),r&&(z(e,a),z(e,~a)),e.pending_buf.set(e.window.subarray(t,t+a),e.pending),e.pending+=a},Y=(e,t,a,r)=>{const s=2*t,n=2*a;return e[s]<e[n]||e[s]===e[n]&&r[t]<=r[a]},j=(e,t,a)=>{const r=e.heap[a];for(let s=a<<1;s<=e.heap_len&&(s<e.heap_len&&Y(t,e.heap[s+1],e.heap[s],e.depth)&&s++,!Y(t,r,e.heap[s],e.depth));)e.heap[a]=e.heap[s],a=s,s<<=1;e.heap[a]=r},W=(e,t,a)=>{let r,s,n,i,o=0;if(0!==e.last_lit)do r=e.pending_buf[e.d_buf+2*o]<<8|e.pending_buf[e.d_buf+2*o+1],s=e.pending_buf[e.l_buf+o],o++,0===r?B(e,s,t):(n=k[s],B(e,n+_+1,t),i=x[n],0!==i&&(s-=U[n],C(e,s,i)),r--,n=P(r),B(e,n,a),i=R[n],0!==i&&(r-=I[n],C(e,r,i)));while(o<e.last_lit);B(e,m,t)},K=(e,t)=>{const a=t.dyn_tree,r=t.stat_desc.static_tree,s=t.stat_desc.has_stree,i=t.stat_desc.elems;let o,d,l,_=-1;for(e.heap_len=0,e.heap_max=c,o=0;o<i;o++)0===a[2*o]?a[2*o+1]=0:(e.heap[++e.heap_len]=_=o,e.depth[o]=0);for(;2>e.heap_len;)l=e.heap[++e.heap_len]=2>_?++_:0,a[2*l]=1,e.depth[l]=0,e.opt_len--,s&&(e.static_len-=r[2*l+1]);for(t.max_code=_,o=e.heap_len>>1;1<=o;o--)j(e,a,o);l=i;do o=e.heap[1],e.heap[1]=e.heap[e.heap_len--],j(e,a,1),d=e.heap[1],e.heap[--e.heap_max]=o,e.heap[--e.heap_max]=d,a[2*l]=a[2*o]+a[2*d],e.depth[l]=(e.depth[o]>=e.depth[d]?e.depth[o]:e.depth[d])+1,a[2*o+1]=a[2*d+1]=l,e.heap[1]=l++,j(e,a,1);while(2<=e.heap_len);e.heap[--e.heap_max]=e.heap[1],M(e,t),X(a,_,e.bl_count)},q=(e,t,a)=>{let r,s,i=-1,o=t[1],d=0,l=7,_=4;for(0===o&&(l=138,_=3),t[2*(a+1)+1]=65535,r=0;r<=a;r++){if(s=o,o=t[2*(r+1)+1],++d<l&&s===o)continue;else d<_?e.bl_tree[2*s]+=d:0===s?10>=d?e.bl_tree[2*E]++:e.bl_tree[2*w]++:(s!==i&&e.bl_tree[2*s]++,e.bl_tree[2*b]++);d=0,i=s,0===o?(l=138,_=3):s===o?(l=6,_=3):(l=7,_=4)}},Q=(e,t,a)=>{let r,s,i=-1,o=t[1],d=0,l=7,_=4;for(0===o&&(l=138,_=3),r=0;r<=a;r++){if(s=o,o=t[2*(r+1)+1],++d<l&&s===o)continue;else if(d<_)do B(e,s,e.bl_tree);while(0!=--d);else 0===s?10>=d?(B(e,E,e.bl_tree),C(e,d-3,3)):(B(e,w,e.bl_tree),C(e,d-11,7)):(s!==i&&(B(e,s,e.bl_tree),d--),B(e,b,e.bl_tree),C(e,d-3,2));d=0,i=s,0===o?(l=138,_=3):s===o?(l=6,_=3):(l=7,_=4)}},J=e=>{let t;for(q(e,e.dyn_ltree,e.l_desc.max_code),q(e,e.dyn_dtree,e.d_desc.max_code),K(e,e.bl_desc),t=p-1;3<=t&&0===e.bl_tree[2*v[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t},$=(e,t,a,r)=>{let s;for(C(e,t-257,5),C(e,a-1,5),C(e,r-4,4),s=0;s<r;s++)C(e,e.bl_tree[2*v[s]+1],3);Q(e,e.dyn_ltree,t-1),Q(e,e.dyn_dtree,a-1)},ee=e=>{let t,a=4093624447;for(t=0;31>=t;t++,a>>>=1)if(1&a&&0!==e.dyn_ltree[2*t])return i;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return o;for(t=32;t<_;t++)if(0!==e.dyn_ltree[2*t])return o;return i};let te=!1;const ae=e=>{te||(Z(),te=!0),e.l_desc=new n(e.dyn_ltree,D),e.d_desc=new n(e.dyn_dtree,L),e.bl_desc=new n(e.bl_tree,F),e.bi_buf=0,e.bi_valid=0,G(e)},re=(e,t,a,r)=>{C(e,(0<<1)+(r?1:0),3),V(e,t,a,!0)};t.exports._tr_init=ae,t.exports._tr_stored_block=re,t.exports._tr_flush_block=(e,t,a,r)=>{let s,n,i=0;0<e.level?(e.strm.data_type===2&&(e.strm.data_type=ee(e)),K(e,e.l_desc),K(e,e.d_desc),i=J(e),s=e.opt_len+3+7>>>3,n=e.static_len+3+7>>>3,n<=s&&(s=n)):s=n=a+5,a+4<=s&&-1!==t?re(e,t,a,r):e.strategy===4||n===s?(C(e,(d<<1)+(r?1:0),3),W(e,y,A)):(C(e,(2<<1)+(r?1:0),3),$(e,e.l_desc.max_code+1,e.d_desc.max_code+1,i+1),W(e,e.dyn_ltree,e.dyn_dtree)),G(e),r&&H(e)},t.exports._tr_tally=(e,t,a)=>(e.pending_buf[e.d_buf+2*e.last_lit]=255&t>>>8,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&a,e.last_lit++,0===t?e.dyn_ltree[2*a]++:(e.matches++,t--,e.dyn_ltree[2*(k[a]+_+1)]++,e.dyn_dtree[2*P(t)]++),e.last_lit===e.lit_bufsize-1),t.exports._tr_align=e=>{C(e,d<<1,3),B(e,m,y),O(e)}},{}],17:[function(e,t){'use strict';t.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],18:[function(e,t){var a=String.fromCharCode;t.exports=class{constructor(e,t=!0){this.view=e,this.offset=0,this.le=t}get length(){return this.view.byteLength}get EOF(){return this.offset===this.view.byteLength}readUInt8(){return this.view.getUint8(this.offset++)}readInt8(){return this.view.getInt8(this.offset++)}readUInt16(){const e=this.view.getUint16(this.offset,this.le);return this.offset+=2,e}readInt16(){const e=this.view.getUint16(this.offset,this.le);return this.offset+=2,e}readUInt32(){const e=this.view.getUint32(this.offset,this.le);return this.offset+=4,e}readInt32(){const e=this.view.getInt32(this.offset,this.le);return this.offset+=4,e}readFloat32(){const e=this.view.getFloat32(this.offset,this.le);return this.offset+=4,e}readFloat64(){const e=this.view.getFloat64(this.offset,this.le);return this.offset+=8,e}skip(e){this.offset+=e}readUTF8String(){const e=[];for(;this.offset<this.view.byteLength;){const t=this.readUInt8();if(!t)break;e.push(a(t))}return e.join("")}readUTF16String(){const e=[];for(;this.offset<this.view.byteLength;){const t=this.readUInt16();if(!t)break;e.push(a(t))}return e.join("")}readBytes(e=0){const t=this.view.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t}}},{}],19:[function(e,t){const r=new DataView(new ArrayBuffer(1048576));t.exports=class{constructor(e=!0){this.offset=0,this.le=e}writeUInt8(e){r.setUint8(this.offset++,e)}writeInt8(e){r.setInt8(this.offset++,e)}writeUInt16(e){r.setUint16(this.offset,e,this.le),this.offset+=2}writeInt16(e){r.setInt16(this.offset,e,this.le),this.offset+=2}writeUInt32(e){r.setUint32(this.offset,e,this.le),this.offset+=4}writeInt32(e){r.setInt32(this.offset,e,this.le),this.offset+=4}writeFloat32(e){r.setFloat32(this.offset,e,this.le),this.offset+=4}writeFloat64(e){r.setFloat64(this.offset,e,this.le),this.offset+=8}writeUTF8String(e){for(let t=0;t<e.length;t++)this.writeUInt8(e.charCodeAt(t));this.writeUInt8(0)}writeUTF16String(e){for(let t=0;t<e.length;t++)this.writeUInt16(e.charCodeAt(t));this.writeUInt16(0)}skip(e=0){this.offset+=e}finalize(){return r.buffer.slice(0,this.offset)}}},{}],20:[function(e,t){const a=e("pako"),r=e("../../src/network/reader"),s=e=>"object"==typeof e&&e.byteLength!==void 0;t.exports={serialize:e=>{for(const t of Object.keys(e)){const a=e[t];Array.isArray(a)&&a.every(s)||s(a)||delete e[t]}let t=0;for(const a in e){t+=a.length+1;const r=e[a];t+=4,Array.isArray(r)?r.forEach(e=>t+=e.byteLength+4):t+=r.byteLength}const r=new Uint8Array(t),n=new DataView(r.buffer);let o=0;for(const t in e){for(let e=0;e<t.length;e++)r[o++]=t.charCodeAt(e);r[o++]=0;const a=e[t],s=e=>{n.setInt32(o,e.byteLength,!0),o+=4,r.set(new Uint8Array(e),o),o+=e.byteLength};if(Array.isArray(a)){n.setInt32(o,-a.length,!0),o+=4;for(const e of a)s(e)}else s(a)}return console.assert(r.byteLength===o,"Output bytes should match final offset"),a.deflate(r,{level:9,raw:!0}).buffer},deserialize:e=>{const t={},s=new r(new DataView(a.inflate(e,{raw:!0}).buffer)),n=e=>s.readBytes(e||s.readInt32());for(;!s.EOF;){const e=s.readUTF8String(),a=s.readInt32();t[e]=0<a?n(a):Array.from({length:-a},()=>n())}return t}}},{"../../src/network/reader":18,pako:2}],21:[function(e,t){t.exports=class{constructor(e){this.port=e,this.readyState=WebSocket.CONNECTING,e.onmessage=t=>{const{data:e}=t;"message"===e.event?this.onmessage({data:e.message}):"error"===e.event?this.onerror({message:e.message}):"close"===e.event?this.onclose({code:e.code,reason:e.reason}):"open"===e.event&&(this.readyState=WebSocket.OPEN,this.onopen())},e.start(),this.onopen=this.onmessage=this.onerror=this.onclose=()=>{}}send(e){this.port.postMessage({event:"message",message:e},[e])}close(){this.port.postMessage({event:"close",code:1001,message:"Client closed connection"}),this.port.close(),this.readyState=WebSocket.CLOSED}}},{}],22:[function(e,t){t.exports=class{constructor(){this.setBuffer()}setBuffer(e){e||(self.SharedArrayBuffer?e=new SharedArrayBuffer(12):e=new ArrayBuffer(12)),this.sharedBuffer=e,this.buffer=new Int32Array(this.sharedBuffer)}get x(){return Atomics.load(this.buffer,0)}set x(e){Atomics.store(this.buffer,0,e)}get y(){return Atomics.load(this.buffer,1)}set y(e){Atomics.store(this.buffer,1,e)}get scroll(){return Atomics.load(this.buffer,2)}set scroll(e){Atomics.store(this.buffer,2,e)}updateScroll(e){Atomics.add(this.buffer,2,e)}resetScroll(){return Atomics.exchange(this.buffer,2,0)}}},{}],23:[function(e,t){var a=Math.max;const{EventEmitter:r}=e("events"),s=e("../../src/network/reader"),n=e("../../src/network/writer"),i=e("./replay-db"),{deserialize:o}=e("./custom-bson"),d=e("./fake-socket"),l=480,_=270,f=5;class u{constructor(e=0){this.score=0,this.state=new ArrayBuffer(e),this.view=new Uint8Array(this.state),this.packetTimestamps=[],this.packets=[],this.preview=new OffscreenCanvas(l,_),this.ctx=this.preview.getContext("2d"),this.ctx.imageSmoothingEnabled=!0,this.ctx.imageSmoothingQuality="high"}clearPreview(){this.ctx.clearRect(0,0,this.preview.width,this.preview.height)}}class p{constructor(e,t,a){this.t=0,this.i=0,this.protocol=t,this.renderer=e,this.source=new Uint8Array(e.core.buffer,0,e.INDICES_OFFSET),this.snapshots=Array.from({length:a*f},()=>new u(this.source.byteLength));const r=this.sharedArrayBuffer=new SharedArrayBuffer(4*(this.snapshots.length*l*_));console.log(`${(r.byteLength/1024/1024).toFixed(1)}MB preview buffer allocated for GIF generation`),this.previewPool=new Uint8ClampedArray(this.sharedArrayBuffer),this.renderer.loader.postMessage({pool:r})}async init(){this.db=await i()}encodePlayerData(){const e=new n;e.skip(1);const t=this.renderer.playerData.filter((t,a)=>{if(a&&!(250<a)&&t)return e.writeUInt8(a),e.writeUTF16String(t.name||""),e.writeUTF16String(t.skin||""),!0}),a=e.offset;return e.offset=0,e.writeUInt8(t.length),e.offset=a,e.finalize()}encodeState(e){const t=this.source.slice();this.source.set(new Uint8Array(e));const a=this.renderer.serializeState();return this.source.set(t),a}async save(){if(this.saving)return self.postMessage({event:"warning",message:"Saving Current Clip, Please Try Again Later."});this.saving=!0;const e=this.snapshots.filter(e=>e.packets.length).map(e=>e).reverse(),t=e.reduce((e,t)=>e.concat(t.packets),[]).map(e=>e.slice());let a=e.reduce((e,t)=>e.concat(t.packetTimestamps),[]);const r=Math.min(...a);a=a.map(e=>e-r);const s=this.protocol.HANDSHAKE_PACKET,n=this.encodePlayerData(),i=new Float32Array(a).buffer,o=this.encodeState(e[0].state);let d=0;for(self.postMessage({event:"replay",state:"starting"});d<e.length;)await new Promise(t=>{const a=e[d].ctx.getImageData(0,0,l,_);this.previewPool.set(a.data,a.data.byteLength*~~d),d++,requestAnimationFrame(t)});const u={handshake:s,initial:o,buffers:t,timestamps:i,players:n,PREVIEW_WIDTH:l,PREVIEW_HEIGHT:_,REPLAY_PREVIEW_FPS:f,PREVIEW_LENGTH:e.length};this.renderer.loader.postMessage({replay:u},t)}set score(e){this.snapshots[0].score=a(e,this.snapshots[0].score)}get maxScore(){return a(...this.snapshots.map(e=>e.score))}recordState(){if(!this.curr){const e=this.snapshots.pop();this.free(e),this.snapshots.unshift(e),e.view.set(this.source),this.score=this.renderer.stats.score,this.requestPreview=!0}}savePreview(){if(this.requestPreview){this.requestPreview=!1;const e=this.snapshots[0];e.clearPreview(),e.ctx.drawImage(this.renderer.canvas,0,0,e.preview.width,e.preview.height)}}recordPacket(e){this.snapshots[0].packets.push(e),this.snapshots[0].packetTimestamps.push(performance.now())}free(e){this.renderer.loader.postMessage(e.packets,e.packets),e.score=0,e.view.fill(0),e.packets=[],e.packetTimestamps=[]}resetSnapshots(){this.snapshots.forEach(e=>this.free(e))}async load(e=0){const t=await new Promise((t,a)=>{const r=this.db.transaction(["replay-data"],"readonly"),s=r.objectStore("replay-data"),n=s.get(e);r.oncomplete=()=>t(o(n.result)),r.onerror=a}),a=new Uint8Array(t.initial),r=new Float32Array(t.timestamps);this.curr={initial:a,timestamps:r,packets:t.buffers},console.assert(this.curr.timestamps.length===this.curr.packets.length,"Packet and timestamp length MUST match"),t.handshake&&this.protocol.onMessage({data:t.handshake}),this.protocol.parsePlayers(t.players),console.log("Replay loaded",this.curr)}update(e=0){if(this.curr){if(!this.t){this.source.fill(0);const e=this.renderer.core;e.HEAPU8.set(this.curr.initial,this.renderer.INDICES_OFFSET),e.instance.exports.deserialize(0,this.renderer.INDICES_OFFSET)}for(;this.curr.timestamps[this.i]<this.t;)this.protocol.onMessage({data:this.curr.packets[this.i++]});this.i>=this.curr.timestamps.length?this.resetTrack():this.t+=e}}resetTrack(){this.i=0,this.t=0,this.renderer.camera.tp=!0}}const c=[2,4];t.exports=class extends r{constructor(e){super(),this.pid=0,this.bandwidth=0,this.renderer=e,this.replay=new p(e,this,20),this.map={hw:1e4,hh:1e4},this.setupIntervals(),this.onMessage=this.onMessage.bind(this)}get connecting(){return this.ws&&this.ws.readyState==WebSocket.CONNECTING}get connected(){return this.ws&&this.ws.readyState==WebSocket.OPEN}disconnect(){this.connected&&this.ws.close(),delete this.replay.curr,this.replay.resetTrack()}connect(e,t="",a="",r=""){this.disconnect();const s=this.ws="string"==typeof e?new WebSocket(e):new d(e);this.ws.binaryType="arraybuffer",this.ws.onopen=()=>{this.renderer.clearCells();const e=new n;e.writeUInt8(69),e.writeInt16(420),e.writeUTF16String(t),e.writeUTF16String(a),e.writeUTF16String(r),this.ws.send(e.finalize()),this.emit("open"),delete this.ping},this.ws.onmessage=this.onMessage,this.ws.onerror=()=>self.postMessage({event:"error",message:"Connection failed"}),this.ws.onclose=t=>{this.bandwidth=0,delete this.ping,delete this.dualIDs,delete this.lastName,delete this.lastSkins,this.emit("close"),this.ws==s&&self.postMessage({event:"disconnect",code:t.code,reason:t.reason})}}setupIntervals(){this.replayInterval=self.setInterval(()=>this.replay.recordState(),1e3/f),this.pingInterval=self.setInterval(()=>{if(this.renderer.stats.bandwidth=this.bandwidth,this.bandwidth=0,this.connected&&this.pid&&!this.ping){const e=new ArrayBuffer(1);new Uint8Array(e)[0]=69,this.send(e),this.ping=Date.now()}},1e3);const e=this.renderer.state;this.mouseInterval=self.setInterval(()=>{if(!this.connected||!this.pid||!this.renderer.state.visible)return;const t=new n;t.writeUInt8(3),t.writeFloat32(this.renderer.cursor.position[0]),t.writeFloat32(this.renderer.cursor.position[1]);const a=e.exchange();let r=0;e.spectate?(e.spectate=0,r=255):a.clicked&&(r=this.renderer.getClickedPlayerID()),t.writeUInt8(r),t.writeUInt8(a.splits),t.writeUInt8(a.ejects),t.writeUInt8(a.macro),t.writeUInt8(a.lineLock),t.writeUInt8(a.switch_tab),this.send(t.finalize()),a.respawn&&this.spawn(),a.clip&&!this.replaying&&this.replay.save()},1e3/33)}send(e){this.connected&&this.ws.send(e)}onMessage(t){const e=new s(new DataView(t.data)),a=e.readUInt8();switch(this.bandwidth+=t.data.byteLength,a){case 1:this.HANDSHAKE_PACKET=t.data;const r=e.readUInt8(),s=e.readUInt8();s&&(this.dualIDs=[r,s]),this.map.hw=e.readUInt16(),this.map.hh=e.readUInt16(),console.log(`Map Dimension: ${this.map.hw<<1}x${this.map.hh<<1}`);const n=e.readUTF16String();this.emit("protocol"),self.postMessage({event:"connect",server:n});break;case 2:this.renderer.clearCells();break;case 3:const i=e.readUInt16(),o=e.readUTF16String(),d=e.readUTF16String();this.renderer.loadPlayerData({id:i,name:o,skin:d});break;case 4:this.parseCellData(t.data);break;case 5:this.parseLeaderboard(e);break;case 6:this.parseMinimap(e);break;case 7:if(this.parseStats(e),this.renderer.state.auto_respawn){const e=new ArrayBuffer(1);new Uint8Array(e)[0]=7,this.send(e)}break;case 10:const l=e.readUInt16(),_=e.readUTF16String(),f=this.renderer.playerData[l];if(!f)return console.warn(`Received unknown pid: ${l}, message: ${_}`);self.postMessage({event:"chat",pid:l,player:f,message:_});break;case 69:if(!this.ping)return;this.renderer.stats.ping=Date.now()-this.ping,delete this.ping;}!this.replaying&&c.includes(a)&&(this.renderer.target.position[0]||this.renderer.target.position[1])&&this.replay.recordPacket(t.data)}get player(){return Array.isArray(this.dualIDs)?this.renderer.playerData[this.dualIDs[0]]:this.renderer.playerData[this.pid]}parsePlayers(e){const t=new s(new DataView(e)),a=t.readUInt8();for(let r=0;r<a;r++){const e={id:t.readUInt8(),name:t.readUTF16String(),skin:t.readUTF16String()};this.renderer.loadPlayerData(e)}}parseCellData(e){this.lastPacket=this.renderer.lastTimestamp;const t=this.renderer,a=this.renderer.core,r=new DataView(e,1,24);this.pid=r.getUint8(0);const s=this.renderer.stats.mycells,n=r.getUint16(1,!0);this.replaying&&!s&&n&&(t.camera.tp=!0),t.stats.mycells=n,t.stats.linelocked=r.getUint8(3),t.stats.score=r.getFloat32(4,!0),t.syncMouse.x=r.getFloat32(8,!0),t.syncMouse.y=r.getFloat32(12,!0),t.target.position[0]=r.getFloat32(16,!0),t.target.position[1]=r.getFloat32(20,!0),a.HEAPU8.set(new Uint8Array(e,25),t.INDICES_OFFSET),a.instance.exports.deserialize(0,t.INDICES_OFFSET)}parseLeaderboard(e){const t=e.readInt16(),a=e.readUInt8(),r={rank:t,me:this.player,players:[]};for(let t=0;t<a;t++)r.players.push(this.renderer.playerData[e.readUInt8()]);self.postMessage({event:"leaderboard",lb:r})}parseMinimap(e){const t=e.readUInt8(),a=[];for(let r=0;r<t;r++){const t=e.readUInt8(),r=this.renderer.playerData[t]||{};r.id=t,(Array.isArray(this.dualIDs)?this.dualIDs.includes(t):this.pid==t)&&(r.me=!0);const s=e.readFloat32(),n=e.readFloat32();r.x=s/(this.map.hw<<1)+.5,r.y=n/(this.map.hh<<1)+.5,r.score=e.readFloat32(),a.push(r)}self.postMessage({event:"minimap",minimap:a})}parseStats(e){const t=e.readUInt32(),a=e.readFloat32(),r=e.readFloat32();self.postMessage({event:"stats",kills:t,score:a,surviveTime:r})}spawn(e=this.lastName,t,a){this.lastName=e,this.lastSkins&&(t=this.lastSkins[0],a=this.lastSkins[1]),this.lastSkins=[t,a];const r=new n;r.writeUInt8(1),r.writeUTF16String(e||""),r.writeUTF16String(t||""),r.writeUTF16String(a||""),this.send(r.finalize())}sendChat(e){const t=new n;t.writeUInt8(10),t.writeUTF16String(e),this.send(t.finalize()),this.pid&&self.postMessage({event:"chat",pid:Array.isArray(this.dualIDs)?this.dualIDs[0]:this.pid,player:this.player,message:e})}get replaying(){return!!this.replay.curr}async startReplay(e=0){this.disconnect(),this.renderer.cleanup(),await this.replay.load(e)}}},{"../../src/network/reader":18,"../../src/network/writer":19,"./custom-bson":20,"./fake-socket":21,"./replay-db":25,events:1}],24:[function(e,t){var a=Math.PI,r=Math.max,s=Math.min;importScripts("https://cdnjs.cloudflare.com/ajax/libs/gl-matrix/2.8.1/gl-matrix-min.js");const n=e("./stats"),i=e("./mouse"),o=e("./state"),d=e("./viewport"),l=e("./protocol"),_=e("./wasm-core"),f=e("./texture-store"),{makeProgram:u,COLORS:p}=e("./util"),{SPRITE_VERT_SHADER_SOURCE:h,SPRITE_FRAG_SHADER_SOURCE:g,PARTICLE_VERT_SHADER_SOURCE:m,PARTICLE_FRAG_SHADER_SOURCE:b,MASS_VERT_SHADER_SOURCE:E,MASS_FRAG_PEELING_SHADER_SOURCE:w,BORDER_VERT_SHADER_SOURCE:x,BORDER_FRAG_SHADER_SOURCE:R}=e("./shaders"),T=.25,v=0,A=0,S=.25,k=-.33,U=65536,I=["0","1","2","3","4","5","6","7","8","9",".","k"],D=I.length;class L{constructor(e){this.canvas=e,this.core=new _(this),this.fbo=new Map,this.buffers=new Map,this.uniforms=new Map,this.circleTextures=[],this.playerData=Array.from({length:256}),this.playerData[0]={name:"Server"},this.updates=[],this.stats=new n,this.mouse=new i,this.state=new o,this.viewport=new d,this.viewbox={t:0,b:0,l:0,r:0},this.syncMouse={x:0,y:0},this.initLoader(),this.fps=0,this.fpsInterval=setInterval(()=>{this.stats.fps=this.fps,this.fps=0},1e3)}start(){if(this.r)return!1;const e=t=>{this.r=requestAnimationFrame(e);try{this.render(t)}catch(t){throw this.stop(),this.protocol.disconnect(),t}};return this.r=requestAnimationFrame(e),!0}stop(){return!!this.r&&(this.r=cancelAnimationFrame(this.r),!0)}loadPlayerData({id:e,skin:t,name:a,persist:r}){this.IGNORE_SKIN&&250>=e&&(t="");const s=this.playerData[e];s?(this.textures.replace(s.name,a)&&this.loader.postMessage({id:e,name:a}),this.textures.replace(s.skin,t)&&this.loader.postMessage({id:e,skin:t,quality:this.state.skin_dim})):(this.textures.add(a,r)&&this.loader.postMessage({id:e,name:a}),this.textures.add(t,r)&&this.loader.postMessage({id:e,skin:t,quality:this.state.skin_dim})),this.playerData[e]={skin:t,name:a}}initLoader(){this.loader=new Worker("loader.min.js"),this.loader.onmessage=t=>{t.data&&("replay"===t.data.event?(self.postMessage(t.data),this.protocol.replay.saving=!1):t.data.id&&this.updates.unshift(t.data))}}loadUniform(e,t){this.uniforms.has(e)||this.uniforms.set(e,new Map),this.uniforms.get(e).set(t,this.gl.getUniformLocation(e,t))}getUniform(e,t){return this.uniforms.get(e).get(t)}async initEngine(){const e=this.gl=this.canvas.getContext("webgl2",{depth:!1,premultipliedAlpha:!1,powerPreference:"high-performance",preserveDrawingBuffer:!0});if(!e)return self.postMessage({event:"webgl2"});e.enable(e.BLEND),await this.core.load(),this.wasm=this.core.instance.exports;let t=new FontFace("Bree Serif","url(/static/font/BreeSerif-Regular.ttf)");self.fonts&&fonts.add(t),await t.load(),t=new FontFace("Lato","url(/static/font/Lato-Bold.ttf)"),self.fonts&&fonts.add(t),await t.load(),this.cursor={position:vec3.create()},this.target={position:vec3.create(),scale:10},this.camera={position:vec3.create(),scale:10,tp:!1},this.proj=mat4.create(),this.SKIN_DIM=this.state.skin_dim,this.IGNORE_SKIN=this.state.ignore_skin,this.CIRCLE_RADIUS=this.state.circle_radius,this.BYTES_PER_CELL_DATA=this.wasm.bytes_per_cell_data(),this.INDICES_OFFSET=U*this.BYTES_PER_CELL_DATA,this.PELLETS_OFFSET=this.INDICES_OFFSET+3*U,this.nameWidths=new Float32Array(256),this.nameFlags=new Uint8Array(U),this.nameBuffer=new Float32Array(new ArrayBuffer(6*U)),this.massWidths=new Float32Array(256),this.massCounts=new Uint8Array(U),this.massBuffer=new Float32Array(new ArrayBuffer(128*U));const a=this.core.buffer.byteLength+this.nameWidths.byteLength+this.nameBuffer.byteLength+this.massWidths.byteLength+this.massCounts.byteLength+this.massBuffer.byteLength;console.log(`${(a/1024/1024).toFixed(1)} MB allocated for renderer`),this.textures=new f(this);const r=this.main_prog=u(e,h,g),s=this.mass_prog=u(e,E,w),n=this.brdr_prog=u(e,x,R),i=this.prtl_prog=u(e,m.replace(/\$colors\$/g,p.length),b);this.loadUniform(r,"u_proj"),this.loadUniform(r,"u_uvs"),this.loadUniform(r,"u_texture"),this.loadUniform(s,"u_proj"),this.loadUniform(s,"u_uvs"),this.loadUniform(s,"u_mass_char"),this.loadUniform(n,"u_map"),this.loadUniform(n,"u_proj"),this.loadUniform(n,"u_color"),this.loadUniform(i,"u_proj"),this.loadUniform(i,"u_uvs"),this.loadUniform(i,"u_colors"),this.loadUniform(i,"u_texture"),this.generatePelletVAO(),this.generateCellVAO(),this.generateNameVAO(),this.generateMassVAO(),this.generateBorderVAO(),this.generateDeadcellTexture(),this.generateDualTextures("rgb(87, 121, 221)","rgb(230, 76, 166)"),this.generateCircleTextures(),this.generateMassTextures();const o=12/255;e.useProgram(n),e.uniform4f(this.getUniform(n,"u_color"),o,o,o,1),e.useProgram(s),e.uniform1i(this.getUniform(s,"u_mass_char"),1),this.loadPlayerData({id:253,skin:`/static/img/virus-${this.SKIN_DIM}.png`,persist:!0}),this.start(),this.protocol=new l(this),this.protocol.on("close",this.cleanup.bind(this)),await this.protocol.replay.init()}cleanup(){this.protocol.replaying||(this.clearCells(),this.clearScreen(),this.clearPlayerData(),this.target.position.fill(0),this.textures.clear(),this.stats.reset())}teleportCamera(){this.camera.scale=this.target.scale,this.camera.position.set(this.target.position),this.camera.tp=!1}clearCells(){this.core.HEAPU32.fill(0),this.massBuffer.fill(0)}clearPlayerData(){for(let e=1;250>=e;e++)this.playerData[e]=void 0}allocBuffer(e){if(this.buffers.has(e))throw new Error(`Already allocated buffer "${e}"`);const t=this.gl.createBuffer();return this.buffers.set(e,t),t}allocFrameBuffer(e,t=1){if(this.fbo.has(e))throw new Error(`Already allocated framebuffer "${e}"`);this.fbo.set(e,1==t?this.gl.createFramebuffer():Array.from({length:t},()=>this.gl.createFramebuffer()))}freeFrameBuffer(e){if(!this.fbo.has(e))throw new Error(`Trying to free none existing framebuffer "${e}`);const t=this.fbo.get(e);if(Array.isArray(t))for(const e of t)this.gl.deleteFramebuffer(e);else this.gl.deleteFramebuffer(t);this.fbo.delete(e)}generatePelletVAO(){const e=this.gl;e.bindVertexArray(this.pelletVAO=e.createVertexArray()),e.bindBuffer(e.ARRAY_BUFFER,this.allocBuffer("pellet_buffer")),e.bufferData(e.ARRAY_BUFFER,this.core.HEAPU8.subarray(0,72*U),e.DYNAMIC_DRAW);const t=e.FLOAT;e.vertexAttribPointer(0,3,t,!1,0,0),e.enableVertexAttribArray(0)}generateCellVAO(){const e=this.gl;e.bindVertexArray(this.cellVAO=e.createVertexArray()),e.bindBuffer(e.ARRAY_BUFFER,this.allocBuffer("cell_buffer")),e.bufferData(e.ARRAY_BUFFER,this.core.HEAPU8.subarray(0,48*U),e.DYNAMIC_DRAW);const t=e.FLOAT;e.vertexAttribPointer(0,2,t,!1,0,0),e.enableVertexAttribArray(0)}generateNameVAO(){const e=this.gl;e.bindVertexArray(this.nameVAO=e.createVertexArray()),e.bindBuffer(e.ARRAY_BUFFER,this.allocBuffer("name_buffer")),e.bufferData(e.ARRAY_BUFFER,this.nameBuffer,e.DYNAMIC_DRAW);const t=e.FLOAT;e.vertexAttribPointer(0,2,t,!1,0,0),e.enableVertexAttribArray(0)}generateMassVAO(){const e=this.gl;e.bindVertexArray(this.massVAO=e.createVertexArray()),e.bindBuffer(e.ARRAY_BUFFER,this.allocBuffer("mass_buffer")),e.bufferData(e.ARRAY_BUFFER,this.massBuffer,e.DYNAMIC_DRAW);const t=e.FLOAT;e.vertexAttribPointer(0,3,t,!1,0,0),e.enableVertexAttribArray(0)}generateBorderVAO(){const e=this.gl;e.bindVertexArray(this.borderVAO=e.createVertexArray()),e.bindBuffer(e.ARRAY_BUFFER,this.allocBuffer("border_buffer")),e.bufferData(e.ARRAY_BUFFER,new Float32Array([-1,1,-1,-1,1,-1,-1,1,1,-1,1,1]),e.STATIC_DRAW);const t=e.FLOAT;e.vertexAttribPointer(0,2,t,!1,0,0),e.enableVertexAttribArray(0)}generateDeadcellTexture(){const e=this.gl;e.bindTexture(e.TEXTURE_2D,this.deadCellTexture=e.createTexture());const t=this.CIRCLE_RADIUS,r=new OffscreenCanvas(t<<1,t<<1),s=r.getContext("2d");s.globalAlpha=.75,s.fillStyle=`rgb(75, 75, 75)`,s.arc(t,t,t,0,2*a,!1),s.fill(),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,r),e.generateMipmap(e.TEXTURE_2D),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR_MIPMAP_LINEAR)}generateDualTextures(e="",t=""){const r=this.gl;this.dualTextures||(this.dualTextures=[r.createTexture(),r.createTexture()]);const s=this.CIRCLE_RADIUS,n=new OffscreenCanvas(s<<1,s<<1),i=n.getContext("2d"),o=new Path2D;o.arc(s,s,s,0,2*a,!1),o.arc(s,s,.95*s,0,2*a,!1),i.fillStyle=e,i.fill(o,"evenodd"),r.bindTexture(r.TEXTURE_2D,this.dualTextures[0]),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,n),r.generateMipmap(r.TEXTURE_2D),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR_MIPMAP_LINEAR),i.clearRect(0,0,n.width,n.height),i.fillStyle=t,i.fill(o,"evenodd"),r.bindTexture(r.TEXTURE_2D,this.dualTextures[1]),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,n),r.generateMipmap(r.TEXTURE_2D),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR_MIPMAP_LINEAR)}generateCircleTextures(){const e=this.gl;this.circleTextures.length&&(this.circleTextures.forEach(a=>e.deleteTexture(a)),this.circleTextures=[]);const t=this.CIRCLE_RADIUS,s=new OffscreenCanvas(t<<1,t<<1),n=s.getContext("2d");for(const[i,r,o]of p){const d=e.createTexture();e.bindTexture(e.TEXTURE_2D,d),this.circleTextures.push(d),n.fillStyle=`rgb(${i}, ${r}, ${o})`,n.clearRect(0,0,s.width,s.height),n.arc(t,t,t,0,2*a,!1),n.fill(),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,s),e.generateMipmap(e.TEXTURE_2D),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR_MIPMAP_LINEAR)}const i=new Float32Array([0,1,1,1,0,0,1,1,0,0,1,0]);e.useProgram(this.main_prog),e.uniform2fv(this.getUniform(this.main_prog,"u_uvs"),i),e.useProgram(this.prtl_prog),e.uniform2fv(this.getUniform(this.prtl_prog,"u_uvs"),i);const o=new Float32Array(3*p.length);for(const e in p)o.set(p[e].map(e=>e/255),3*e);e.uniform3fv(this.getUniform(this.prtl_prog,"u_colors"),o)}generateMassTextures(){const e=this.gl;e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D_ARRAY,e.createTexture());const t=320;e.texImage3D(e.TEXTURE_2D_ARRAY,0,e.RGBA,320,t,D,0,e.RGBA,e.UNSIGNED_BYTE,null);const a=new OffscreenCanvas(320,t),r=a.getContext("2d");r.font="bold 280px Lato",r.fillStyle="white",r.strokeStyle="black",r.textAlign="center",r.lineWidth=30,r.textBaseline="middle";const s=new Float32Array(2*(4*D));for(let n=0;n<D;n++){const i=I[n];r.clearRect(0,0,a.width,a.height),r.strokeText(i,a.width>>1,a.height>>1),r.fillText(i,a.width>>1,a.height>>1);const o=(r.measureText(i).width+20)/a.width;this.massWidths[i.charCodeAt(0)]=o,e.texSubImage3D(e.TEXTURE_2D_ARRAY,0,0,0,n,320,t,1,e.RGBA,e.UNSIGNED_BYTE,a);const d=.5-o/2,l=.5+o/2,_=0,f=1;s[8*n+0]=d,s[8*n+1]=_,s[8*n+2]=l,s[8*n+3]=_,s[8*n+4]=d,s[8*n+5]=f,s[8*n+6]=l,s[8*n+7]=f}e.generateMipmap(e.TEXTURE_2D_ARRAY),e.texParameteri(e.TEXTURE_2D_ARRAY,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D_ARRAY,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D_ARRAY,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D_ARRAY,e.TEXTURE_MIN_FILTER,e.LINEAR_MIPMAP_LINEAR),e.useProgram(this.mass_prog),e.uniform2fv(this.getUniform(this.mass_prog,"u_uvs"),s)}screenToWorld(e=vec3.create(),t=0,a=0){const r=mat4.create();mat4.invert(r,this.proj),vec3.transformMat4(e,[t,-a,0],r)}updateTarget(){this.screenToWorld(this.cursor.position,this.mouse.x/4096,this.mouse.y/4096);const e=this.mouse.resetScroll();this.target.scale*=1+e/1e3,this.target.scale=s(r(this.target.scale,.01),1e4)}lerpCamera(e=1/60){const t=s(r(e*this.state.zoom,0),1);vec3.lerp(this.camera.position,this.camera.position,this.target.position,e),this.camera.scale+=(this.target.scale-this.camera.scale)*t;const a=this.camera.position[0],n=this.camera.position[1],i=this.viewport.width*this.camera.scale/2,o=this.viewport.height*this.camera.scale/2,d=this.viewbox;mat4.ortho(this.proj,d.l=a-i,d.r=a+i,d.b=n-o,d.t=n+o,0,1)}checkResolution(){const e=this.gl,t=this.state.resolution;(e.canvas.width!=t[0]||e.canvas.height!=t[1])&&(e.canvas.width=t[0],e.canvas.height=t[1])}buildNameVertexBuffer(e,t){let a=0;const r=e,n=this.core.HEAPF32,o=this.nameFlags,d=this.nameWidths,l=this.nameBuffer;for(const a in this.playerData){const e=this.playerData[a];if(!a||250<a||!e||!e.name)continue;const t=this.textures.get(e.name);t&&t.tex&&(d[a]=t.dim[0]/t.dim[1])}for(let _=0;_<r.length;_++){const e=t[_],i=r[_]*this.BYTES_PER_CELL_DATA>>2;if(!d[e]){o[_]=0;continue}o[_]=1;const f=n[i+4],u=n[i+5],p=n[i+6],s=T*d[e]*p,c=-s,h=(v-T)*p,g=(v+T)*p;l[a++]=f+c,l[a++]=u+h,l[a++]=f+s,l[a++]=u+h,l[a++]=f+c,l[a++]=u+g,l[a++]=f+s,l[a++]=u+h,l[a++]=f+c,l[a++]=u+g,l[a++]=f+s,l[a++]=u+g}return a}buildMassVertexBuffer(e,t){var a=Math.round;let r=0;const n=e,o=this.core.HEAPF32,d=this.massCounts,l=this.massWidths,_=this.massBuffer,f=2===this.state.mass;for(let u=0;u<n.length;u++){const e=n[u]*this.BYTES_PER_CELL_DATA>>2,i=t[u];if(!i||250<i){d[u]=0;continue}const p=o[e+4],c=o[e+5],h=o[e+6],s=.01*(h*h),g=f?a(s).toString():1e3<s?(s/1e3).toFixed(1)+"k":a(s).toString();d[u]=g.length;let m=(g.length-1)*A*S;for(let e=0;e<g.length;e++)m+=S*l[g.charCodeAt(e)];let b=-m/2;for(let e=0;e<g.length;e++){const t=g.charCodeAt(e),a=46===t?10:107===t?11:t-48,s=l[t],n=b*h,i=n+S*s*h,o=(+.5*S+k)*h,d=(-.5*S+k)*h;b+=S*s+A,_[r++]=p+n,_[r++]=c+o,_[r++]=(a<<2)+0,_[r++]=p+i,_[r++]=c+o,_[r++]=(a<<2)+1,_[r++]=p+n,_[r++]=c+d,_[r++]=(a<<2)+2,_[r++]=p+i,_[r++]=c+o,_[r++]=(a<<2)+1,_[r++]=p+n,_[r++]=c+d,_[r++]=(a<<2)+2,_[r++]=p+i,_[r++]=c+d,_[r++]=(a<<2)+3}}return r}render(e){if(!this.lastTimestamp)return void(this.lastTimestamp=e);this.fps++;const a=e-this.lastTimestamp;this.lastTimestamp=e,this.protocol.replay.update(a);const s=this.protocol.lastPacket?(e-this.protocol.lastPacket)/this.state.draw:0,{t:n,b:t,l:i,r:o}=this.viewbox,r=!this.state.visible&&!this.protocol.replay.requestPreview;let d=0,l=0;try{const e=this.wasm.update_cells(0,this.INDICES_OFFSET,this.PELLETS_OFFSET,s,n,t,i,o,r);d=e>>16,l=65535&e}catch(t){console.error(t)}if(this.stats.cells=d+l,this.updateTarget(),this.camera.tp?this.teleportCamera():this.lerpCamera(a/this.state.draw),this.checkResolution(),r)return this.updateTextures();const _=this.gl;_.viewport(0,0,_.drawingBufferWidth,_.drawingBufferHeight),this.clearScreen(),this.drawMap(),this.drawPellets(l),this.drawCells(d),this.protocol.replay.savePreview(),this.updateTextures(),this.lastDraw=e}drawMap(){const e=this.gl;this.protocol.map&&(e.useProgram(this.brdr_prog),e.bindVertexArray(this.borderVAO),e.uniform2f(this.getUniform(this.brdr_prog,"u_map"),this.protocol.map.hw,this.protocol.map.hh),e.uniformMatrix4fv(this.getUniform(this.brdr_prog,"u_proj"),!1,this.proj),e.drawArrays(e.TRIANGLES,0,6))}drawPellets(e){if(!e)return;const t=this.gl;let a=this.PELLETS_OFFSET+(e<<1);for(;3&a;)a++;const r=this.wasm.draw_pellets(0,this.PELLETS_OFFSET,e,a),s=a+72*e,n=new Float32Array(this.core.buffer,a,r-a>>2);console.assert(r===s,`Expecting pellet end pointer to be ${s}, but got ${r}`),t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA),t.useProgram(this.prtl_prog),t.uniformMatrix4fv(this.getUniform(this.prtl_prog,"u_proj"),!1,this.proj),t.bindVertexArray(this.pelletVAO),t.bindBuffer(t.ARRAY_BUFFER,this.buffers.get("pellet_buffer")),t.bufferSubData(t.ARRAY_BUFFER,0,n),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,this.circleTextures[0]),t.drawArrays(t.TRIANGLES,0,6*e)}drawCells(e){if(!e)return;const a=this.gl,s=new Uint16Array(this.core.buffer,this.INDICES_OFFSET,e),n=this.INDICES_OFFSET+(e<<1),o=this.core.HEAPU8.subarray(n,n+e);let d=n+e;for(;3&d;)d++;const l=this.wasm.draw_cells(0,this.INDICES_OFFSET,e,d),_=d+48*e;console.assert(l===_,`Expecting cell end pointer to be ${_}, but got ${l}`);let f=e;const u=this.state.skin,p=this.state.name,c=this.state.mass,h=this.circleTextures,g=this.deadCellTexture,m=this.nameFlags,b=this.massCounts,E=this.protocol.pid,w=this.protocol.dualIDs?this.dualTextures[this.protocol.dualIDs.indexOf(this.protocol.pid)]:null;if(m.fill(0),b.fill(0),p||c){const{l:n,r:i,t:r,b:t}=this.viewbox,d=i-n,l=r-t,_=(d<l?d:l)*.03;f=this.wasm.find_text_index(0,this.INDICES_OFFSET,e,_);const u=s.subarray(f,s.length),h=o.subarray(f,o.length);if(p){const e=this.buildNameVertexBuffer(u,h);a.bindBuffer(a.ARRAY_BUFFER,this.buffers.get("name_buffer")),a.bufferSubData(a.ARRAY_BUFFER,0,this.nameBuffer.subarray(0,e))}if(c){const e=this.buildMassVertexBuffer(u,h);a.bindBuffer(a.ARRAY_BUFFER,this.buffers.get("mass_buffer")),a.bufferSubData(a.ARRAY_BUFFER,0,this.massBuffer.subarray(0,e))}}const x=h.length,t=new Float32Array(this.core.buffer,d,12*e),r=this.playerData.map(e=>{if(!e)return null;const t=this.textures.get(e.skin);return t?t.tex:null}),i=p?this.playerData.map(e=>{if(!e)return null;const t=this.textures.get(e.name);return t?t.tex:null}):[];a.useProgram(this.mass_prog),a.uniformMatrix4fv(this.getUniform(this.mass_prog,"u_proj"),!1,this.proj),a.useProgram(this.main_prog),a.uniformMatrix4fv(this.getUniform(this.main_prog,"u_proj"),!1,this.proj),a.bindVertexArray(this.cellVAO),a.bindBuffer(a.ARRAY_BUFFER,this.buffers.get("cell_buffer")),a.bufferSubData(a.ARRAY_BUFFER,0,t),a.activeTexture(a.TEXTURE0);let R=0,T=0;a.blendFunc(a.ONE,a.ONE_MINUS_SRC_ALPHA);for(let s=0;s<e;s++){const e=o[s];253!==e&&(251===e?(a.blendFunc(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA),a.bindTexture(a.TEXTURE_2D,g),a.drawArrays(a.TRIANGLES,6*s,6),a.blendFunc(a.ONE,a.ONE_MINUS_SRC_ALPHA)):(a.bindTexture(a.TEXTURE_2D,h[e%x]),a.drawArrays(a.TRIANGLES,6*s,6))),(u&&r[e]||253===e)&&(a.bindTexture(a.TEXTURE_2D,r[e]),a.drawArrays(a.TRIANGLES,6*s,6)),e===E&&w&&(a.bindTexture(a.TEXTURE_2D,w),a.drawArrays(a.TRIANGLES,6*s,6));const t=s-f;if(0<=t){m[t]&&(a.bindVertexArray(this.nameVAO),a.bindTexture(a.TEXTURE_2D,i[e]),a.drawArrays(a.TRIANGLES,R,6),R+=6);const r=b[t];if(r){a.useProgram(this.mass_prog),a.bindVertexArray(this.massVAO);const e=6*r;a.drawArrays(a.TRIANGLES,T,e),T+=e,a.useProgram(this.main_prog)}a.bindVertexArray(this.cellVAO)}}}serializeState(){return this.core.buffer.slice(this.INDICES_OFFSET,this.wasm.serialize_state(0,this.INDICES_OFFSET))}getClickedPlayerID(){return this.wasm.get_clicked_type(0,this.cursor.position[0],this.cursor.position[1])}updateTextures(){const e=this.gl;if(this.updates.length){e.activeTexture(e.TEXTURE11);for(let e=2;this.updates.length&&e--;){const{id:t,skin:a,name:r}=this.updates.pop(),s=this.playerData[t];if(s&&(this.textures.setData(s.skin,a),this.textures.setData(s.name,r)),2<++e)break}}}clearScreen(){const e=this.gl;e.bindFramebuffer(e.FRAMEBUFFER,null),e.clearColor(0,0,0,1),e.clear(e.COLOR_BUFFER_BIT)}}self.addEventListener("message",async t=>{const{data:e}=t,a=self.r=new L(e.offscreen);a.stats.setBuffer(e.stats),a.mouse.setBuffer(e.mouse),a.state.setBuffer(e.state),a.viewport.setBuffer(e.viewport),await a.initEngine(),self.addEventListener("message",t=>{const e=a.protocol;t.data.connect&&!e.connecting&&e.connect(t.data.connect,t.data.name,t.data.skin1,t.data.skin2),t.data.spawn&&(e.connecting?e.once("protocol",()=>e.spawn(t.data.name,t.data.skin1,t.data.skin2)):e.spawn(t.data.name,t.data.skin1,t.data.skin2)),t.data.chat&&e.sendChat(t.data.chat),t.data.replay&&e.startReplay(t.data.replay),t.data.dual&&a.generateDualTextures(...t.data.dual)}),self.postMessage({event:"ready"})},{once:!0}),t.exports=L},{"./mouse":22,"./protocol":23,"./shaders":26,"./state":27,"./stats":28,"./texture-store":29,"./util":30,"./viewport":31,"./wasm-core":32}],25:[function(e,t){t.exports=()=>new Promise((e,t)=>{const a=indexedDB.open("ogar69-replay");a.onupgradeneeded=t=>{console.log("Creating replay object store");const e=t.target.result;e.createObjectStore("replay-meta"),e.createObjectStore("replay-data")},a.onsuccess=()=>e(a.result),a.onerror=t})},{}],26:[function(e,t){t.exports.SPRITE_VERT_SHADER_SOURCE=`#version 300 es
precision highp float;

uniform mat4 u_proj;
uniform vec2 u_uvs[6];

layout(location=0) in vec2 pos;

out vec2 uv;

void main() {
    gl_Position = u_proj * vec4(pos, 0.0f, 1.0f);
    uv = u_uvs[gl_VertexID % 6];
}
`,t.exports.SPRITE_FRAG_SHADER_SOURCE=`#version 300 es
precision highp float;

uniform sampler2D u_texture;

in vec2 uv;
out vec4 color;

void main() {
    color = texture(u_texture, uv);
}
`,t.exports.PARTICLE_VERT_SHADER_SOURCE=`#version 300 es
precision highp float;

uniform mat4 u_proj;
uniform vec2 u_uvs[6];
uniform vec3 u_colors[$colors$];

layout(location=0) in vec3 pos;

out vec2 uv;
out vec3 fill;

void main() {
    gl_Position = u_proj * vec4(pos.xy, 0.0f, 1.0f);
    fill = u_colors[int(pos.z) % $colors$];
    uv = u_uvs[gl_VertexID % 6];
}
`,t.exports.PARTICLE_FRAG_SHADER_SOURCE=`#version 300 es
precision highp float;

uniform sampler2D u_texture;

in vec2 uv;
in vec3 fill;

out vec4 color;

void main() {
    color = vec4(fill, texture(u_texture, uv).a);
    // color = vec4(uv, 1.0f, 1.0f);
}
`,t.exports.MASS_VERT_SHADER_SOURCE=`#version 300 es
precision highp float;
precision highp int;

uniform mat4 u_proj;
uniform vec2 u_uvs[48];

layout(location=0) in vec3 a_position;

out vec2 v_texcoord;
flat out int character;

void main() {
    vec4 world_pos = vec4(a_position.xy, 0.0, 1.0);
    gl_Position = u_proj * world_pos;
    character = int(a_position.z) >> 2;
    v_texcoord = u_uvs[int(a_position.z)];
}
`,t.exports.MASS_FRAG_PEELING_SHADER_SOURCE=`#version 300 es

precision highp float;
precision highp int;
precision highp sampler2DArray;

uniform sampler2DArray u_mass_char;

in vec2 v_texcoord;
flat in int character;

out vec4 color;

void main() {
    color = texture(u_mass_char, vec3(v_texcoord, character));
}
`,t.exports.BORDER_VERT_SHADER_SOURCE=`#version 300 es
precision highp float;

layout(location=0) in vec2 a_position;
uniform mat4 u_proj;
uniform vec2 u_map;
void main() {
    gl_Position = u_proj * vec4(a_position * u_map, 0.0, 1.0);
}
`,t.exports.BORDER_FRAG_SHADER_SOURCE=`#version 300 es
precision highp float;

uniform vec4 u_color;
out vec4 color;
void main() {
    color = u_color;
}
`},{}],27:[function(e,t){t.exports=class{constructor(){this.setBuffer()}setBuffer(e){e||(self.SharedArrayBuffer?e=new SharedArrayBuffer(200):e=new ArrayBuffer(200)),this.sharedBuffer=e,this.buffer=new Int32Array(this.sharedBuffer)}get resolution(){return[[1920,1080],[1280,720],[854,480]][this.quality]||[1920,1080]}get spectate(){return Atomics.load(this.buffer,0)}set spectate(e){Atomics.store(this.buffer,0,e)}get splits(){return Atomics.load(this.buffer,1)}set splits(e){Atomics.add(this.buffer,1,e)}get ejects(){return Atomics.load(this.buffer,2)}set ejects(e){Atomics.add(this.buffer,2,e)}get macro(){return Atomics.load(this.buffer,3)}set macro(e){Atomics.store(this.buffer,3,e)}get respawn(){return Atomics.load(this.buffer,4)}set respawn(e){Atomics.store(this.buffer,4,e)}get visible(){return Atomics.load(this.buffer,5)}set visible(e){Atomics.store(this.buffer,5,e)}get lineLock(){return Atomics.load(this.buffer,6)}set lineLock(e){Atomics.store(this.buffer,6,e)}get skin(){return Atomics.load(this.buffer,7)}set skin(e){Atomics.store(this.buffer,7,e)}get name(){return Atomics.load(this.buffer,8)}set name(e){Atomics.store(this.buffer,8,e)}get mass(){return Atomics.load(this.buffer,9)}set mass(e){Atomics.store(this.buffer,9,e)}get draw(){return Atomics.load(this.buffer,10)}set draw(e){Atomics.store(this.buffer,10,e)}get zoom(){return Atomics.load(this.buffer,11)}set zoom(e){Atomics.store(this.buffer,11,e)}get auto_respawn(){return Atomics.load(this.buffer,12)}set auto_respawn(e){Atomics.store(this.buffer,12,e)}get clip(){return Atomics.load(this.buffer,13)}set clip(e){Atomics.store(this.buffer,13,e)}get skin_quality(){return Atomics.load(this.buffer,14)}set skin_quality(e){Atomics.store(this.buffer,14,e)}get text_quality(){return Atomics.load(this.buffer,15)}set text_quality(e){Atomics.store(this.buffer,15,e)}get circle_quality(){return Atomics.load(this.buffer,16)}set circle_quality(e){Atomics.store(this.buffer,16,e)}get circle_radius(){return[1024,512,256,128][this.circle_quality]}get skin_dim(){return[1024,512,256,128][this.skin_quality]}get ignore_skin(){return Atomics.load(this.buffer,17)}set ignore_skin(e){Atomics.store(this.buffer,17,e)}get mouse_sync(){return Atomics.load(this.buffer,18)}set mouse_sync(e){Atomics.store(this.buffer,18,e)}get quality(){return Atomics.load(this.buffer,19)}set quality(e){Atomics.store(this.buffer,19,e)}set clicked(e){Atomics.store(this.buffer,20,e)}set s_tab(e){Atomics.store(this.buffer,21,e)}exchange(){return{splits:Atomics.exchange(this.buffer,1,0),ejects:Atomics.exchange(this.buffer,2,0),macro:this.macro,respawn:Atomics.exchange(this.buffer,4,0),lineLock:Atomics.exchange(this.buffer,6,0),clip:Atomics.exchange(this.buffer,13,0),clicked:Atomics.exchange(this.buffer,20,0),switch_tab:Atomics.exchange(this.buffer,21,0)}}}},{}],28:[function(e,t){t.exports=class{constructor(){this.setBuffer()}setBuffer(e){e||(self.SharedArrayBuffer?e=new SharedArrayBuffer(32):e=new ArrayBuffer(32)),this.sharedBuffer=e,this.buffer=new Int32Array(this.sharedBuffer)}get fps(){return Atomics.load(this.buffer,0)}set fps(e){Atomics.store(this.buffer,0,e)}get ping(){return Atomics.load(this.buffer,1)}set ping(e){Atomics.store(this.buffer,1,e)}get cells(){return Atomics.load(this.buffer,2)}set cells(e){Atomics.store(this.buffer,2,e)}get text(){return Atomics.load(this.buffer,3)}set text(e){Atomics.store(this.buffer,3,e)}get bandwidth(){return Atomics.load(this.buffer,4)}set bandwidth(e){Atomics.store(this.buffer,4,e)}get mycells(){return Atomics.load(this.buffer,5)}set mycells(e){Atomics.store(this.buffer,5,e)}get linelocked(){return Atomics.load(this.buffer,6)}set linelocked(e){Atomics.store(this.buffer,6,e)}get score(){return Atomics.load(this.buffer,7)}set score(e){Atomics.store(this.buffer,7,e)}reset(){this.buffer.fill(0)}}},{}],29:[function(e,t){class a{constructor(e,t="",a=!1){this.store=e,this.persist=a,this.key=t,this.tex=null,this.dim=[0,0],this.ref=1}incre(){this.persist||this.ref++}decre(){if(!this.persist)return this.ref--,!!(0>=this.ref)&&this.destroy()}destroy(){return!this.persist&&!!this.tex&&(this.store.gl.deleteTexture(this.tex),this.tex=null,!0)}}t.exports=class{constructor(e){this.renderer=e,this.textures=new Map}get gl(){return this.renderer.gl}add(e="",t=!1){return e?this.textures.has(e)?(this.textures.get(e).incre(),!1):(this.textures.set(e,new a(this,e,t)),!0):void 0}get(e=""){return this.textures.get(e)}setData(e="",t){if(t){const a=this.get(e);if(a){const e=this.gl;e.bindTexture(e.TEXTURE_2D,a.tex=e.createTexture()),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!0),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t),e.generateMipmap(e.TEXTURE_2D),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR_MIPMAP_LINEAR),a.dim=[t.width,t.height]}else console.warn(`Trying to call store.setData on none-existing key: "${e}"`);t.close()}}replace(e="",t=""){if(e!=t)return this.textures.has(e)&&this.textures.get(e).decre()&&this.textures.delete(e),this.add(t)}clear(){for(const[e,t]of[...this.textures.entries()])t.persist||(t.destroy(),this.textures.delete(e))}}},{}],30:[function(e,t){t.exports.pick=e=>e[~~(Math.random()*e.length)],t.exports.makeProgram=(e,t,a)=>{const r=e.createShader(e.VERTEX_SHADER),s=e.createShader(e.FRAGMENT_SHADER);e.shaderSource(r,t),e.shaderSource(s,a),e.compileShader(r),e.compileShader(s);const n=e.createProgram();if(e.attachShader(n,r),e.attachShader(n,s),e.linkProgram(n),!e.getProgramParameter(n,e.LINK_STATUS))throw console.error(`vs info-log: ${e.getShaderInfoLog(r)}\n`+`info-log: ${e.getShaderInfoLog(s)}`),new Error(`prog link failed: ${e.getProgramInfoLog(n)}`);return n},t.exports.COLORS=[[255,0,0],[255,128,0],[255,255,0],[128,255,0],[0,255,0],[0,255,128],[0,255,255],[0,128,255],[127,0,255],[255,0,255],[255,0,127]]},{}],31:[function(e,t){t.exports=class{constructor(){this.setBuffer()}setBuffer(e){e||(self.SharedArrayBuffer?e=new SharedArrayBuffer(8):e=new ArrayBuffer(8)),this.sharedBuffer=e,this.buffer=new Int32Array(this.sharedBuffer)}get width(){return Atomics.load(this.buffer,0)}set width(e){Atomics.store(this.buffer,0,e)}get height(){return Atomics.load(this.buffer,1)}set height(e){Atomics.store(this.buffer,1,e)}}},{}],32:[function(e,t){t.exports=class{constructor(e){this.renderer=e}async load(e=1024){if(this.loading||this.instance)return!1;this.loading=!0;const t=await fetch("/static/wasm/client.wasm"),a=new WebAssembly.Memory({initial:e,maximum:e});return this.instance=await WebAssembly.instantiate(await WebAssembly.compile(await t.arrayBuffer()),{env:{memory:a}}),this.buffer=a.buffer,this.HEAPU8=new Uint8Array(a.buffer),this.HEAPU16=new Uint16Array(a.buffer),this.HEAPF32=new Float32Array(a.buffer),this.HEAPU32=new Uint32Array(a.buffer),this.loading=!1,!0}}},{}]},{},[24]);