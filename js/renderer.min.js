(function(){function s(l,e,r){function t(o,i){if(!e[o]){if(!l[o]){var d="function"==typeof require&&require;if(!i&&d)return d(o,!0);if(n)return n(o,!0);var _=new Error("Cannot find module '"+o+"'");throw _.code="MODULE_NOT_FOUND",_}var a=e[o]={exports:{}};l[o][0].call(a.exports,function(e){var a=l[o][1][e];return t(a||e)},a,a.exports,s,l,e,r)}return e[o].exports}for(var n="function"==typeof require&&require,a=0;a<r.length;a++)t(r[a]);return t}return s})()({1:[function(e,t){'use strict';function a(e){console&&console.warn&&console.warn(e)}function r(){r.init.call(this)}function s(e){if("function"!=typeof e)throw new TypeError("The \"listener\" argument must be of type Function. Received type "+typeof e)}function n(e){return void 0===e._maxListeners?r.defaultMaxListeners:e._maxListeners}function i(e,t,r,i){var o,l,d;if(s(r),l=e._events,void 0===l?(l=e._events=Object.create(null),e._eventsCount=0):(void 0!==l.newListener&&(e.emit("newListener",t,r.listener?r.listener:r),l=e._events),d=l[t]),void 0===d)d=l[t]=r,++e._eventsCount;else if("function"==typeof d?d=l[t]=i?[r,d]:[d,r]:i?d.unshift(r):d.push(r),o=n(e),0<o&&d.length>o&&!d.warned){d.warned=!0;var _=new Error("Possible EventEmitter memory leak detected. "+d.length+" "+(t+" listeners added. Use emitter.setMaxListeners() to increase limit"));_.name="MaxListenersExceededWarning",_.emitter=e,_.type=t,_.count=d.length,a(_)}return e}function o(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function l(e,t,a){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:a},s=o.bind(r);return s.listener=a,r.wrapFn=s,s}function d(e,t,a){var r=e._events;if(r===void 0)return[];var s=r[t];return void 0===s?[]:"function"==typeof s?a?[s.listener||s]:[s]:a?c(s):f(s,s.length)}function _(e){var t=this._events;if(t!==void 0){var a=t[e];if("function"==typeof a)return 1;if(void 0!==a)return a.length}return 0}function f(e,t){for(var a=Array(t),r=0;r<t;++r)a[r]=e[r];return a}function u(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}function c(e){for(var t=Array(e.length),a=0;a<t.length;++a)t[a]=e[a].listener||e[a];return t}var p,h="object"==typeof Reflect?Reflect:null,m=h&&"function"==typeof h.apply?h.apply:function(e,t,a){return Function.prototype.apply.call(e,t,a)};p=h&&"function"==typeof h.ownKeys?h.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var g=Number.isNaN||function(e){return e!==e};t.exports=r,t.exports.once=function(e,t){return new Promise(function(a,r){function s(){n!==void 0&&e.removeListener("error",n),a([].slice.call(arguments))}var n;"error"!==t&&(n=function(a){e.removeListener(t,s),r(a)},e.once("error",n)),e.once(t,s)})},r.EventEmitter=r,r.prototype._events=void 0,r.prototype._eventsCount=0,r.prototype._maxListeners=void 0;var b=10;Object.defineProperty(r,"defaultMaxListeners",{enumerable:!0,get:function(){return b},set:function(e){if("number"!=typeof e||0>e||g(e))throw new RangeError("The value of \"defaultMaxListeners\" is out of range. It must be a non-negative number. Received "+e+".");b=e}}),r.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},r.prototype.setMaxListeners=function(e){if("number"!=typeof e||0>e||g(e))throw new RangeError("The value of \"n\" is out of range. It must be a non-negative number. Received "+e+".");return this._maxListeners=e,this},r.prototype.getMaxListeners=function(){return n(this)},r.prototype.emit=function(e){for(var t=[],a=1;a<arguments.length;a++)t.push(arguments[a]);var r="error"===e,s=this._events;if(s!==void 0)r=r&&s.error===void 0;else if(!r)return!1;if(r){var n;if(0<t.length&&(n=t[0]),n instanceof Error)throw n;var o=new Error("Unhandled error."+(n?" ("+n.message+")":""));throw o.context=n,o}var l=s[e];if(l===void 0)return!1;if("function"==typeof l)m(l,this,t);else for(var d=l.length,_=f(l,d),a=0;a<d;++a)m(_[a],this,t);return!0},r.prototype.addListener=function(e,t){return i(this,e,t,!1)},r.prototype.on=r.prototype.addListener,r.prototype.prependListener=function(e,t){return i(this,e,t,!0)},r.prototype.once=function(e,t){return s(t),this.on(e,l(this,e,t)),this},r.prototype.prependOnceListener=function(e,t){return s(t),this.prependListener(e,l(this,e,t)),this},r.prototype.removeListener=function(e,t){var a,r,n,o,l;if(s(t),r=this._events,void 0===r)return this;if(a=r[e],void 0===a)return this;if(a===t||a.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,a.listener||t));else if("function"!=typeof a){for(n=-1,o=a.length-1;0<=o;o--)if(a[o]===t||a[o].listener===t){l=a[o].listener,n=o;break}if(0>n)return this;0===n?a.shift():u(a,n),1===a.length&&(r[e]=a[0]),void 0!==r.removeListener&&this.emit("removeListener",e,l||t)}return this},r.prototype.off=r.prototype.removeListener,r.prototype.removeAllListeners=function(e){var t,a,r;if(a=this._events,void 0===a)return this;if(void 0===a.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==a[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete a[e]),this;if(0===arguments.length){var s,n=Object.keys(a);for(r=0;r<n.length;++r)s=n[r],"removeListener"!==s&&this.removeAllListeners(s);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(t=a[e],"function"==typeof t)this.removeListener(e,t);else if(void 0!==t)for(r=t.length-1;0<=r;r--)this.removeListener(e,t[r]);return this},r.prototype.listeners=function(e){return d(this,e,!0)},r.prototype.rawListeners=function(e){return d(this,e,!1)},r.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):_.call(e,t)},r.prototype.listenerCount=_,r.prototype.eventNames=function(){return 0<this._eventsCount?p(this._events):[]}},{}],2:[function(e,t){'use strict';const{Deflate:a,deflate:r,deflateRaw:s,gzip:n}=e("./lib/deflate"),{Inflate:i,inflate:o,inflateRaw:l,ungzip:d}=e("./lib/inflate"),_=e("./lib/zlib/constants");t.exports.Deflate=a,t.exports.deflate=r,t.exports.deflateRaw=s,t.exports.gzip=n,t.exports.Inflate=i,t.exports.inflate=o,t.exports.inflateRaw=l,t.exports.ungzip=d,t.exports.constants=_},{"./lib/deflate":3,"./lib/inflate":4,"./lib/zlib/constants":8}],3:[function(e,t){'use strict';function a(e){this.options=n.assign({level:m,method:b,chunkSize:16384,windowBits:15,memLevel:8,strategy:g},e||{});let t=this.options;t.raw&&0<t.windowBits?t.windowBits=-t.windowBits:t.gzip&&0<t.windowBits&&16>t.windowBits&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;let a=s.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(a!==p)throw new Error(o[a]);if(t.header&&s.deflateSetHeader(this.strm,t.header),t.dictionary){let e;if(e="string"==typeof t.dictionary?i.string2buf(t.dictionary):"[object ArrayBuffer]"===d.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,a=s.deflateSetDictionary(this.strm,e),a!==p)throw new Error(o[a]);this._dict_set=!0}}function r(e,t){const r=new a(t);if(r.push(e,!0),r.err)throw r.msg||o[r.err];return r.result}const s=e("./zlib/deflate"),n=e("./utils/common"),i=e("./utils/strings"),o=e("./zlib/messages"),l=e("./zlib/zstream"),d=Object.prototype.toString,{Z_NO_FLUSH:_,Z_SYNC_FLUSH:f,Z_FULL_FLUSH:u,Z_FINISH:c,Z_OK:p,Z_STREAM_END:h,Z_DEFAULT_COMPRESSION:m,Z_DEFAULT_STRATEGY:g,Z_DEFLATED:b}=e("./zlib/constants");a.prototype.push=function(e,t){const a=this.strm,r=this.options.chunkSize;let n,o;if(this.ended)return!1;for(o=t===~~t?t:!0===t?c:_,a.input="string"==typeof e?i.string2buf(e):"[object ArrayBuffer]"===d.call(e)?new Uint8Array(e):e,a.next_in=0,a.avail_in=a.input.length;;){if(0===a.avail_out&&(a.output=new Uint8Array(r),a.next_out=0,a.avail_out=r),(o===f||o===u)&&6>=a.avail_out){this.onData(a.output.subarray(0,a.next_out)),a.avail_out=0;continue}if(n=s.deflate(a,o),n===h)return 0<a.next_out&&this.onData(a.output.subarray(0,a.next_out)),n=s.deflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===p;if(0===a.avail_out){this.onData(a.output);continue}if(0<o&&0<a.next_out){this.onData(a.output.subarray(0,a.next_out)),a.avail_out=0;continue}if(0===a.avail_in)break}return!0},a.prototype.onData=function(e){this.chunks.push(e)},a.prototype.onEnd=function(e){e===p&&(this.result=n.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},t.exports.Deflate=a,t.exports.deflate=r,t.exports.deflateRaw=function(e,t){return t=t||{},t.raw=!0,r(e,t)},t.exports.gzip=function(e,t){return t=t||{},t.gzip=!0,r(e,t)},t.exports.constants=e("./zlib/constants")},{"./utils/common":5,"./utils/strings":6,"./zlib/constants":8,"./zlib/deflate":10,"./zlib/messages":15,"./zlib/zstream":17}],4:[function(e,t){'use strict';function a(e){this.options=n.assign({chunkSize:65536,windowBits:15,to:""},e||{});const t=this.options;t.raw&&0<=t.windowBits&&16>t.windowBits&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),0<=t.windowBits&&16>t.windowBits&&!(e&&e.windowBits)&&(t.windowBits+=32),15<t.windowBits&&48>t.windowBits&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;let a=s.inflateInit2(this.strm,t.windowBits);if(a!==c)throw new Error(o[a]);if(this.header=new d,s.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=i.string2buf(t.dictionary):"[object ArrayBuffer]"===_.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(a=s.inflateSetDictionary(this.strm,t.dictionary),a!==c)))throw new Error(o[a])}function r(e,t){const r=new a(t);if(r.push(e),r.err)throw r.msg||o[r.err];return r.result}const s=e("./zlib/inflate"),n=e("./utils/common"),i=e("./utils/strings"),o=e("./zlib/messages"),l=e("./zlib/zstream"),d=e("./zlib/gzheader"),_=Object.prototype.toString,{Z_NO_FLUSH:f,Z_FINISH:u,Z_OK:c,Z_STREAM_END:p,Z_NEED_DICT:h,Z_STREAM_ERROR:m,Z_DATA_ERROR:g,Z_MEM_ERROR:b}=e("./zlib/constants");a.prototype.push=function(e,t){const a=this.strm,r=this.options.chunkSize,n=this.options.dictionary;let o,l,d;if(this.ended)return!1;for(l=t===~~t?t:!0===t?u:f,a.input="[object ArrayBuffer]"===_.call(e)?new Uint8Array(e):e,a.next_in=0,a.avail_in=a.input.length;;){for(0===a.avail_out&&(a.output=new Uint8Array(r),a.next_out=0,a.avail_out=r),o=s.inflate(a,l),o===h&&n&&(o=s.inflateSetDictionary(a,n),o===c?o=s.inflate(a,l):o===g&&(o=h));0<a.avail_in&&o===p&&0<a.state.wrap&&0!==e[a.next_in];)s.inflateReset(a),o=s.inflate(a,l);switch(o){case m:case g:case h:case b:return this.onEnd(o),this.ended=!0,!1;}if(d=a.avail_out,a.next_out&&(0===a.avail_out||o===p))if("string"===this.options.to){let e=i.utf8border(a.output,a.next_out),t=a.next_out-e,s=i.buf2string(a.output,e);a.next_out=t,a.avail_out=r-t,t&&a.output.set(a.output.subarray(e,e+t),0),this.onData(s)}else this.onData(a.output.length===a.next_out?a.output:a.output.subarray(0,a.next_out));if(o!==c||0!==d){if(o===p)return o=s.inflateEnd(this.strm),this.onEnd(o),this.ended=!0,!0;if(0===a.avail_in)break}}return!0},a.prototype.onData=function(e){this.chunks.push(e)},a.prototype.onEnd=function(e){e===c&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=n.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},t.exports.Inflate=a,t.exports.inflate=r,t.exports.inflateRaw=function(e,t){return t=t||{},t.raw=!0,r(e,t)},t.exports.ungzip=r,t.exports.constants=e("./zlib/constants")},{"./utils/common":5,"./utils/strings":6,"./zlib/constants":8,"./zlib/gzheader":11,"./zlib/inflate":13,"./zlib/messages":15,"./zlib/zstream":17}],5:[function(e,t){'use strict';const a=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);t.exports.assign=function(e){for(const t=Array.prototype.slice.call(arguments,1);t.length;){const r=t.shift();if(r){if("object"!=typeof r)throw new TypeError(r+"must be non-object");for(const t in r)a(r,t)&&(e[t]=r[t])}}return e},t.exports.flattenChunks=e=>{let t=0;for(let a=0,r=e.length;a<r;a++)t+=e[a].length;const a=new Uint8Array(t);for(let t,r=0,s=0,n=e.length;r<n;r++)t=e[r],a.set(t,s),s+=t.length;return a}},{}],6:[function(e,t){'use strict';var a=String.fromCharCode;let r=!0;try{a.apply(null,new Uint8Array(1))}catch(e){r=!1}const s=new Uint8Array(256);for(let a=0;256>a;a++)s[a]=252<=a?6:248<=a?5:240<=a?4:224<=a?3:192<=a?2:1;s[254]=s[254]=1,t.exports.string2buf=e=>{let t,a,r,s,n,o=e.length,l=0;for(s=0;s<o;s++)a=e.charCodeAt(s),55296==(64512&a)&&s+1<o&&(r=e.charCodeAt(s+1),56320==(64512&r)&&(a=65536+(a-55296<<10)+(r-56320),s++)),l+=128>a?1:2048>a?2:65536>a?3:4;for(t=new Uint8Array(l),n=0,s=0;n<l;s++)a=e.charCodeAt(s),55296==(64512&a)&&s+1<o&&(r=e.charCodeAt(s+1),56320==(64512&r)&&(a=65536+(a-55296<<10)+(r-56320),s++)),128>a?t[n++]=a:2048>a?(t[n++]=192|a>>>6,t[n++]=128|63&a):65536>a?(t[n++]=224|a>>>12,t[n++]=128|63&a>>>6,t[n++]=128|63&a):(t[n++]=240|a>>>18,t[n++]=128|63&a>>>12,t[n++]=128|63&a>>>6,t[n++]=128|63&a);return t};const n=(e,t)=>{if(65534>t&&e.subarray&&r)return a.apply(null,e.length===t?e:e.subarray(0,t));let s="";for(let r=0;r<t;r++)s+=a(e[r]);return s};t.exports.buf2string=(e,t)=>{let a,r;const o=t||e.length,l=Array(2*o);for(r=0,a=0;a<o;){let t=e[a++];if(128>t){l[r++]=t;continue}let n=s[t];if(4<n){l[r++]=65533,a+=n-1;continue}for(t&=2===n?31:3===n?15:7;1<n&&a<o;)t=t<<6|63&e[a++],n--;if(1<n){l[r++]=65533;continue}65536>t?l[r++]=t:(t-=65536,l[r++]=55296|1023&t>>10,l[r++]=56320|1023&t)}return n(l,r)},t.exports.utf8border=(e,t)=>{t=t||e.length,t>e.length&&(t=e.length);let a=t-1;for(;0<=a&&128==(192&e[a]);)a--;return 0>a?t:0==a?t:a+s[e[a]]>t?a:t}},{}],7:[function(e,t){'use strict';t.exports=(e,t,a,r)=>{let s=0|65535&e,i=0|65535&e>>>16,o=0;for(;0!==a;){o=2e3<a?2e3:a,a-=o;do s=0|s+t[r++],i=0|i+s;while(--o);s%=65521,i%=65521}return 0|(s|i<<16)}},{}],8:[function(e,t){'use strict';t.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],9:[function(e,t){'use strict';const a=new Uint32Array((()=>{let e,t=[];for(var a=0;256>a;a++){e=a;for(var r=0;8>r;r++)e=1&e?3988292384^e>>>1:e>>>1;t[a]=e}return t})());t.exports=(e,t,r,s)=>{e^=-1;for(let n=s;n<s+r;n++)e=e>>>8^a[255&(e^t[n])];return-1^e}},{}],10:[function(e,t){'use strict';function a(e,t,a,r,s){this.good_length=e,this.max_lazy=t,this.nice_length=a,this.max_chain=r,this.func=s}function r(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=k,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),V(this.dyn_ltree),V(this.dyn_dtree),V(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),V(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),V(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const{_tr_init:n,_tr_stored_block:i,_tr_flush_block:o,_tr_tally:l,_tr_align:d}=e("./trees"),_=e("./adler32"),f=e("./crc32"),u=e("./messages"),{Z_NO_FLUSH:c,Z_PARTIAL_FLUSH:p,Z_FULL_FLUSH:h,Z_FINISH:m,Z_BLOCK:g,Z_OK:b,Z_STREAM_END:E,Z_STREAM_ERROR:R,Z_DATA_ERROR:w,Z_BUF_ERROR:T,Z_DEFAULT_COMPRESSION:x,Z_FILTERED:A,Z_HUFFMAN_ONLY:v,Z_RLE:y,Z_FIXED:U,Z_DEFAULT_STRATEGY:B,Z_UNKNOWN:F,Z_DEFLATED:k}=e("./constants"),L=3,D=258,S=D+L+1,O=42,C=69,I=73,z=91,N=103,M=113,P=666,H=1,X=2,G=3,Z=4,Y=(e,t)=>(e.msg=u[t],t),W=e=>(e<<1)-(4<e?9:0),V=e=>{for(let t=e.length;0<=--t;)e[t]=0};let j=(e,t,a)=>(t<<e.hash_shift^a)&e.hash_mask;const K=e=>{const t=e.state;let a=t.pending;a>e.avail_out&&(a=e.avail_out);0===a||(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+a),e.next_out),e.next_out+=a,t.pending_out+=a,e.total_out+=a,e.avail_out-=a,t.pending-=a,0===t.pending&&(t.pending_out=0))},q=(e,t)=>{o(e,0<=e.block_start?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,K(e.strm)},Q=(e,t)=>{e.pending_buf[e.pending++]=t},J=(e,t)=>{e.pending_buf[e.pending++]=255&t>>>8,e.pending_buf[e.pending++]=255&t},$=(e,t,a,r)=>{let s=e.avail_in;return(s>r&&(s=r),0===s)?0:(e.avail_in-=s,t.set(e.input.subarray(e.next_in,e.next_in+s),a),1===e.state.wrap?e.adler=_(e.adler,t,s,a):2===e.state.wrap&&(e.adler=f(e.adler,t,s,a)),e.next_in+=s,e.total_in+=s,s)},ee=(e,t)=>{let a,r,s=e.max_chain_length,n=e.strstart,i=e.prev_length,o=e.nice_match;const l=e.strstart>e.w_size-S?e.strstart-(e.w_size-S):0,d=e.window,_=e.w_mask,f=e.prev,u=e.strstart+D;let c=d[n+i-1],p=d[n+i];e.prev_length>=e.good_match&&(s>>=2),o>e.lookahead&&(o=e.lookahead);do{if(a=t,d[a+i]!==p||d[a+i-1]!==c||d[a]!==d[n]||d[++a]!==d[n+1])continue;n+=2,a++;do;while(d[++n]===d[++a]&&d[++n]===d[++a]&&d[++n]===d[++a]&&d[++n]===d[++a]&&d[++n]===d[++a]&&d[++n]===d[++a]&&d[++n]===d[++a]&&d[++n]===d[++a]&&n<u);if(r=D-(u-n),n=u-D,r>i){if(e.match_start=t,i=r,r>=o)break;c=d[n+i-1],p=d[n+i]}}while((t=f[t&_])>l&&0!=--s);return i<=e.lookahead?i:e.lookahead},te=e=>{const t=e.w_size;let a,r,s,i,o;do{if(i=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-S)){e.window.set(e.window.subarray(t,t+t),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,r=e.hash_size,a=r;do s=e.head[--a],e.head[a]=s>=t?s-t:0;while(--r);r=t,a=r;do s=e.prev[--a],e.prev[a]=s>=t?s-t:0;while(--r);i+=t}if(0===e.strm.avail_in)break;if(r=$(e.strm,e.window,e.strstart+e.lookahead,i),e.lookahead+=r,e.lookahead+e.insert>=L)for(o=e.strstart-e.insert,e.ins_h=e.window[o],e.ins_h=j(e,e.ins_h,e.window[o+1]);e.insert&&(e.ins_h=j(e,e.ins_h,e.window[o+L-1]),e.prev[o&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=o,o++,e.insert--,!(e.lookahead+e.insert<L)););}while(e.lookahead<S&&0!==e.strm.avail_in)},ae=(e,t)=>{let a,r;for(;;){if(e.lookahead<S){if(te(e),e.lookahead<S&&t===c)return H;if(0===e.lookahead)break}if(a=0,e.lookahead>=L&&(e.ins_h=j(e,e.ins_h,e.window[e.strstart+L-1]),a=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==a&&e.strstart-a<=e.w_size-S&&(e.match_length=ee(e,a)),!(e.match_length>=L))r=l(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;else if(r=l(e,e.strstart-e.match_start,e.match_length-L),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=L){e.match_length--;do e.strstart++,e.ins_h=j(e,e.ins_h,e.window[e.strstart+L-1]),a=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart;while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=j(e,e.ins_h,e.window[e.strstart+1]);if(r&&(q(e,!1),0===e.strm.avail_out))return H}return e.insert=e.strstart<L-1?e.strstart:L-1,t===m?(q(e,!0),0===e.strm.avail_out?G:Z):e.last_lit&&(q(e,!1),0===e.strm.avail_out)?H:X},re=(e,t)=>{let a,r,s;for(;;){if(e.lookahead<S){if(te(e),e.lookahead<S&&t===c)return H;if(0===e.lookahead)break}if(a=0,e.lookahead>=L&&(e.ins_h=j(e,e.ins_h,e.window[e.strstart+L-1]),a=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=L-1,0!==a&&e.prev_length<e.max_lazy_match&&e.strstart-a<=e.w_size-S&&(e.match_length=ee(e,a),5>=e.match_length&&(e.strategy===A||e.match_length===L&&4096<e.strstart-e.match_start)&&(e.match_length=L-1)),e.prev_length>=L&&e.match_length<=e.prev_length){s=e.strstart+e.lookahead-L,r=l(e,e.strstart-1-e.prev_match,e.prev_length-L),e.lookahead-=e.prev_length-1,e.prev_length-=2;do++e.strstart<=s&&(e.ins_h=j(e,e.ins_h,e.window[e.strstart+L-1]),a=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart);while(0!=--e.prev_length);if(e.match_available=0,e.match_length=L-1,e.strstart++,r&&(q(e,!1),0===e.strm.avail_out))return H}else if(!e.match_available)e.match_available=1,e.strstart++,e.lookahead--;else if(r=l(e,0,e.window[e.strstart-1]),r&&q(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return H}return e.match_available&&(r=l(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<L-1?e.strstart:L-1,t===m?(q(e,!0),0===e.strm.avail_out?G:Z):e.last_lit&&(q(e,!1),0===e.strm.avail_out)?H:X},se=(e,t)=>{let a,r,s,n;for(const i=e.window;;){if(e.lookahead<=D){if(te(e),e.lookahead<=D&&t===c)return H;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=L&&0<e.strstart&&(s=e.strstart-1,r=i[s],r===i[++s]&&r===i[++s]&&r===i[++s])){n=e.strstart+D;do;while(r===i[++s]&&r===i[++s]&&r===i[++s]&&r===i[++s]&&r===i[++s]&&r===i[++s]&&r===i[++s]&&r===i[++s]&&s<n);e.match_length=D-(n-s),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=L?(a=l(e,1,e.match_length-L),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(a=l(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),a&&(q(e,!1),0===e.strm.avail_out))return H}return e.insert=0,t===m?(q(e,!0),0===e.strm.avail_out?G:Z):e.last_lit&&(q(e,!1),0===e.strm.avail_out)?H:X},ne=(e,t)=>{for(let a;;){if(0===e.lookahead&&(te(e),0===e.lookahead)){if(t===c)return H;break}if(e.match_length=0,a=l(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,a&&(q(e,!1),0===e.strm.avail_out))return H}return e.insert=0,t===m?(q(e,!0),0===e.strm.avail_out?G:Z):e.last_lit&&(q(e,!1),0===e.strm.avail_out)?H:X},ie=[new a(0,0,0,0,(e,t)=>{let a=65535;for(a>e.pending_buf_size-5&&(a=e.pending_buf_size-5);;){if(1>=e.lookahead){if(te(e),0===e.lookahead&&t===c)return H;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;const r=e.block_start+a;if((0===e.strstart||e.strstart>=r)&&(e.lookahead=e.strstart-r,e.strstart=r,q(e,!1),0===e.strm.avail_out))return H;if(e.strstart-e.block_start>=e.w_size-S&&(q(e,!1),0===e.strm.avail_out))return H}return e.insert=0,t===m?(q(e,!0),0===e.strm.avail_out?G:Z):e.strstart>e.block_start&&(q(e,!1),0===e.strm.avail_out)?H:H}),new a(4,4,8,4,ae),new a(4,5,16,8,ae),new a(4,6,32,32,ae),new a(4,4,16,16,re),new a(8,16,32,32,re),new a(8,16,128,128,re),new a(8,32,128,256,re),new a(32,128,258,1024,re),new a(32,258,258,4096,re)],oe=e=>{e.window_size=2*e.w_size,V(e.head),e.max_lazy_match=ie[e.level].max_lazy,e.good_match=ie[e.level].good_length,e.nice_match=ie[e.level].nice_length,e.max_chain_length=ie[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=L-1,e.match_available=0,e.ins_h=0},le=e=>{if(!e||!e.state)return Y(e,R);e.total_in=e.total_out=0,e.data_type=F;const t=e.state;return t.pending=0,t.pending_out=0,0>t.wrap&&(t.wrap=-t.wrap),t.status=t.wrap?O:M,e.adler=2===t.wrap?0:1,t.last_flush=c,n(t),b},de=e=>{const t=le(e);return t===b&&oe(e.state),t},_e=(e,t,a,n,i,o)=>{if(!e)return R;let l=1;if(t===x&&(t=6),0>n?(l=0,n=-n):15<n&&(l=2,n-=16),1>i||i>9||a!==k||8>n||15<n||0>t||9<t||0>o||o>U)return Y(e,R);8===n&&(n=9);const d=new r;return e.state=d,d.strm=e,d.wrap=l,d.gzhead=null,d.w_bits=n,d.w_size=1<<d.w_bits,d.w_mask=d.w_size-1,d.hash_bits=i+7,d.hash_size=1<<d.hash_bits,d.hash_mask=d.hash_size-1,d.hash_shift=~~((d.hash_bits+L-1)/L),d.window=new Uint8Array(2*d.w_size),d.head=new Uint16Array(d.hash_size),d.prev=new Uint16Array(d.w_size),d.lit_bufsize=1<<i+6,d.pending_buf_size=4*d.lit_bufsize,d.pending_buf=new Uint8Array(d.pending_buf_size),d.d_buf=1*d.lit_bufsize,d.l_buf=3*d.lit_bufsize,d.level=t,d.strategy=o,d.method=a,de(e)};t.exports.deflateInit=(e,t)=>_e(e,t,k,15,8,B),t.exports.deflateInit2=_e,t.exports.deflateReset=de,t.exports.deflateResetKeep=le,t.exports.deflateSetHeader=(e,t)=>e&&e.state?2===e.state.wrap?(e.state.gzhead=t,b):R:R,t.exports.deflate=(e,t)=>{let a,r;if(!e||!e.state||t>g||0>t)return e?Y(e,R):R;const n=e.state;if(!e.output||!e.input&&0!==e.avail_in||n.status===P&&t!==m)return Y(e,0===e.avail_out?T:R);n.strm=e;const s=n.last_flush;if(n.last_flush=t,n.status===O)if(2===n.wrap)e.adler=0,Q(n,31),Q(n,139),Q(n,8),n.gzhead?(Q(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),Q(n,255&n.gzhead.time),Q(n,255&n.gzhead.time>>8),Q(n,255&n.gzhead.time>>16),Q(n,255&n.gzhead.time>>24),Q(n,9===n.level?2:n.strategy>=v||2>n.level?4:0),Q(n,255&n.gzhead.os),n.gzhead.extra&&n.gzhead.extra.length&&(Q(n,255&n.gzhead.extra.length),Q(n,255&n.gzhead.extra.length>>8)),n.gzhead.hcrc&&(e.adler=f(e.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=C):(Q(n,0),Q(n,0),Q(n,0),Q(n,0),Q(n,0),Q(n,9===n.level?2:n.strategy>=v||2>n.level?4:0),Q(n,3),n.status=M);else{let t=k+(n.w_bits-8<<4)<<8,a=-1;a=n.strategy>=v||2>n.level?0:6>n.level?1:6===n.level?2:3,t|=a<<6,0!==n.strstart&&(t|=32),t+=31-t%31,n.status=M,J(n,t),0!==n.strstart&&(J(n,e.adler>>>16),J(n,65535&e.adler)),e.adler=1}if(n.status===C)if(n.gzhead.extra){for(a=n.pending;n.gzindex<(65535&n.gzhead.extra.length)&&!(n.pending===n.pending_buf_size&&(n.gzhead.hcrc&&n.pending>a&&(e.adler=f(e.adler,n.pending_buf,n.pending-a,a)),K(e),a=n.pending,n.pending===n.pending_buf_size));)Q(n,255&n.gzhead.extra[n.gzindex]),n.gzindex++;n.gzhead.hcrc&&n.pending>a&&(e.adler=f(e.adler,n.pending_buf,n.pending-a,a)),n.gzindex===n.gzhead.extra.length&&(n.gzindex=0,n.status=I)}else n.status=I;if(n.status===I)if(n.gzhead.name){a=n.pending;do{if(n.pending===n.pending_buf_size&&(n.gzhead.hcrc&&n.pending>a&&(e.adler=f(e.adler,n.pending_buf,n.pending-a,a)),K(e),a=n.pending,n.pending===n.pending_buf_size)){r=1;break}r=n.gzindex<n.gzhead.name.length?255&n.gzhead.name.charCodeAt(n.gzindex++):0,Q(n,r)}while(0!==r);n.gzhead.hcrc&&n.pending>a&&(e.adler=f(e.adler,n.pending_buf,n.pending-a,a)),0===r&&(n.gzindex=0,n.status=z)}else n.status=z;if(n.status===z)if(n.gzhead.comment){a=n.pending;do{if(n.pending===n.pending_buf_size&&(n.gzhead.hcrc&&n.pending>a&&(e.adler=f(e.adler,n.pending_buf,n.pending-a,a)),K(e),a=n.pending,n.pending===n.pending_buf_size)){r=1;break}r=n.gzindex<n.gzhead.comment.length?255&n.gzhead.comment.charCodeAt(n.gzindex++):0,Q(n,r)}while(0!==r);n.gzhead.hcrc&&n.pending>a&&(e.adler=f(e.adler,n.pending_buf,n.pending-a,a)),0===r&&(n.status=N)}else n.status=N;if(n.status===N&&(n.gzhead.hcrc?(n.pending+2>n.pending_buf_size&&K(e),n.pending+2<=n.pending_buf_size&&(Q(n,255&e.adler),Q(n,255&e.adler>>8),e.adler=0,n.status=M)):n.status=M),0!==n.pending){if(K(e),0===e.avail_out)return n.last_flush=-1,b;}else if(0===e.avail_in&&W(t)<=W(s)&&t!==m)return Y(e,T);if(n.status===P&&0!==e.avail_in)return Y(e,T);if(0!==e.avail_in||0!==n.lookahead||t!==c&&n.status!==P){let a=n.strategy===v?ne(n,t):n.strategy===y?se(n,t):ie[n.level].func(n,t);if((a===G||a===Z)&&(n.status=P),a===H||a===G)return 0===e.avail_out&&(n.last_flush=-1),b;if(a===X&&(t===p?d(n):t!==g&&(i(n,0,0,!1),t===h&&(V(n.head),0===n.lookahead&&(n.strstart=0,n.block_start=0,n.insert=0))),K(e),0===e.avail_out))return n.last_flush=-1,b}return t===m?0>=n.wrap?E:(2===n.wrap?(Q(n,255&e.adler),Q(n,255&e.adler>>8),Q(n,255&e.adler>>16),Q(n,255&e.adler>>24),Q(n,255&e.total_in),Q(n,255&e.total_in>>8),Q(n,255&e.total_in>>16),Q(n,255&e.total_in>>24)):(J(n,e.adler>>>16),J(n,65535&e.adler)),K(e),0<n.wrap&&(n.wrap=-n.wrap),0===n.pending?E:b):b},t.exports.deflateEnd=e=>{if(!e||!e.state)return R;const t=e.state.status;return t!==O&&t!==C&&t!==I&&t!==z&&t!==N&&t!==M&&t!==P?Y(e,R):(e.state=null,t===M?Y(e,w):b)},t.exports.deflateSetDictionary=(e,t)=>{let a=t.length;if(!e||!e.state)return R;const r=e.state,s=r.wrap;if(2===s||1===s&&r.status!==O||r.lookahead)return R;if(1===s&&(e.adler=_(e.adler,t,a,0)),r.wrap=0,a>=r.w_size){0===s&&(V(r.head),r.strstart=0,r.block_start=0,r.insert=0);let e=new Uint8Array(r.w_size);e.set(t.subarray(a-r.w_size,a),0),t=e,a=r.w_size}const n=e.avail_in,i=e.next_in,o=e.input;for(e.avail_in=a,e.next_in=0,e.input=t,te(r);r.lookahead>=L;){let e=r.strstart,t=r.lookahead-(L-1);do r.ins_h=j(r,r.ins_h,r.window[e+L-1]),r.prev[e&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=e,e++;while(--t);r.strstart=e,r.lookahead=L-1,te(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=L-1,r.match_available=0,e.next_in=i,e.input=o,e.avail_in=n,r.wrap=s,b},t.exports.deflateInfo="pako deflate (from Nodeca project)"},{"./adler32":7,"./constants":8,"./crc32":9,"./messages":15,"./trees":16}],11:[function(e,t){'use strict';t.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],12:[function(e,t){'use strict';const a=30;t.exports=function(e,t){let r,s,n,i,o,l,d,_,f,u,c,p,h,m,g,b,E,R,w,T,x,A,v,y;const U=e.state;r=e.next_in,v=e.input,s=r+(e.avail_in-5),n=e.next_out,y=e.output,i=n-(t-e.avail_out),o=n+(e.avail_out-257),l=U.dmax,d=U.wsize,_=U.whave,f=U.wnext,u=U.window,c=U.hold,p=U.bits,h=U.lencode,m=U.distcode,g=(1<<U.lenbits)-1,b=(1<<U.distbits)-1;top:do{15>p&&(c+=v[r++]<<p,p+=8,c+=v[r++]<<p,p+=8),E=h[c&g];dolen:for(;;){if(R=E>>>24,c>>>=R,p-=R,R=255&E>>>16,0===R)y[n++]=65535&E;else if(16&R){w=65535&E,R&=15,R&&(p<R&&(c+=v[r++]<<p,p+=8),w+=c&(1<<R)-1,c>>>=R,p-=R),15>p&&(c+=v[r++]<<p,p+=8,c+=v[r++]<<p,p+=8),E=m[c&b];dodist:for(;;){if(R=E>>>24,c>>>=R,p-=R,R=255&E>>>16,16&R){if(T=65535&E,R&=15,p<R&&(c+=v[r++]<<p,p+=8,p<R&&(c+=v[r++]<<p,p+=8)),T+=c&(1<<R)-1,T>l){e.msg="invalid distance too far back",U.mode=a;break top}if(c>>>=R,p-=R,R=n-i,T>R){if(R=T-R,R>_&&U.sane){e.msg="invalid distance too far back",U.mode=a;break top}if(x=0,A=u,0===f){if(x+=d-R,R<w){w-=R;do y[n++]=u[x++];while(--R);x=n-T,A=y}}else if(f<R){if(x+=d+f-R,R-=f,R<w){w-=R;do y[n++]=u[x++];while(--R);if(x=0,f<w){R=f,w-=R;do y[n++]=u[x++];while(--R);x=n-T,A=y}}}else if(x+=f-R,R<w){w-=R;do y[n++]=u[x++];while(--R);x=n-T,A=y}for(;2<w;)y[n++]=A[x++],y[n++]=A[x++],y[n++]=A[x++],w-=3;w&&(y[n++]=A[x++],1<w&&(y[n++]=A[x++]))}else{x=n-T;do y[n++]=y[x++],y[n++]=y[x++],y[n++]=y[x++],w-=3;while(2<w);w&&(y[n++]=y[x++],1<w&&(y[n++]=y[x++]))}}else if(0==(64&R)){E=m[(65535&E)+(c&(1<<R)-1)];continue dodist}else{e.msg="invalid distance code",U.mode=a;break top}break}}else if(0==(64&R)){E=h[(65535&E)+(c&(1<<R)-1)];continue dolen}else if(32&R){U.mode=12;break top}else{e.msg="invalid literal/length code",U.mode=a;break top}break}}while(r<s&&n<o);return w=p>>3,r-=w,p-=w<<3,c&=(1<<p)-1,e.next_in=r,e.next_out=n,e.avail_in=r<s?5+(s-r):5-(r-s),e.avail_out=n<o?257+(o-n):257-(n-o),U.hold=c,void(U.bits=p)}},{}],13:[function(e,t){'use strict';var r=String.fromCharCode;function a(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const s=e("./adler32"),i=e("./crc32"),o=e("./inffast"),l=e("./inftrees"),d=1,_=2,{Z_FINISH:f,Z_BLOCK:u,Z_TREES:c,Z_OK:p,Z_STREAM_END:h,Z_NEED_DICT:m,Z_STREAM_ERROR:g,Z_DATA_ERROR:b,Z_MEM_ERROR:E,Z_BUF_ERROR:R,Z_DEFLATED:w}=e("./constants"),T=1,x=2,A=3,v=4,y=5,U=6,B=7,F=8,k=9,L=10,D=11,S=12,O=13,C=14,I=15,z=16,N=17,M=18,P=19,H=20,X=21,G=22,Z=23,Y=24,W=25,V=26,j=27,K=28,q=29,Q=30,J=31,$=e=>(255&e>>>24)+(65280&e>>>8)+((65280&e)<<8)+((255&e)<<24),ee=e=>{if(!e||!e.state)return g;const t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=T,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,p},te=e=>{if(!e||!e.state)return g;const t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,ee(e)},ae=(e,t)=>{let a;if(!e||!e.state)return g;const r=e.state;return(0>t?(a=0,t=-t):(a=(t>>4)+1,48>t&&(t&=15)),t&&(8>t||15<t))?g:(null!==r.window&&r.wbits!==t&&(r.window=null),r.wrap=a,r.wbits=t,te(e))},re=(e,t)=>{if(!e)return g;const r=new a;e.state=r,r.window=null;const s=ae(e,t);return s!==p&&(e.state=null),s};let se,ne,ie=!0;const oe=e=>{if(ie){se=new Int32Array(512),ne=new Int32Array(32);let t=0;for(;144>t;)e.lens[t++]=8;for(;256>t;)e.lens[t++]=9;for(;280>t;)e.lens[t++]=7;for(;288>t;)e.lens[t++]=8;for(l(d,e.lens,0,288,se,0,e.work,{bits:9}),t=0;32>t;)e.lens[t++]=5;l(_,e.lens,0,32,ne,0,e.work,{bits:5}),ie=!1}e.lencode=se,e.lenbits=9,e.distcode=ne,e.distbits=5},le=(e,t,a,r)=>{let s;const n=e.state;return null===n.window&&(n.wsize=1<<n.wbits,n.wnext=0,n.whave=0,n.window=new Uint8Array(n.wsize)),r>=n.wsize?(n.window.set(t.subarray(a-n.wsize,a),0),n.wnext=0,n.whave=n.wsize):(s=n.wsize-n.wnext,s>r&&(s=r),n.window.set(t.subarray(a-r,a-r+s),n.wnext),r-=s,r?(n.window.set(t.subarray(a-r,a),0),n.wnext=r,n.whave=n.wsize):(n.wnext+=s,n.wnext===n.wsize&&(n.wnext=0),n.whave<n.wsize&&(n.whave+=s))),0};t.exports.inflateReset=te,t.exports.inflateReset2=ae,t.exports.inflateResetKeep=ee,t.exports.inflateInit=e=>re(e,15),t.exports.inflateInit2=re,t.exports.inflate=(e,t)=>{let a,ee,te,ae,re,se,ne,ie,de,_e,fe,ue,ce,pe,he,me,ge,be,Ee,Re,we,Te,xe=0;const Ae=new Uint8Array(4);let ve,ye;const Ue=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return g;a=e.state,a.mode===S&&(a.mode=O),re=e.next_out,te=e.output,ne=e.avail_out,ae=e.next_in,ee=e.input,se=e.avail_in,ie=a.hold,de=a.bits,_e=se,fe=ne,Te=p;inf_leave:for(;;)switch(a.mode){case T:if(0===a.wrap){a.mode=O;break}for(;16>de;){if(0===se)break inf_leave;se--,ie+=ee[ae++]<<de,de+=8}if(2&a.wrap&&35615===ie){a.check=0,Ae[0]=255&ie,Ae[1]=255&ie>>>8,a.check=i(a.check,Ae,2,0),ie=0,de=0,a.mode=x;break}if(a.flags=0,a.head&&(a.head.done=!1),!(1&a.wrap)||(((255&ie)<<8)+(ie>>8))%31){e.msg="incorrect header check",a.mode=Q;break}if((15&ie)!==w){e.msg="unknown compression method",a.mode=Q;break}if(ie>>>=4,de-=4,we=(15&ie)+8,0===a.wbits)a.wbits=we;else if(we>a.wbits){e.msg="invalid window size",a.mode=Q;break}a.dmax=1<<a.wbits,e.adler=a.check=1,a.mode=512&ie?L:S,ie=0,de=0;break;case x:for(;16>de;){if(0===se)break inf_leave;se--,ie+=ee[ae++]<<de,de+=8}if(a.flags=ie,(255&a.flags)!==w){e.msg="unknown compression method",a.mode=Q;break}if(57344&a.flags){e.msg="unknown header flags set",a.mode=Q;break}a.head&&(a.head.text=1&ie>>8),512&a.flags&&(Ae[0]=255&ie,Ae[1]=255&ie>>>8,a.check=i(a.check,Ae,2,0)),ie=0,de=0,a.mode=A;case A:for(;32>de;){if(0===se)break inf_leave;se--,ie+=ee[ae++]<<de,de+=8}a.head&&(a.head.time=ie),512&a.flags&&(Ae[0]=255&ie,Ae[1]=255&ie>>>8,Ae[2]=255&ie>>>16,Ae[3]=255&ie>>>24,a.check=i(a.check,Ae,4,0)),ie=0,de=0,a.mode=v;case v:for(;16>de;){if(0===se)break inf_leave;se--,ie+=ee[ae++]<<de,de+=8}a.head&&(a.head.xflags=255&ie,a.head.os=ie>>8),512&a.flags&&(Ae[0]=255&ie,Ae[1]=255&ie>>>8,a.check=i(a.check,Ae,2,0)),ie=0,de=0,a.mode=y;case y:if(1024&a.flags){for(;16>de;){if(0===se)break inf_leave;se--,ie+=ee[ae++]<<de,de+=8}a.length=ie,a.head&&(a.head.extra_len=ie),512&a.flags&&(Ae[0]=255&ie,Ae[1]=255&ie>>>8,a.check=i(a.check,Ae,2,0)),ie=0,de=0}else a.head&&(a.head.extra=null);a.mode=U;case U:if(1024&a.flags&&(ue=a.length,ue>se&&(ue=se),ue&&(a.head&&(we=a.head.extra_len-a.length,!a.head.extra&&(a.head.extra=new Uint8Array(a.head.extra_len)),a.head.extra.set(ee.subarray(ae,ae+ue),we)),512&a.flags&&(a.check=i(a.check,ee,ue,ae)),se-=ue,ae+=ue,a.length-=ue),a.length))break inf_leave;a.length=0,a.mode=B;case B:if(2048&a.flags){if(0===se)break inf_leave;ue=0;do we=ee[ae+ue++],a.head&&we&&65536>a.length&&(a.head.name+=r(we));while(we&&ue<se);if(512&a.flags&&(a.check=i(a.check,ee,ue,ae)),se-=ue,ae+=ue,we)break inf_leave}else a.head&&(a.head.name=null);a.length=0,a.mode=F;case F:if(4096&a.flags){if(0===se)break inf_leave;ue=0;do we=ee[ae+ue++],a.head&&we&&65536>a.length&&(a.head.comment+=r(we));while(we&&ue<se);if(512&a.flags&&(a.check=i(a.check,ee,ue,ae)),se-=ue,ae+=ue,we)break inf_leave}else a.head&&(a.head.comment=null);a.mode=k;case k:if(512&a.flags){for(;16>de;){if(0===se)break inf_leave;se--,ie+=ee[ae++]<<de,de+=8}if(ie!==(65535&a.check)){e.msg="header crc mismatch",a.mode=Q;break}ie=0,de=0}a.head&&(a.head.hcrc=1&a.flags>>9,a.head.done=!0),e.adler=a.check=0,a.mode=S;break;case L:for(;32>de;){if(0===se)break inf_leave;se--,ie+=ee[ae++]<<de,de+=8}e.adler=a.check=$(ie),ie=0,de=0,a.mode=D;case D:if(0===a.havedict)return e.next_out=re,e.avail_out=ne,e.next_in=ae,e.avail_in=se,a.hold=ie,a.bits=de,m;e.adler=a.check=1,a.mode=S;case S:if(t===u||t===c)break inf_leave;case O:if(a.last){ie>>>=7&de,de-=7&de,a.mode=j;break}for(;3>de;){if(0===se)break inf_leave;se--,ie+=ee[ae++]<<de,de+=8}switch(a.last=1&ie,ie>>>=1,de-=1,3&ie){case 0:a.mode=C;break;case 1:if(oe(a),a.mode=H,t===c){ie>>>=2,de-=2;break inf_leave}break;case 2:a.mode=N;break;case 3:e.msg="invalid block type",a.mode=Q;}ie>>>=2,de-=2;break;case C:for(ie>>>=7&de,de-=7&de;32>de;){if(0===se)break inf_leave;se--,ie+=ee[ae++]<<de,de+=8}if((65535&ie)!=(65535^ie>>>16)){e.msg="invalid stored block lengths",a.mode=Q;break}if(a.length=65535&ie,ie=0,de=0,a.mode=I,t===c)break inf_leave;case I:a.mode=z;case z:if(ue=a.length,ue){if(ue>se&&(ue=se),ue>ne&&(ue=ne),0===ue)break inf_leave;te.set(ee.subarray(ae,ae+ue),re),se-=ue,ae+=ue,ne-=ue,re+=ue,a.length-=ue;break}a.mode=S;break;case N:for(;14>de;){if(0===se)break inf_leave;se--,ie+=ee[ae++]<<de,de+=8}if(a.nlen=(31&ie)+257,ie>>>=5,de-=5,a.ndist=(31&ie)+1,ie>>>=5,de-=5,a.ncode=(15&ie)+4,ie>>>=4,de-=4,286<a.nlen||30<a.ndist){e.msg="too many length or distance symbols",a.mode=Q;break}a.have=0,a.mode=M;case M:for(;a.have<a.ncode;){for(;3>de;){if(0===se)break inf_leave;se--,ie+=ee[ae++]<<de,de+=8}a.lens[Ue[a.have++]]=7&ie,ie>>>=3,de-=3}for(;19>a.have;)a.lens[Ue[a.have++]]=0;if(a.lencode=a.lendyn,a.lenbits=7,ve={bits:a.lenbits},Te=l(0,a.lens,0,19,a.lencode,0,a.work,ve),a.lenbits=ve.bits,Te){e.msg="invalid code lengths set",a.mode=Q;break}a.have=0,a.mode=P;case P:for(;a.have<a.nlen+a.ndist;){for(;;){if(xe=a.lencode[ie&(1<<a.lenbits)-1],he=xe>>>24,me=255&xe>>>16,ge=65535&xe,he<=de)break;if(0===se)break inf_leave;se--,ie+=ee[ae++]<<de,de+=8}if(16>ge)ie>>>=he,de-=he,a.lens[a.have++]=ge;else{if(16===ge){for(ye=he+2;de<ye;){if(0===se)break inf_leave;se--,ie+=ee[ae++]<<de,de+=8}if(ie>>>=he,de-=he,0===a.have){e.msg="invalid bit length repeat",a.mode=Q;break}we=a.lens[a.have-1],ue=3+(3&ie),ie>>>=2,de-=2}else if(17===ge){for(ye=he+3;de<ye;){if(0===se)break inf_leave;se--,ie+=ee[ae++]<<de,de+=8}ie>>>=he,de-=he,we=0,ue=3+(7&ie),ie>>>=3,de-=3}else{for(ye=he+7;de<ye;){if(0===se)break inf_leave;se--,ie+=ee[ae++]<<de,de+=8}ie>>>=he,de-=he,we=0,ue=11+(127&ie),ie>>>=7,de-=7}if(a.have+ue>a.nlen+a.ndist){e.msg="invalid bit length repeat",a.mode=Q;break}for(;ue--;)a.lens[a.have++]=we}}if(a.mode===Q)break;if(0===a.lens[256]){e.msg="invalid code -- missing end-of-block",a.mode=Q;break}if(a.lenbits=9,ve={bits:a.lenbits},Te=l(d,a.lens,0,a.nlen,a.lencode,0,a.work,ve),a.lenbits=ve.bits,Te){e.msg="invalid literal/lengths set",a.mode=Q;break}if(a.distbits=6,a.distcode=a.distdyn,ve={bits:a.distbits},Te=l(_,a.lens,a.nlen,a.ndist,a.distcode,0,a.work,ve),a.distbits=ve.bits,Te){e.msg="invalid distances set",a.mode=Q;break}if(a.mode=H,t===c)break inf_leave;case H:a.mode=X;case X:if(6<=se&&258<=ne){e.next_out=re,e.avail_out=ne,e.next_in=ae,e.avail_in=se,a.hold=ie,a.bits=de,o(e,fe),re=e.next_out,te=e.output,ne=e.avail_out,ae=e.next_in,ee=e.input,se=e.avail_in,ie=a.hold,de=a.bits,a.mode===S&&(a.back=-1);break}for(a.back=0;;){if(xe=a.lencode[ie&(1<<a.lenbits)-1],he=xe>>>24,me=255&xe>>>16,ge=65535&xe,he<=de)break;if(0===se)break inf_leave;se--,ie+=ee[ae++]<<de,de+=8}if(me&&0==(240&me)){for(be=he,Ee=me,Re=ge;;){if(xe=a.lencode[Re+((ie&(1<<be+Ee)-1)>>be)],he=xe>>>24,me=255&xe>>>16,ge=65535&xe,be+he<=de)break;if(0===se)break inf_leave;se--,ie+=ee[ae++]<<de,de+=8}ie>>>=be,de-=be,a.back+=be}if(ie>>>=he,de-=he,a.back+=he,a.length=ge,0===me){a.mode=V;break}if(32&me){a.back=-1,a.mode=S;break}if(64&me){e.msg="invalid literal/length code",a.mode=Q;break}a.extra=15&me,a.mode=G;case G:if(a.extra){for(ye=a.extra;de<ye;){if(0===se)break inf_leave;se--,ie+=ee[ae++]<<de,de+=8}a.length+=ie&(1<<a.extra)-1,ie>>>=a.extra,de-=a.extra,a.back+=a.extra}a.was=a.length,a.mode=Z;case Z:for(;;){if(xe=a.distcode[ie&(1<<a.distbits)-1],he=xe>>>24,me=255&xe>>>16,ge=65535&xe,he<=de)break;if(0===se)break inf_leave;se--,ie+=ee[ae++]<<de,de+=8}if(0==(240&me)){for(be=he,Ee=me,Re=ge;;){if(xe=a.distcode[Re+((ie&(1<<be+Ee)-1)>>be)],he=xe>>>24,me=255&xe>>>16,ge=65535&xe,be+he<=de)break;if(0===se)break inf_leave;se--,ie+=ee[ae++]<<de,de+=8}ie>>>=be,de-=be,a.back+=be}if(ie>>>=he,de-=he,a.back+=he,64&me){e.msg="invalid distance code",a.mode=Q;break}a.offset=ge,a.extra=15&me,a.mode=Y;case Y:if(a.extra){for(ye=a.extra;de<ye;){if(0===se)break inf_leave;se--,ie+=ee[ae++]<<de,de+=8}a.offset+=ie&(1<<a.extra)-1,ie>>>=a.extra,de-=a.extra,a.back+=a.extra}if(a.offset>a.dmax){e.msg="invalid distance too far back",a.mode=Q;break}a.mode=W;case W:if(0===ne)break inf_leave;if(ue=fe-ne,a.offset>ue){if(ue=a.offset-ue,ue>a.whave&&a.sane){e.msg="invalid distance too far back",a.mode=Q;break}ue>a.wnext?(ue-=a.wnext,ce=a.wsize-ue):ce=a.wnext-ue,ue>a.length&&(ue=a.length),pe=a.window}else pe=te,ce=re-a.offset,ue=a.length;ue>ne&&(ue=ne),ne-=ue,a.length-=ue;do te[re++]=pe[ce++];while(--ue);0===a.length&&(a.mode=X);break;case V:if(0===ne)break inf_leave;te[re++]=a.length,ne--,a.mode=X;break;case j:if(a.wrap){for(;32>de;){if(0===se)break inf_leave;se--,ie|=ee[ae++]<<de,de+=8}if(fe-=ne,e.total_out+=fe,a.total+=fe,fe&&(e.adler=a.check=a.flags?i(a.check,te,fe,re-fe):s(a.check,te,fe,re-fe)),fe=ne,(a.flags?ie:$(ie))!==a.check){e.msg="incorrect data check",a.mode=Q;break}ie=0,de=0}a.mode=K;case K:if(a.wrap&&a.flags){for(;32>de;){if(0===se)break inf_leave;se--,ie+=ee[ae++]<<de,de+=8}if(ie!==(4294967295&a.total)){e.msg="incorrect length check",a.mode=Q;break}ie=0,de=0}a.mode=q;case q:Te=h;break inf_leave;case Q:Te=b;break inf_leave;case J:return E;case 32:default:return g;}return(e.next_out=re,e.avail_out=ne,e.next_in=ae,e.avail_in=se,a.hold=ie,a.bits=de,(a.wsize||fe!==e.avail_out&&a.mode<Q&&(a.mode<j||t!==f))&&le(e,e.output,e.next_out,fe-e.avail_out))?(a.mode=J,E):(_e-=e.avail_in,fe-=e.avail_out,e.total_in+=_e,e.total_out+=fe,a.total+=fe,a.wrap&&fe&&(e.adler=a.check=a.flags?i(a.check,te,fe,e.next_out-fe):s(a.check,te,fe,e.next_out-fe)),e.data_type=a.bits+(a.last?64:0)+(a.mode===S?128:0)+(a.mode===H||a.mode===I?256:0),(0===_e&&0===fe||t===f)&&Te===p&&(Te=R),Te)},t.exports.inflateEnd=e=>{if(!e||!e.state)return g;let t=e.state;return t.window&&(t.window=null),e.state=null,p},t.exports.inflateGetHeader=(e,t)=>{if(!e||!e.state)return g;const a=e.state;return 0==(2&a.wrap)?g:(a.head=t,t.done=!1,p)},t.exports.inflateSetDictionary=(e,t)=>{const a=t.length;let r,n,i;return e&&e.state?(r=e.state,0!==r.wrap&&r.mode!==D)?g:r.mode===D&&(n=1,n=s(n,t,a,0),n!==r.check)?b:(i=le(e,t,a,a),i)?(r.mode=J,E):(r.havedict=1,p):g},t.exports.inflateInfo="pako inflate (from Nodeca project)"},{"./adler32":7,"./constants":8,"./crc32":9,"./inffast":12,"./inftrees":14}],14:[function(e,t){'use strict';const a=15,r=852,s=592,n=0,i=1,o=2,l=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),d=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),_=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),f=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);t.exports=(e,t,u,c,p,h,m,g)=>{const b=g.bits;let E,R,w,T,x,A,v=0,y=0,U=0,B=0,F=0,k=0,L=0,D=0,S=0,O=0,C=null,I=0;const z=new Uint16Array(16),N=new Uint16Array(16);let M,P,H,X=null,G=0;for(v=0;v<=a;v++)z[v]=0;for(y=0;y<c;y++)z[t[u+y]]++;for(F=b,B=a;1<=B&&0===z[B];B--);if(F>B&&(F=B),0===B)return p[h++]=20971520,p[h++]=20971520,g.bits=1,0;for(U=1;U<B&&0===z[U];U++);for(F<U&&(F=U),D=1,v=1;v<=a;v++)if(D<<=1,D-=z[v],0>D)return-1;if(0<D&&(e===n||1!==B))return-1;for(N[1]=0,v=1;v<a;v++)N[v+1]=N[v]+z[v];for(y=0;y<c;y++)0!==t[u+y]&&(m[N[t[u+y]]++]=y);if(e===n?(C=X=m,A=19):e===i?(C=l,I-=257,X=d,G-=257,A=256):(C=_,X=f,A=-1),O=0,y=0,v=U,x=h,k=F,L=0,w=-1,S=1<<F,T=S-1,e===i&&S>r||e===o&&S>s)return 1;for(;;){M=v-L,m[y]<A?(P=0,H=m[y]):m[y]>A?(P=X[G+m[y]],H=C[I+m[y]]):(P=96,H=0),E=1<<v-L,R=1<<k,U=R;do R-=E,p[x+(O>>L)+R]=0|(M<<24|P<<16|H);while(0!==R);for(E=1<<v-1;O&E;)E>>=1;if(0===E?O=0:(O&=E-1,O+=E),y++,0==--z[v]){if(v===B)break;v=t[u+m[y]]}if(v>F&&(O&T)!==w){for(0===L&&(L=F),x+=U,k=v-L,D=1<<k;k+L<B&&(D-=z[k+L],!(0>=D));)k++,D<<=1;if(S+=1<<k,e===i&&S>r||e===o&&S>s)return 1;w=O&T,p[w]=0|(F<<24|k<<16|x-h)}}return 0!==O&&(p[x+O]=0|(4194304|v-L<<24)),g.bits=F,0}},{}],15:[function(e,t){'use strict';t.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],16:[function(e,t){'use strict';function a(e){for(let t=e.length;0<=--t;)e[t]=0}function r(e,t,a,r,s){this.static_tree=e,this.extra_bits=t,this.extra_base=a,this.elems=r,this.max_length=s,this.has_stree=e&&e.length}function n(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}const i=0,o=1,l=1,d=29,_=256,f=_+1+d,u=30,c=19,p=2*f+1,h=15,m=16,g=256,b=16,E=17,R=18,w=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),T=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),x=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),A=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),v=Array(2*(f+2));a(v);const y=Array(2*u);a(y);const U=Array(512);a(U);const B=Array(258-3+1);a(B);const F=Array(d);a(F);const k=Array(u);a(k);let L,D,S;const O=e=>256>e?U[e]:U[256+(e>>>7)],C=(e,t)=>{e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=255&t>>>8},I=(e,t,a)=>{e.bi_valid>m-a?(e.bi_buf|=65535&t<<e.bi_valid,C(e,e.bi_buf),e.bi_buf=t>>m-e.bi_valid,e.bi_valid+=a-m):(e.bi_buf|=65535&t<<e.bi_valid,e.bi_valid+=a)},z=(e,t,a)=>{I(e,a[2*t],a[2*t+1])},N=(e,t)=>{let a=0;do a|=1&e,e>>>=1,a<<=1;while(0<--t);return a>>>1},M=e=>{16===e.bi_valid?(C(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):8<=e.bi_valid&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)},P=(e,t)=>{const a=t.dyn_tree,r=t.max_code,s=t.stat_desc.static_tree,i=t.stat_desc.has_stree,o=t.stat_desc.extra_bits,l=t.stat_desc.extra_base,d=t.stat_desc.max_length;let _,u,c,g,b,E,R=0;for(g=0;g<=h;g++)e.bl_count[g]=0;for(a[2*e.heap[e.heap_max]+1]=0,_=e.heap_max+1;_<p;_++)(u=e.heap[_],g=a[2*a[2*u+1]+1]+1,g>d&&(g=d,R++),a[2*u+1]=g,!(u>r))&&(e.bl_count[g]++,b=0,u>=l&&(b=o[u-l]),E=a[2*u],e.opt_len+=E*(g+b),i&&(e.static_len+=E*(s[2*u+1]+b)));if(0!==R){do{for(g=d-1;0===e.bl_count[g];)g--;e.bl_count[g]--,e.bl_count[g+1]+=2,e.bl_count[d]--,R-=2}while(0<R);for(g=d;0!==g;g--)for(u=e.bl_count[g];0!==u;)(c=e.heap[--_],!(c>r))&&(a[2*c+1]!==g&&(e.opt_len+=(g-a[2*c+1])*a[2*c],a[2*c+1]=g),u--)}},H=(e,t,a)=>{const r=Array(h+1);let s,i,o=0;for(s=1;s<=h;s++)r[s]=o=o+a[s-1]<<1;for(i=0;i<=t;i++){let t=e[2*i+1];0!==t&&(e[2*i]=N(r[t]++,t))}},X=()=>{let e,t,a,s,i;const o=Array(h+1);for(a=0,s=0;s<d-1;s++)for(F[s]=a,e=0;e<1<<w[s];e++)B[a++]=s;for(B[a-1]=s,i=0,s=0;16>s;s++)for(k[s]=i,e=0;e<1<<T[s];e++)U[i++]=s;for(i>>=7;s<u;s++)for(k[s]=i<<7,e=0;e<1<<T[s]-7;e++)U[256+i++]=s;for(t=0;t<=h;t++)o[t]=0;for(e=0;143>=e;)v[2*e+1]=8,e++,o[8]++;for(;255>=e;)v[2*e+1]=9,e++,o[9]++;for(;279>=e;)v[2*e+1]=7,e++,o[7]++;for(;287>=e;)v[2*e+1]=8,e++,o[8]++;for(H(v,f+1,o),e=0;e<u;e++)y[2*e+1]=5,y[2*e]=N(e,5);L=new r(v,w,_+1,f,h),D=new r(y,T,0,u,h),S=new r([],x,0,c,7)},G=e=>{let t;for(t=0;t<f;t++)e.dyn_ltree[2*t]=0;for(t=0;t<u;t++)e.dyn_dtree[2*t]=0;for(t=0;t<c;t++)e.bl_tree[2*t]=0;e.dyn_ltree[2*g]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0},Z=e=>{8<e.bi_valid?C(e,e.bi_buf):0<e.bi_valid&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},Y=(e,t,a,r)=>{Z(e),r&&(C(e,a),C(e,~a)),e.pending_buf.set(e.window.subarray(t,t+a),e.pending),e.pending+=a},W=(e,t,a,r)=>{const s=2*t,n=2*a;return e[s]<e[n]||e[s]===e[n]&&r[t]<=r[a]},V=(e,t,a)=>{const r=e.heap[a];for(let s=a<<1;s<=e.heap_len&&(s<e.heap_len&&W(t,e.heap[s+1],e.heap[s],e.depth)&&s++,!W(t,r,e.heap[s],e.depth));)e.heap[a]=e.heap[s],a=s,s<<=1;e.heap[a]=r},j=(e,t,a)=>{let r,s,n,i,o=0;if(0!==e.last_lit)do r=e.pending_buf[e.d_buf+2*o]<<8|e.pending_buf[e.d_buf+2*o+1],s=e.pending_buf[e.l_buf+o],o++,0===r?z(e,s,t):(n=B[s],z(e,n+_+1,t),i=w[n],0!==i&&(s-=F[n],I(e,s,i)),r--,n=O(r),z(e,n,a),i=T[n],0!==i&&(r-=k[n],I(e,r,i)));while(o<e.last_lit);z(e,g,t)},K=(e,t)=>{const a=t.dyn_tree,r=t.stat_desc.static_tree,s=t.stat_desc.has_stree,i=t.stat_desc.elems;let o,l,d,_=-1;for(e.heap_len=0,e.heap_max=p,o=0;o<i;o++)0===a[2*o]?a[2*o+1]=0:(e.heap[++e.heap_len]=_=o,e.depth[o]=0);for(;2>e.heap_len;)d=e.heap[++e.heap_len]=2>_?++_:0,a[2*d]=1,e.depth[d]=0,e.opt_len--,s&&(e.static_len-=r[2*d+1]);for(t.max_code=_,o=e.heap_len>>1;1<=o;o--)V(e,a,o);d=i;do o=e.heap[1],e.heap[1]=e.heap[e.heap_len--],V(e,a,1),l=e.heap[1],e.heap[--e.heap_max]=o,e.heap[--e.heap_max]=l,a[2*d]=a[2*o]+a[2*l],e.depth[d]=(e.depth[o]>=e.depth[l]?e.depth[o]:e.depth[l])+1,a[2*o+1]=a[2*l+1]=d,e.heap[1]=d++,V(e,a,1);while(2<=e.heap_len);e.heap[--e.heap_max]=e.heap[1],P(e,t),H(a,_,e.bl_count)},q=(e,t,a)=>{let r,s,i=-1,o=t[1],l=0,d=7,_=4;for(0===o&&(d=138,_=3),t[2*(a+1)+1]=65535,r=0;r<=a;r++){if(s=o,o=t[2*(r+1)+1],++l<d&&s===o)continue;else l<_?e.bl_tree[2*s]+=l:0===s?10>=l?e.bl_tree[2*E]++:e.bl_tree[2*R]++:(s!==i&&e.bl_tree[2*s]++,e.bl_tree[2*b]++);l=0,i=s,0===o?(d=138,_=3):s===o?(d=6,_=3):(d=7,_=4)}},Q=(e,t,a)=>{let r,s,i=-1,o=t[1],l=0,d=7,_=4;for(0===o&&(d=138,_=3),r=0;r<=a;r++){if(s=o,o=t[2*(r+1)+1],++l<d&&s===o)continue;else if(l<_)do z(e,s,e.bl_tree);while(0!=--l);else 0===s?10>=l?(z(e,E,e.bl_tree),I(e,l-3,3)):(z(e,R,e.bl_tree),I(e,l-11,7)):(s!==i&&(z(e,s,e.bl_tree),l--),z(e,b,e.bl_tree),I(e,l-3,2));l=0,i=s,0===o?(d=138,_=3):s===o?(d=6,_=3):(d=7,_=4)}},J=e=>{let t;for(q(e,e.dyn_ltree,e.l_desc.max_code),q(e,e.dyn_dtree,e.d_desc.max_code),K(e,e.bl_desc),t=c-1;3<=t&&0===e.bl_tree[2*A[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t},$=(e,t,a,r)=>{let s;for(I(e,t-257,5),I(e,a-1,5),I(e,r-4,4),s=0;s<r;s++)I(e,e.bl_tree[2*A[s]+1],3);Q(e,e.dyn_ltree,t-1),Q(e,e.dyn_dtree,a-1)},ee=e=>{let t,a=4093624447;for(t=0;31>=t;t++,a>>>=1)if(1&a&&0!==e.dyn_ltree[2*t])return i;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return o;for(t=32;t<_;t++)if(0!==e.dyn_ltree[2*t])return o;return i};let te=!1;const ae=e=>{te||(X(),te=!0),e.l_desc=new n(e.dyn_ltree,L),e.d_desc=new n(e.dyn_dtree,D),e.bl_desc=new n(e.bl_tree,S),e.bi_buf=0,e.bi_valid=0,G(e)},re=(e,t,a,r)=>{I(e,(0<<1)+(r?1:0),3),Y(e,t,a,!0)};t.exports._tr_init=ae,t.exports._tr_stored_block=re,t.exports._tr_flush_block=(e,t,a,r)=>{let s,n,i=0;0<e.level?(e.strm.data_type===2&&(e.strm.data_type=ee(e)),K(e,e.l_desc),K(e,e.d_desc),i=J(e),s=e.opt_len+3+7>>>3,n=e.static_len+3+7>>>3,n<=s&&(s=n)):s=n=a+5,a+4<=s&&-1!==t?re(e,t,a,r):e.strategy===4||n===s?(I(e,(l<<1)+(r?1:0),3),j(e,v,y)):(I(e,(2<<1)+(r?1:0),3),$(e,e.l_desc.max_code+1,e.d_desc.max_code+1,i+1),j(e,e.dyn_ltree,e.dyn_dtree)),G(e),r&&Z(e)},t.exports._tr_tally=(e,t,a)=>(e.pending_buf[e.d_buf+2*e.last_lit]=255&t>>>8,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&a,e.last_lit++,0===t?e.dyn_ltree[2*a]++:(e.matches++,t--,e.dyn_ltree[2*(B[a]+_+1)]++,e.dyn_dtree[2*O(t)]++),e.last_lit===e.lit_bufsize-1),t.exports._tr_align=e=>{I(e,l<<1,3),z(e,g,v),M(e)}},{}],17:[function(e,t){'use strict';t.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],18:[function(e,t){var a=String.fromCharCode;t.exports=class{constructor(e,t=!0){this.view=e,this.offset=0,this.le=t}get length(){return this.view.byteLength}get EOF(){return this.offset===this.view.byteLength}readUInt8(){return this.view.getUint8(this.offset++)}readInt8(){return this.view.getInt8(this.offset++)}readUInt16(){const e=this.view.getUint16(this.offset,this.le);return this.offset+=2,e}readInt16(){const e=this.view.getUint16(this.offset,this.le);return this.offset+=2,e}readUInt32(){const e=this.view.getUint32(this.offset,this.le);return this.offset+=4,e}readInt32(){const e=this.view.getInt32(this.offset,this.le);return this.offset+=4,e}readFloat32(){const e=this.view.getFloat32(this.offset,this.le);return this.offset+=4,e}readFloat64(){const e=this.view.getFloat64(this.offset,this.le);return this.offset+=8,e}skip(e){this.offset+=e}readUTF8String(){const e=[];for(;this.offset<this.view.byteLength;){const t=this.readUInt8();if(!t)break;e.push(a(t))}return e.join("")}readUTF16String(){const e=[];for(;this.offset<this.view.byteLength;){const t=this.readUInt16();if(!t)break;e.push(a(t))}return e.join("")}readBytes(e=0){const t=this.view.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t}}},{}],19:[function(e,t){const r=new DataView(new ArrayBuffer(1048576));t.exports=class{constructor(e=!0){this.offset=0,this.le=e}writeUInt8(e){r.setUint8(this.offset++,e)}writeInt8(e){r.setInt8(this.offset++,e)}writeUInt16(e){r.setUint16(this.offset,e,this.le),this.offset+=2}writeInt16(e){r.setInt16(this.offset,e,this.le),this.offset+=2}writeUInt32(e){r.setUint32(this.offset,e,this.le),this.offset+=4}writeInt32(e){r.setInt32(this.offset,e,this.le),this.offset+=4}writeFloat32(e){r.setFloat32(this.offset,e,this.le),this.offset+=4}writeFloat64(e){r.setFloat64(this.offset,e,this.le),this.offset+=8}writeUTF8String(e){for(let t=0;t<e.length;t++)this.writeUInt8(e.charCodeAt(t));this.writeUInt8(0)}writeUTF16String(e){for(let t=0;t<e.length;t++)this.writeUInt16(e.charCodeAt(t));this.writeUInt16(0)}skip(e=0){this.offset+=e}finalize(){return r.buffer.slice(0,this.offset)}}},{}],20:[function(e,t){const a=e("pako"),r=e("../../src/network/reader");t.exports={serialize:e=>{let t=0;for(const a in e){t+=a.length+1;const r=e[a];t+=4,Array.isArray(r)?r.forEach(e=>t+=e.byteLength+4):t+=r.byteLength}const r=new Uint8Array(t),s=new DataView(r.buffer);let n=0;for(const t in e){for(let e=0;e<t.length;e++)r[n++]=t.charCodeAt(e);r[n++]=0;const a=e[t],i=e=>{s.setInt32(n,e.byteLength,!0),n+=4,r.set(new Uint8Array(e),n),n+=e.byteLength};if(Array.isArray(a)){s.setInt32(n,-a.length,!0),n+=4;for(const e of a)i(e)}else i(a)}return console.assert(r.byteLength===n,"Output bytes should match final offset"),a.deflate(r,{level:9,raw:!0}).buffer},deserialize:e=>{const t={},s=new r(new DataView(a.inflate(e,{raw:!0}).buffer)),n=e=>s.readBytes(e||s.readInt32());for(;!s.EOF;){const e=s.readUTF8String(),a=s.readInt32();t[e]=0<a?n(a):Array.from({length:-a},()=>n())}return t}}},{"../../src/network/reader":18,pako:2}],21:[function(e,t){t.exports=class{constructor(e){this.port=e,this.readyState=WebSocket.CONNECTING,e.onmessage=t=>{const{data:e}=t;"message"===e.event?this.onmessage({data:e.message}):"error"===e.event?this.onerror({message:e.message}):"close"===e.event?this.onclose({code:e.code,reason:e.reason}):"open"===e.event&&(this.readyState=WebSocket.OPEN,this.onopen())},e.start(),this.onopen=this.onmessage=this.onerror=this.onclose=()=>{}}send(e){this.port.postMessage({event:"message",message:e},[e])}close(){this.port.postMessage({event:"close",code:1001,message:"Client closed connection"}),this.port.close(),this.readyState=WebSocket.CLOSED}}},{}],22:[function(e,t){t.exports=class{constructor(){this.setBuffer()}setBuffer(e){e||(self.SharedArrayBuffer?e=new SharedArrayBuffer(12):e=new ArrayBuffer(12)),this.sharedBuffer=e,this.buffer=new Int32Array(this.sharedBuffer)}get x(){return Atomics.load(this.buffer,0)}set x(e){Atomics.store(this.buffer,0,e)}get y(){return Atomics.load(this.buffer,1)}set y(e){Atomics.store(this.buffer,1,e)}get scroll(){return Atomics.load(this.buffer,2)}set scroll(e){Atomics.store(this.buffer,2,e)}updateScroll(e){Atomics.add(this.buffer,2,e)}resetScroll(){return Atomics.exchange(this.buffer,2,0)}}},{}],23:[function(e,t){var a=Math.max;const{EventEmitter:r}=e("events"),s=e("../../src/network/reader"),n=e("../../src/network/writer"),i=e("./replay-db"),{deserialize:o}=e("./custom-bson"),l=e("./fake-socket");class d{constructor(e=0){this.score=0,this.state=new ArrayBuffer(e),this.view=new Uint8Array(this.state),this.packetTimestamps=[],this.packets=[]}}class _{constructor(e,t,a){this.t=0,this.i=0,this.encoder=new OffscreenCanvas(0,0),this.encoderCTX=this.encoder.getContext("bitmaprenderer"),this.thumbnail=new ArrayBuffer(0),this.thumbnailUint8View=new Uint8Array(this.thumbnail),this.thumbnailUint8ClampedView=new Uint8ClampedArray(this.thumbnail),this.protocol=t,this.renderer=e,this.source=new Uint8Array(e.core.buffer,0,e.cellDataBufferLength),this.snapshots=Array.from({length:a},()=>new d(this.source.byteLength))}async init(){this.db=await i()}resizeBuffer(){this.renderer.RGBABytes>this.thumbnail.byteLength&&(this.thumbnail=new ArrayBuffer(this.renderer.RGBABytes),this.thumbnailUint8View=new Uint8Array(this.thumbnail),this.thumbnailUint8ClampedView=new Uint8ClampedArray(this.thumbnail),this.thumbnailData=new ImageData(new Uint8ClampedArray(this.thumbnail),this.renderer.gl.drawingBufferWidth,this.renderer.gl.drawingBufferHeight))}encodePlayerData(){const e=new n;e.skip(1);const t=this.renderer.playerData.filter((t,a)=>{if(a&&!(250<a)&&t)return e.writeUInt8(a),e.writeUTF16String(t.name||""),e.writeUTF16String(t.skin||""),!0}),a=e.offset;return e.offset=0,e.writeUInt8(t.length),e.offset=a,e.finalize()}encodeState(e){const t=this.source.slice();this.source.set(new Uint8Array(e));const a=this.renderer.serializeState();return this.source.set(t),a}async save(){const e=this.snapshots.filter(e=>e.packets.length).map(e=>e),t=e.reduceRight((e,t)=>e.concat(t.packets),[]);let a=e.reduceRight((e,t)=>e.concat(t.packetTimestamps),[]);const r=Math.min(...a);a=a.map(e=>e-r);const s=t.reduce((e,t)=>e+t.byteLength,0),n=this.encodePlayerData(),i=new Float32Array(a).buffer,o=this.encodeState(e[e.length-1].state);this.encoder.width=this.thumbnailData.width>>2,this.encoder.height=this.thumbnailData.height>>2,this.encoderCTX.transferFromImageBitmap(await createImageBitmap(this.thumbnailData,{imageOrientation:"flipY",resizeWidth:this.encoder.width,resizeHeight:this.encoder.height,resizeQuality:"high"}));const l=await this.encoder.convertToBlob({type:"image/jpeg",quality:1}),d=o.byteLength+l.size+n.byteLength+i.byteLength+s;this.renderer.loader.postMessage({replay:{meta:{thumbnail:l,size:d},data:{initial:o,buffers:t,timestamps:i,players:n}}}),self.postMessage({event:"replay"})}set score(e){e>this.maxScore&&(this.resizeBuffer(),this.renderer.screenshot(this.thumbnailUint8View)),this.snapshots[0].score=a(e,this.snapshots[0].score)}get maxScore(){return a(...this.snapshots.map(e=>e.score))}recordState(){const e=this.snapshots.pop();this.free(e),this.snapshots.unshift(e),e.view.set(this.source),this.score=this.renderer.stats.score}recordPacket(e){this.snapshots[0].packets.push(e),this.snapshots[0].packetTimestamps.push(performance.now())}free(e){this.renderer.loader.postMessage(e.packets,e.packets),e.score=0,e.view.fill(0),e.packets=[],e.packetTimestamps=[]}resetSnapshots(){this.snapshots.forEach(e=>this.free(e))}async load(e=0){const t=await new Promise((t,a)=>{const r=this.db.transaction(["replay-data"],"readonly"),s=r.objectStore("replay-data"),n=s.get(e);r.oncomplete=()=>t(o(n.result)),r.onerror=a}),a=new Uint8Array(t.initial),r=new Float32Array(t.timestamps);this.curr={initial:a,timestamps:r,packets:t.buffers},console.assert(this.curr.timestamps.length===this.curr.packets.length,"Packet and timestamp length MUST match"),this.protocol.parsePlayers(t.players)}update(e=0){if(this.curr){if(!this.t){this.source.fill(0);const e=this.renderer.core;e.HEAPU8.set(this.curr.initial,this.renderer.cellBufferOffset),e.instance.exports.deserialize(0,this.renderer.cellBufferOffset)}for(;this.curr.timestamps[this.i]<this.t;)this.protocol.onMessage({data:this.curr.packets[this.i++]});this.i>=this.curr.timestamps.length?this.resetTrack():this.t+=e}}resetTrack(){this.i=0,this.t=0,this.renderer.shouldTP=!0}}const f=[2,4];t.exports=class extends r{constructor(e){super(),this.pid=0,this.bandwidth=0,this.renderer=e,this.replay=new _(e,this,10),this.setupIntervals(),this.onMessage=this.onMessage.bind(this)}get connecting(){return this.ws&&this.ws.readyState==WebSocket.CONNECTING}get connected(){return this.ws&&this.ws.readyState==WebSocket.OPEN}disconnect(){this.connected&&this.ws.close(),delete this.replay.curr,this.replay.resetTrack()}connect(e,t="",a=""){this.disconnect();const r=this.ws="string"==typeof e?new WebSocket(e):new l(e);this.ws.binaryType="arraybuffer",this.ws.onopen=()=>{this.renderer.clearCells();const e=new n;e.writeUInt8(69),e.writeInt16(420),e.writeUTF16String(t),e.writeUTF16String(a),this.ws.send(e.finalize()),this.emit("open"),delete this.ping},this.ws.onmessage=this.onMessage,this.ws.onerror=()=>self.postMessage({event:"error",message:"Connection failed"}),this.ws.onclose=t=>{this.bandwidth=0,delete this.map,delete this.ping,delete this.lastName,delete this.lastSkin,this.emit("close"),this.ws==r&&self.postMessage({event:"disconnect",code:t.code,reason:t.reason})}}setupIntervals(){this.pingInterval=self.setInterval(()=>{if(this.renderer.stats.bandwidth=this.bandwidth,this.bandwidth=0,this.connected&&this.pid&&!this.ping){const e=new ArrayBuffer(1);new Uint8Array(e)[0]=69,this.send(e),this.ping=Date.now(),this.replay.recordState()}},1e3);const e=this.renderer.state;this.mouseInterval=self.setInterval(()=>{if(this.connected&&this.pid){const t=new n;t.writeUInt8(3),t.writeFloat32(this.renderer.cursor.position[0]),t.writeFloat32(this.renderer.cursor.position[1]);const a=e.exchange();t.writeUInt8(a.spectate),t.writeUInt8(a.splits),t.writeUInt8(a.ejects),t.writeUInt8(a.macro),t.writeUInt8(a.lineLock),this.send(t.finalize()),a.respawn&&this.spawn(),a.clip&&this.replay.save()}},1e3/33)}send(e){this.connected&&this.ws.send(e)}onMessage(t){const e=new s(new DataView(t.data)),a=e.readUInt8();switch(this.bandwidth+=t.data.byteLength,a){case 1:this.pid=e.readUInt16(),this.map={hw:e.readUInt16(),hh:e.readUInt16()},console.log(`Map Dimension: ${this.map.hw<<1}x${this.map.hh<<1}`);const r=e.readUTF16String();this.emit("protocol"),self.postMessage({event:"connect",server:r});break;case 2:this.renderer.clearCells();break;case 3:const s=e.readUInt16(),n=e.readUTF16String(),i=e.readUTF16String();this.renderer.loadPlayerData({id:s,name:n,skin:i});break;case 4:this.parseCellData(t.data);break;case 5:this.parseLeaderboard(e);break;case 6:this.parseMinimap(e);break;case 7:if(this.parseStats(e),this.renderer.state.auto_respawn){const e=new ArrayBuffer(1);new Uint8Array(e)[0]=7,this.send(e)}break;case 10:const o=e.readUInt16(),l=e.readUTF16String(),d=this.renderer.playerData[o];if(!d)return console.warn(`Received unknown pid: ${o}, message: ${l}`);self.postMessage({event:"chat",pid:o,player:d,message:l});break;case 69:if(!this.ping)return;this.renderer.stats.ping=Date.now()-this.ping,delete this.ping;}!this.replaying&&f.includes(a)&&this.replay.recordPacket(t.data)}get player(){return this.renderer.playerData[this.pid]}parsePlayers(e){const t=new s(new DataView(e)),a=t.readUInt8();for(let r=0;r<a;r++){const e={id:t.readUInt8(),name:t.readUTF16String(),skin:t.readUTF16String()};this.renderer.loadPlayerData(e)}}parseCellData(e){this.lastPacket=this.renderer.lastTimestamp;const t=this.renderer.core,a=new DataView(e,1,15),r=this.renderer.stats.mycells,s=a.getUint16(0,!0);this.replaying&&!r&&s&&(this.renderer.shouldTP=!0),this.renderer.stats.mycells=s,this.renderer.stats.linelocked=a.getUint8(2),this.renderer.stats.score=a.getFloat32(3,!0),this.renderer.target.position[0]=a.getFloat32(7,!0),this.renderer.target.position[1]=a.getFloat32(11,!0),t.HEAPU8.set(new Uint8Array(e,16),this.renderer.cellTypesTableOffset),t.instance.exports.deserialize(0,this.renderer.cellTypesTableOffset)}parseLeaderboard(e){const t=e.readInt16(),a=e.readUInt8(),r={rank:t,me:this.player,players:[]};for(let t=0;t<a;t++)r.players.push(this.renderer.playerData[e.readUInt8()]);self.postMessage({event:"leaderboard",lb:r})}parseMinimap(e){const t=e.readUInt8(),a=[];for(let r=0;r<t;r++){const t=e.readUInt8(),r=this.renderer.playerData[t]||{};r.id=t,t==this.pid&&(r.me=!0);const s=e.readFloat32(),n=e.readFloat32();r.x=s/(this.map.hw<<1)+.5,r.y=n/(this.map.hh<<1)+.5,r.score=e.readFloat32(),a.push(r)}self.postMessage({event:"minimap",minimap:a})}parseStats(e){const t=e.readUInt32(),a=e.readFloat32(),r=e.readFloat32();self.postMessage({event:"stats",kills:t,score:a,surviveTime:r})}spawn(e=this.lastName,t=this.lastSkin){this.lastName=e,this.lastSkin=t;const a=new n;a.writeUInt8(1),a.writeUTF16String(e),a.writeUTF16String(t),this.send(a.finalize())}sendChat(e){const t=new n;t.writeUInt8(10),t.writeUTF16String(e),this.send(t.finalize()),this.pid&&self.postMessage({event:"chat",pid:this.pid,player:this.player,message:e})}get replaying(){return!!this.replay.curr}async startReplay(e=0){this.disconnect(),this.renderer.cleanup(),await this.replay.load(e)}}},{"../../src/network/reader":18,"../../src/network/writer":19,"./custom-bson":20,"./fake-socket":21,"./replay-db":25,events:1}],24:[function(e,t){var a=Math.max,r=Math.min;self.importScripts&&importScripts("https://cdnjs.cloudflare.com/ajax/libs/gl-matrix/2.8.1/gl-matrix-min.js");const s=e("./stats"),n=e("./mouse"),i=e("./state"),o=e("./viewport"),l=e("./protocol"),d=e("./wasm-core"),_=e("./texture-store"),{makeProgram:f,pick:u,getColor:c}=e("./util"),{CELL_VERT_SHADER_SOURCE:p,CELL_FRAG_PEELING_SHADER_SOURCE:h,NAME_VERT_SHADER_SOURCE:m,NAME_FRAG_PEELING_SHADER_SOURCE:g,MASS_VERT_SHADER_SOURCE:b,MASS_FRAG_PEELING_SHADER_SOURCE:E,QUAD_VERT_SHADER_SOURCE:R,BLEND_BACK_FRAG_SHADER_SOURCE:w,FINAL_FRAG_SHADER_SOURCE:T,BORDER_VERT_SHADER_SOURCE:x,BORDER_FRAG_SHADER_SOURCE:A}=e("./shaders"),v=0,U=.25,B=-.33,F=256,k=65536,L=30,D=65536,S=-99999,O=["0","1","2","3","4","5","6","7","8","9",".","k"],C=O.length;class I{constructor(e){this.canvas=e,this.fbo=new Map,this.buffers=new Map,this.uniforms=new Map,this.playerData=Array.from({length:256}),this.playerData[0]={name:"Server"},this.updates=[],this.stats=new s,this.mouse=new n,this.state=new i,this.viewport=new o,this.core=new d(this),this.viewbox={t:0,b:0,l:0,r:0},this.initLoader(),this.drawCells=this.drawCells.bind(this),this.drawNames=this.drawNames.bind(this),this.drawMass=this.drawMass.bind(this),this.fps=0,this.fpsInterval=setInterval(()=>{this.stats.fps=this.fps,this.fps=0},1e3)}start(){if(this.r)return!1;const e=t=>{this.r=requestAnimationFrame(e);try{this.render(t)}catch(t){this.stop(),console.error(t)}};return this.r=requestAnimationFrame(e),!0}stop(){return!!this.r&&(this.r=cancelAnimationFrame(this.r),!0)}loadPlayerData({id:e,skin:t,name:a,persist:r}){this.IGNORE_SKIN&&250>=e&&(t="");const s=this.playerData[e];s?(this.store.replace(s.name,a)&&this.loader.postMessage({id:e,name:a}),this.store.replace(s.skin,t)&&this.loader.postMessage({id:e,skin:t})):(this.store.add(a,r)&&this.loader.postMessage({id:e,name:a}),this.store.add(t,r)&&this.loader.postMessage({id:e,skin:t})),this.playerData[e]={skin:t,name:a}}initLoader(){this.loader=new Worker(self.window?"js/loader.min.js":"loader.min.js"),this.loader.onmessage=t=>this.updates.unshift(t.data)}loadUniform(e,t){this.uniforms.has(e)||this.uniforms.set(e,new Map),this.uniforms.get(e).set(t,this.gl.getUniformLocation(e,t))}getUniform(e,t){return this.uniforms.get(e).get(t)}async initEngine(){const e=this.gl=this.canvas.getContext("webgl2",{premultipliedAlpha:!1,powerPreference:"high-performance",preserveDrawingBuffer:!0});if(!e)return console.error("WebGL2 Not Supported");console.log("Loading WASM..."),await this.core.load(),console.log("Loading font");let t=new FontFace("Bree Serif","url(/static/font/BreeSerif-Regular.ttf)");if(self.fonts&&fonts.add(t),await t.load(),t=new FontFace("Lato","url(/static/font/Lato-Bold.ttf)"),self.fonts&&fonts.add(t),await t.load(),!self.mat4){console.log("Loading glMatrix library");const e=document.createElement("script");e.src="https://cdnjs.cloudflare.com/ajax/libs/gl-matrix/2.8.1/gl-matrix-min.js",document.body.appendChild(e),await new Promise(t=>e.onload=t)}if(this.cursor={position:vec3.create()},this.target={position:vec3.create(),scale:10},this.camera={position:vec3.create(),scale:10},this.shouldTP=!1,this.proj=mat4.create(),this.bots={names:[],skins:[]},this.IGNORE_SKIN=this.state.ignore_skin,this.SKIN_DIM=this.state.skin_dim,this.BYTES_PER_CELL_DATA=this.core.instance.exports.bytes_per_cell_data(),this.BYTES_PER_RENDER_CELL=this.core.instance.exports.bytes_per_render_cell(),this.cellDataBufferLength=this.cellTypesTableOffset=k*this.BYTES_PER_CELL_DATA,console.log(`Table offset: ${this.cellTypesTableOffset}`),this.cellBufferOffset=this.cellTypesTableOffset+2*F,console.log(`Render buffers offset: ${this.cellBufferOffset}`),this.cellBufferEnd=this.cellBufferOffset+k*this.BYTES_PER_RENDER_CELL,console.log(`Render buffer end ${this.cellBufferEnd}`),this.nameBufferOffset=this.cellBufferEnd+2*F,this.nameBufferEnd=this.nameBufferOffset+k*this.BYTES_PER_RENDER_CELL,console.log(`Memory allocated: ${this.core.buffer.byteLength} bytes`),this.cellTypesTable=new Uint16Array(this.core.buffer,this.cellTypesTableOffset,F),this.nameTypesTable=new Uint16Array(this.core.buffer,this.cellBufferEnd,F),this.renderBuffer=this.core.HEAPU8.subarray(this.cellBufferOffset,this.cellBufferEnd),this.renderBufferView=new DataView(this.core.buffer,this.cellBufferOffset,k*this.BYTES_PER_RENDER_CELL),this.massWidthsTable=new Map,this.massBuffer=new Float32Array(new ArrayBuffer(128*k)),this.store=new _(this),!e.getExtension("EXT_color_buffer_float"))return void console.error("FLOAT color buffer not available");e.enable(e.BLEND),e.depthMask(!1),e.disable(e.DEPTH_TEST),e.disable(e.CULL_FACE),e.blendFunc(e.ONE,e.ONE_MINUS_SRC_ALPHA);const a=this.peel_prog1=f(e,p,h),r=this.peel_prog2=f(e,m,g),s=this.peel_prog3=f(e,b,E),n=this.blend_prog=f(e,R,w),i=this.final_prog=f(e,R,T),o=this.border_prog=f(e,x,A);for(const e of[a,r,s])this.loadUniform(e,"u_proj"),this.loadUniform(e,"u_depth"),this.loadUniform(e,"u_front_color");this.loadUniform(a,"u_skin"),this.loadUniform(a,"u_circle"),this.loadUniform(a,"u_circle_color"),this.loadUniform(r,"u_dim"),this.loadUniform(r,"u_name"),this.loadUniform(s,"u_uvs"),this.loadUniform(s,"u_mass_char"),this.loadUniform(n,"u_back_color"),this.loadUniform(o,"u_map"),this.loadUniform(o,"u_proj"),this.loadUniform(o,"u_color"),this.loadUniform(i,"u_front_color"),this.loadUniform(i,"u_back_color"),this.setUpPeelingBuffers(),this.generateQuadVAO(),this.generateMassVAO(),this.generateCircleTexture(),this.generateMassTextures(),this.allocBuffer("cell_data_buffer"),e.bindVertexArray(this.quadVAO),e.bindBuffer(e.ARRAY_BUFFER,this.buffers.get("cell_data_buffer")),e.bufferData(e.ARRAY_BUFFER,this.renderBuffer,e.DYNAMIC_DRAW),e.vertexAttribPointer(1,3,e.FLOAT,!1,0,0),e.vertexAttribDivisor(1,2),e.enableVertexAttribArray(1),e.useProgram(a),e.uniform1i(this.getUniform(a,"u_circle"),10),e.uniform1i(this.getUniform(a,"u_skin"),11),e.useProgram(r),e.uniform1i(this.getUniform(r,"u_name"),12),e.useProgram(s),e.uniform1i(this.getUniform(s,"u_mass_char"),13),e.useProgram(i),e.uniform1i(this.getUniform(i,"u_back_color"),6),e.activeTexture(e.TEXTURE11),this.empty_texture=e.createTexture(),e.bindTexture(e.TEXTURE_2D,this.empty_texture),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,null);const d=12/255;e.useProgram(o),e.uniform4f(this.getUniform(o,"u_color"),d,d,d,1),this.loadPlayerData({id:253,skin:`/static/img/virus-${this.SKIN_DIM}.png`,persist:!0}),this.start(),this.protocol=new l(this),this.protocol.on("close",this.cleanup.bind(this)),await this.protocol.replay.init()}cleanup(){this.protocol.replaying||(this.clearCells(),this.clearScreen(),this.clearPlayerData(),this.store.clear(),this.stats.reset())}teleportCamera(){this.camera.scale=this.target.scale,this.camera.position.set(this.target.position),this.shouldTP=!1}clearCells(){this.core.HEAPU32.fill(0),this.massBuffer.fill(0)}clearPlayerData(){for(let e=1;250>=e;e++)this.playerData[e]=void 0}randomPlayer(){return{skin:u(this.bots.skins),name:u(this.bots.names)}}async genCells(){for(let e=1;256>e;e++)this.loadPlayerData({id:e,...this.randomPlayer()});this.GEN_CELLS=65536;const e=new DataView(this.core.buffer,0,this.GEN_CELLS*this.BYTES_PER_CELL_DATA),t=(e,t)=>Math.random()*(t-e)+e;for(let a=0;a<this.GEN_CELLS;a++){const r=this.BYTES_PER_CELL_DATA*a,s=~~(255*Math.random()+1),n=~~t(-D,D)+s/10,i=~~t(-D,D)+s/10,o=t(L,L+200);e.setUint32(0+r,s,!0),e.setFloat32(4+r,n,!0),e.setFloat32(8+r,i,!0),e.setFloat32(12+r,o,!0),e.setFloat32(16+r,n,!0),e.setFloat32(20+r,i,!0),e.setFloat32(24+r,o,!0),e.setFloat32(28+r,n,!0),e.setFloat32(32+r,i,!0),e.setFloat32(36+r,o,!0)}}get RGBABytes(){return 4*(this.gl.drawingBufferWidth*this.gl.drawingBufferHeight)}screenshot(e){const t=this.gl;t.readPixels(0,0,t.drawingBufferWidth,t.drawingBufferHeight,t.RGBA,t.UNSIGNED_BYTE,e)}allocBuffer(e){if(this.buffers.has(e))throw new Error(`Already allocated buffer "${e}"`);const t=this.gl.createBuffer();return this.buffers.set(e,t),t}allocFrameBuffer(e,t=1){if(this.fbo.has(e))throw new Error(`Already allocated framebuffer "${e}"`);this.fbo.set(e,1==t?this.gl.createFramebuffer():Array.from({length:t},()=>this.gl.createFramebuffer()))}freeFrameBuffer(e){if(!this.fbo.has(e))throw new Error(`Trying to free none existing framebuffer "${e}`);const t=this.fbo.get(e);if(Array.isArray(t))for(const e of t)this.gl.deleteFramebuffer(e);else this.gl.deleteFramebuffer(t);this.fbo.delete(e)}rellocPeelingBuffers(e,t){e<=this.FBO_WIDTH&&t<=this.FBO_HEIGHT||(console.log(`Reallocating framebuffers to [${e}, ${t}]`),this.freeFrameBuffer("peel_depths"),this.freeFrameBuffer("peel_colors"),this.freeFrameBuffer("blend_back"),this.setUpPeelingBuffers(e,t))}setUpPeelingBuffers(e=1920,t=1080){this.FBO_WIDTH=e,this.FBO_HEIGHT=t,this.allocFrameBuffer("peel_depths",2),this.allocFrameBuffer("peel_colors",2),this.allocFrameBuffer("blend_back");const a=this.gl,r=()=>{a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.NEAREST),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.NEAREST),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE)};for(let s=0;2>s;s++){a.bindFramebuffer(a.FRAMEBUFFER,this.fbo.get("peel_depths")[s]);const n=3*s,i=a.createTexture();a.activeTexture(a.TEXTURE0+n),a.bindTexture(a.TEXTURE_2D,i),r(),a.texImage2D(a.TEXTURE_2D,0,a.RG32F,e,t,0,a.RG,a.FLOAT,null),a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,i,0);const o=a.createTexture();a.activeTexture(a.TEXTURE1+n),a.bindTexture(a.TEXTURE_2D,o),r(),a.texImage2D(a.TEXTURE_2D,0,a.RGBA16F,e,t,0,a.RGBA,a.HALF_FLOAT,null),a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT1,a.TEXTURE_2D,o,0);const l=a.createTexture();a.activeTexture(a.TEXTURE2+n),a.bindTexture(a.TEXTURE_2D,l),r(),a.texImage2D(a.TEXTURE_2D,0,a.RGBA16F,e,t,0,a.RGBA,a.HALF_FLOAT,null),a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT2,a.TEXTURE_2D,l,0),a.bindFramebuffer(a.FRAMEBUFFER,this.fbo.get("peel_colors")[s]),a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,o,0),a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT1,a.TEXTURE_2D,l,0)}{a.bindFramebuffer(a.FRAMEBUFFER,this.fbo.get("blend_back"));const s=a.createTexture();a.activeTexture(a.TEXTURE6),a.bindTexture(a.TEXTURE_2D,s),r(),a.texImage2D(a.TEXTURE_2D,0,a.RGBA16F,e,t,0,a.RGBA,a.HALF_FLOAT,null),a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,s,0),a.bindFramebuffer(a.FRAMEBUFFER,null)}}clearPeelingBuffers(){const e=this.gl;e.bindFramebuffer(e.DRAW_FRAMEBUFFER,this.fbo.get("blend_back")),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT),e.bindFramebuffer(e.DRAW_FRAMEBUFFER,this.fbo.get("peel_depths")[0]),e.drawBuffers([e.COLOR_ATTACHMENT0]),e.clearColor(S,S,0,0),e.clear(e.COLOR_BUFFER_BIT),e.bindFramebuffer(e.DRAW_FRAMEBUFFER,this.fbo.get("peel_depths")[1]),e.clearColor(-0,1,0,0),e.clear(e.COLOR_BUFFER_BIT),e.bindFramebuffer(e.DRAW_FRAMEBUFFER,this.fbo.get("peel_colors")[0]),e.drawBuffers([e.COLOR_ATTACHMENT0,e.COLOR_ATTACHMENT1]),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT),e.bindFramebuffer(e.DRAW_FRAMEBUFFER,this.fbo.get("peel_colors")[1]),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT),e.bindFramebuffer(e.DRAW_FRAMEBUFFER,this.fbo.get("peel_depths")[0]),e.drawBuffers([e.COLOR_ATTACHMENT0]),e.blendEquation(e.MAX);for(const t of[this.peel_prog1,this.peel_prog2,this.peel_prog3])e.useProgram(t),e.uniform1i(this.getUniform(t,"u_depth"),3),e.uniform1i(this.getUniform(t,"u_front_color"),4)}generateQuadVAO(){const e=this.gl,t=this.quadVAO=e.createVertexArray();e.bindVertexArray(t);const a=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,a),e.bufferData(e.ARRAY_BUFFER,new Float32Array([-1,1,-1,-1,1,-1,-1,1,1,-1,1,1]),e.STATIC_DRAW);{const t=e.FLOAT;e.vertexAttribPointer(0,2,t,!1,0,0),e.enableVertexAttribArray(0)}}generateMassVAO(){const e=this.gl,t=this.massVAO=e.createVertexArray();e.bindVertexArray(t);const a=this.allocBuffer("mass_buffer");e.bindBuffer(e.ARRAY_BUFFER,a),e.bufferData(e.ARRAY_BUFFER,this.massBuffer,e.DYNAMIC_DRAW);{const t=e.FLOAT;e.vertexAttribPointer(0,4,t,!1,0,0),e.enableVertexAttribArray(0)}}generateCircleTexture(){const e=this.gl,t=e.createTexture();e.activeTexture(e.TEXTURE10),e.bindTexture(e.TEXTURE_2D,t);{const t=this.state.circle_radius;console.log(`Generating ${t<<1}x${t<<1} circle texture`);const a=self.window?document.createElement("canvas"):new OffscreenCanvas(t<<1,t<<1);self.window&&(a.width=a.height=t<<1);const r=a.getContext("2d");r.fillStyle="white",r.arc(t,t,t,0,2*Math.PI,!1),r.fill(),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,a),e.generateMipmap(e.TEXTURE_2D),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR_MIPMAP_LINEAR)}}generateMassTextures(){console.log("Generating mass characters");const e=this.gl,t=e.createTexture();e.activeTexture(e.TEXTURE13),e.bindTexture(e.TEXTURE_2D_ARRAY,t);const a=320,r=320;{e.texImage3D(e.TEXTURE_2D_ARRAY,0,e.RGBA,a,r,C,0,e.RGBA,e.UNSIGNED_BYTE,null);const t=self.window?document.createElement("canvas"):new OffscreenCanvas(a,r);self.window&&(t.width=a,t.height=r);const s=t.getContext("2d");s.font="bold 280px Lato",s.fillStyle="white",s.strokeStyle="black",s.textAlign="center",s.lineWidth=30,s.textBaseline="middle";const n=new Float32Array(2*(4*C));for(let i=0;i<C;i++){const o=O[i];s.clearRect(0,0,t.width,t.height),s.strokeText(o,t.width>>1,t.height>>1),s.fillText(o,t.width>>1,t.height>>1);const l=(s.measureText(o).width+20)/t.width;this.massWidthsTable.set(o,l),e.texSubImage3D(e.TEXTURE_2D_ARRAY,0,0,0,i,a,r,1,e.RGBA,e.UNSIGNED_BYTE,t);const d=.5-l/2,_=.5+l/2,f=0,u=1;n[8*i+0]=d,n[8*i+1]=f,n[8*i+2]=_,n[8*i+3]=f,n[8*i+4]=d,n[8*i+5]=u,n[8*i+6]=_,n[8*i+7]=u}e.generateMipmap(e.TEXTURE_2D_ARRAY),e.texParameteri(e.TEXTURE_2D_ARRAY,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D_ARRAY,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D_ARRAY,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D_ARRAY,e.TEXTURE_MIN_FILTER,e.LINEAR_MIPMAP_LINEAR),e.useProgram(this.peel_prog3),e.uniform2fv(this.getUniform(this.peel_prog3,"u_uvs"),n)}}screenToWorld(e=vec3.create(),t=0,a=0){const r=mat4.create();mat4.invert(r,this.proj),vec3.transformMat4(e,[t,-a,0],r)}updateTarget(){this.screenToWorld(this.cursor.position,2*(this.mouse.x/this.viewport.width)-1,2*(this.mouse.y/this.viewport.height)-1);const e=this.mouse.resetScroll();this.target.scale*=1+e/1e3,this.target.scale=r(a(this.target.scale,.01),1e4)}lerpCamera(e=1/60,t){const s=r(a(e*this.state.zoom,0),1);vec3.lerp(this.camera.position,this.camera.position,this.target.position,e),this.camera.scale+=(this.target.scale-this.camera.scale)*s;const n=t?t.x:this.camera.position[0],i=t?t.y:this.camera.position[1],o=this.viewport.width*this.camera.scale/2,l=this.viewport.height*this.camera.scale/2,d=this.viewbox;mat4.ortho(this.proj,d.l=n-o,d.r=n+o,d.b=i-l,d.t=i+l,0,1)}checkViewport(){const e=this.gl;(e.canvas.width!=this.viewport.width||e.canvas.height!=this.viewport.height)&&(e.canvas.width=this.viewport.width,e.canvas.height=this.viewport.height)}drawCells(){const e=this.gl;e.bindVertexArray(this.quadVAO),e.activeTexture(e.TEXTURE11),this.state.skin||e.bindTexture(e.TEXTURE_2D,this.empty_texture);for(let t=1;t<F;t++){let a=this.cellTypesTable[t-1],r=this.cellTypesTable[t];if(a==r)continue;r||(r=65536);const s=this.cellBufferOffset+a*this.BYTES_PER_RENDER_CELL,n=new Float32Array(this.core.buffer,s,3*(r-a));if(253==t)e.uniform4f(this.getUniform(this.peel_prog1,"u_circle_color"),0,0,0,0);else if(251==t)e.uniform4f(this.getUniform(this.peel_prog1,"u_circle_color"),.5,.5,.5,.5);else{const a=c(t);e.uniform4f(this.getUniform(this.peel_prog1,"u_circle_color"),a[0],a[1],a[2],1)}const i=this.store.get(this.playerData[t]&&this.playerData[t].skin),o=!(this.state.skin||250<t)||!i||!i.tex;e.bindTexture(e.TEXTURE_2D,o?this.empty_texture:i.tex),e.bindBuffer(e.ARRAY_BUFFER,this.buffers.get("cell_data_buffer")),e.bufferSubData(e.ARRAY_BUFFER,0,n),e.bindBuffer(e.ARRAY_BUFFER,null);const l=2*(r-a);e.drawArraysInstanced(e.TRIANGLES,0,6,l)}}drawNames(){const e=this.gl;e.bindVertexArray(this.quadVAO),e.activeTexture(e.TEXTURE12);for(let t=1;t<F;t++){if(!this.playerData[t])continue;let a=this.nameTypesTable[t-1],r=this.nameTypesTable[t];if(a==r)continue;r||(r=65536);const s=this.store.get(this.playerData[t]&&this.playerData[t].name);if(!s||!s.tex)continue;this.state.name&&250>=t&&e.bindTexture(e.TEXTURE_2D,s?s.tex:this.empty_texture);const n=this.nameBufferOffset+a*this.BYTES_PER_RENDER_CELL,i=new Float32Array(this.core.buffer,n,3*(r-a));e.uniform4f(this.getUniform(this.peel_prog2,"u_dim"),s.dim[0]/512,s.dim[1]/512,.25,-.03),e.bindBuffer(e.ARRAY_BUFFER,this.buffers.get("cell_data_buffer")),e.bufferSubData(e.ARRAY_BUFFER,0,i),e.bindBuffer(e.ARRAY_BUFFER,null);const o=2*(r-a);e.drawArraysInstanced(e.TRIANGLES,0,6,o)}}drawMass(){const e=this.renderMassBuffer.length>>2;if(!(e%3)&&e){const e=this.gl;e.bindVertexArray(this.massVAO),e.bindBuffer(e.ARRAY_BUFFER,this.buffers.get("mass_buffer")),e.bufferSubData(e.ARRAY_BUFFER,0,this.renderMassBuffer),e.bindBuffer(e.ARRAY_BUFFER,null),e.drawArrays(e.TRIANGLES,0,this.renderMassBuffer.length>>2)}}buildMassBuffer(e){let t=0;for(let a=0;a<e.length;a+=4){const r=e[a],s=e[a+1],n=e[a+2],o=this.state.mass-1?Math.floor(e[a+3]).toString():1e3<e[a+3]?(e[a+3]/1e3).toFixed(1)+"k":e[a+3];let l=(o.length-1)*v*U;for(let e=0;e<o.length;e++)l+=U*this.massWidthsTable.get(o[e]);let d=-l/2;for(let e=0;e<o.length;e++){const a="."==o[e]?10:"k"==o[e]?11:~~o[e],i=this.massWidthsTable.get(o[e]),l=d*n,_=l+U*i*n,f=(+.5*U+B)*n,u=(-.5*U+B)*n;d+=U*i+v,this.massBuffer[t++]=r+l,this.massBuffer[t++]=s+f,this.massBuffer[t++]=n,this.massBuffer[t++]=4*a+0,this.massBuffer[t++]=r+_,this.massBuffer[t++]=s+f,this.massBuffer[t++]=n,this.massBuffer[t++]=4*a+1,this.massBuffer[t++]=r+l,this.massBuffer[t++]=s+u,this.massBuffer[t++]=n,this.massBuffer[t++]=4*a+2,this.massBuffer[t++]=r+_,this.massBuffer[t++]=s+f,this.massBuffer[t++]=n,this.massBuffer[t++]=4*a+1,this.massBuffer[t++]=r+l,this.massBuffer[t++]=s+u,this.massBuffer[t++]=n,this.massBuffer[t++]=4*a+2,this.massBuffer[t++]=r+_,this.massBuffer[t++]=s+u,this.massBuffer[t++]=n,this.massBuffer[t++]=4*a+3}}this.renderMassBuffer=this.massBuffer.subarray(0,t)}render(e){if(!this.lastTimestamp)return void(this.lastTimestamp=e);this.fps++;const t=e-this.lastTimestamp;this.protocol.replay.update(t),this.lastTimestamp=e,this.cellTypesTable.fill(0),this.nameTypesTable.fill(0);const a=this.protocol.lastPacket?(e-this.protocol.lastPacket)/this.state.draw:0,r=this.core.instance.exports.draw_cells(0,this.cellTypesTableOffset,this.cellBufferOffset,a,this.viewbox.t,this.viewbox.b,this.viewbox.l,this.viewbox.r);let s=0;this.updateTarget();if(this.shouldTP?this.teleportCamera():this.lerpCamera(t/this.state.draw,null),this.checkViewport(),!this.state.visible)return void this.updateTextures();const n=this.gl;n.viewport(0,0,n.drawingBufferWidth,n.drawingBufferHeight),this.rellocPeelingBuffers(n.drawingBufferWidth,n.drawingBufferHeight);let i;this.clearPeelingBuffers();const o=[this.peel_prog1],l=[this.drawCells];(this.state.mass||this.state.name)&&(s=this.core.instance.exports.draw_text(0,this.cellTypesTableOffset,this.cellBufferEnd,this.nameBufferOffset,this.nameBufferEnd,.03,this.viewbox.t,this.viewbox.b,this.viewbox.l,this.viewbox.r),this.state.name&&(o.push(this.peel_prog2),l.push(this.drawNames)),this.state.mass&&(this.buildMassBuffer(new Float32Array(this.core.buffer,this.nameBufferEnd,4*s)),o.push(this.peel_prog3),l.push(this.drawMass))),i=this.depthPeelRender(2,o,l),this.stats.cells=r,this.stats.text=s,this.clearScreen(),n.blendFunc(n.ONE,n.ONE_MINUS_SRC_ALPHA),n.bindVertexArray(this.quadVAO),this.protocol.map&&(n.useProgram(this.border_prog),n.uniform2f(this.getUniform(this.border_prog,"u_map"),this.protocol.map.hw,this.protocol.map.hh),n.uniformMatrix4fv(this.getUniform(this.border_prog,"u_proj"),!1,this.proj),n.drawArrays(n.TRIANGLES,0,6)),n.useProgram(this.final_prog),n.uniform1i(this.getUniform(this.final_prog,"u_front_color"),i+1),n.drawArrays(n.TRIANGLES,0,6),this.updateTextures(),this.lastDraw=e}serializeState(){return this.core.buffer.slice(this.cellBufferOffset,this.core.instance.exports.serialize_state(0,this.cellDataBufferLength,this.cellBufferOffset))}updateTextures(){const e=this.gl;if(this.updates.length){e.activeTexture(e.TEXTURE11);for(let e=2;this.updates.length&&e--;){const{id:t,skin:a,name:r}=this.updates.pop(),s=this.playerData[t];if(s&&(this.store.setData(s.skin,a),this.store.setData(s.name,r)),2<++e)break}}}depthPeelRender(e=4,t,a){const r=this.gl;for(let s in t)r.useProgram(t[s]),r.uniformMatrix4fv(this.getUniform(t[s],"u_proj"),!1,this.proj),a[s](!0);let s,n,o,l;for(let d=0;d<e;d++){for(let e in s=d%2,n=1-s,r.bindFramebuffer(r.DRAW_FRAMEBUFFER,this.fbo.get("peel_depths")[n]),r.drawBuffers([r.COLOR_ATTACHMENT0]),r.clearColor(S,S,0,0),r.clear(r.COLOR_BUFFER_BIT),r.bindFramebuffer(r.DRAW_FRAMEBUFFER,this.fbo.get("peel_colors")[n]),r.drawBuffers([r.COLOR_ATTACHMENT0,r.COLOR_ATTACHMENT1]),r.clearColor(0,0,0,0),r.clear(r.COLOR_BUFFER_BIT),r.bindFramebuffer(r.DRAW_FRAMEBUFFER,this.fbo.get("peel_depths")[n]),r.drawBuffers([r.COLOR_ATTACHMENT0,r.COLOR_ATTACHMENT1,r.COLOR_ATTACHMENT2]),r.blendEquation(r.MAX),o=3*s,t)r.useProgram(t[e]),r.uniform1i(this.getUniform(t[e],"u_depth"),o),r.uniform1i(this.getUniform(t[e],"u_front_color"),o+1),a[e]();l=3*n,r.bindFramebuffer(r.DRAW_FRAMEBUFFER,this.fbo.get("blend_back")),r.drawBuffers([r.COLOR_ATTACHMENT0]),r.blendEquation(r.FUNC_ADD),r.blendFuncSeparate(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA,r.ONE,r.ONE_MINUS_SRC_ALPHA),r.useProgram(this.blend_prog),r.uniform1i(this.getUniform(this.blend_prog,"u_back_color"),l+2),r.bindVertexArray(this.quadVAO),r.drawArrays(r.TRIANGLES,0,6)}return l}clearScreen(){const e=this.gl;e.bindFramebuffer(e.FRAMEBUFFER,null),e.clearColor(0,0,0,1),e.clear(e.COLOR_BUFFER_BIT)}}self.window?self.Renderer=I:self.addEventListener("message",async function(t){const{data:e}=t,a=self.r=new I(e.offscreen);a.stats.setBuffer(e.stats),a.mouse.setBuffer(e.mouse),a.state.setBuffer(e.state),a.viewport.setBuffer(e.viewport),await a.initEngine(),self.addEventListener("message",t=>{const e=a.protocol;t.data.connect&&!e.connecting&&e.connect(t.data.connect,t.data.name,t.data.skin),t.data.spawn&&(e.connecting?e.once("protocol",()=>e.spawn(t.data.name,t.data.skin)):e.spawn(t.data.name,t.data.skin)),t.data.chat&&e.sendChat(t.data.chat),t.data.replay&&e.startReplay(t.data.replay)}),self.postMessage({event:"ready"})},{once:!0}),t.exports=I},{"./mouse":22,"./protocol":23,"./shaders":26,"./state":27,"./stats":28,"./texture-store":29,"./util":30,"./viewport":31,"./wasm-core":32}],25:[function(e,t){t.exports=()=>new Promise((e,t)=>{const a=indexedDB.open("ogar69-replay");a.onupgradeneeded=t=>{console.log("Creating replay object store");const e=t.target.result;e.createObjectStore("replay-meta"),e.createObjectStore("replay-data")},a.onsuccess=()=>e(a.result),a.onerror=t})},{}],26:[function(e,t){t.exports.CELL_VERT_SHADER_SOURCE=`#version 300 es
precision highp float;

uniform mat4 u_proj;

layout(location=0) in vec2 a_position;
layout(location=1) in vec3 a_data;

out vec2 v_texcoord;

void main() {

    vec4 world_pos = vec4(a_position * a_data.z + a_data.xy, -1.0 / pow(a_data.z, 0.333f), 1.0);
    gl_Position = u_proj * world_pos;

    // Map from -1 to 1 -> 0 to 1
    v_texcoord = (vec2(a_position.x, -a_position.y) + 1.0) / 2.0;
}
`,t.exports.CELL_FRAG_PEELING_SHADER_SOURCE=`#version 300 es

precision highp float;
precision highp int;
precision highp sampler2D;

#define MAX_DEPTH 99999.0

uniform vec4 u_circle_color;

uniform sampler2D u_skin;
uniform sampler2D u_circle;

uniform sampler2D u_depth;
uniform sampler2D u_front_color;

in vec2 v_texcoord;

layout(location=0) out vec2 depth;  // RG32F, R - negative front depth, G - back depth
layout(location=1) out vec4 frontColor;
layout(location=2) out vec4 backColor;

void main() {

    float fragDepth = gl_FragCoord.z;   // 0 - 1

    ivec2 fragCoord = ivec2(gl_FragCoord.xy);
    vec2 lastDepth = texelFetch(u_depth, fragCoord, 0).rg;
    vec4 lastFrontColor = texelFetch(u_front_color, fragCoord, 0);

    // depth value always increases
    // so we can use MAX blend equation
    depth.rg = vec2(-MAX_DEPTH);

    // front color always increases
    // so we can use MAX blend equation
    frontColor = lastFrontColor;

    // back color is separately blend afterwards each pass
    backColor = vec4(0.0);

    float nearestDepth = -lastDepth.x;
    float furthestDepth = lastDepth.y;
    float alphaMultiplier = 1.0 - lastFrontColor.a;
    vec4 circle = texture(u_circle, v_texcoord);

    if (fragDepth < nearestDepth || fragDepth > furthestDepth || circle.a == 0.0f) {
        // Skip this depth since it's been peeled.
        return;
    }

    if (fragDepth > nearestDepth && fragDepth < furthestDepth) {
        // This needs to be peeled.
        // The ones remaining after MAX blended for 
        // all need-to-peel will be peeled next pass.
        depth.rg = vec2(-fragDepth, fragDepth);
        return;
    }
    vec4 skin = texture(u_skin, v_texcoord);
    vec4 color = vec4(mix(u_circle_color.rgb * u_circle_color.a, skin.rgb, skin.a), 
        mix(skin.a, circle.a, u_circle_color.a));

    if (fragDepth == nearestDepth) {
        frontColor.rgb += color.rgb * color.a * alphaMultiplier;
        frontColor.a = 1.0 - alphaMultiplier * (1.0 - color.a);
    } else {
        backColor += color;
    }
}
`,t.exports.NAME_VERT_SHADER_SOURCE=`#version 300 es
precision highp float;

uniform mat4 u_proj;
uniform vec4 u_dim;

layout(location=0) in vec2 a_position;
layout(location=1) in vec3 a_data;

out vec2 v_texcoord;

void main() {
    vec2 obj_pos = a_position * u_dim.xy * u_dim.z + vec2(0, u_dim.w);
    vec4 world_pos = vec4(obj_pos * a_data.z + a_data.xy, -1.0 / pow(a_data.z, 0.333f), 1.0);
    gl_Position = u_proj * world_pos;

    v_texcoord = (vec2(a_position.x, -a_position.y) + 1.0) / 2.0;
}
`,t.exports.NAME_FRAG_PEELING_SHADER_SOURCE=`#version 300 es

precision highp float;
precision highp int;
precision highp sampler2D;

#define MAX_DEPTH 99999.0

uniform sampler2D u_name;

uniform sampler2D u_depth;
uniform sampler2D u_front_color;

in vec2 v_texcoord;

layout(location=0) out vec2 depth;  // RG32F, R - negative front depth, G - back depth
layout(location=1) out vec4 frontColor;
layout(location=2) out vec4 backColor;

void main() {
    float fragDepth = gl_FragCoord.z;   // 0 - 1

    ivec2 fragCoord = ivec2(gl_FragCoord.xy);
    vec2 lastDepth = texelFetch(u_depth, fragCoord, 0).rg;
    vec4 lastFrontColor = texelFetch(u_front_color, fragCoord, 0);

    // depth value always increases
    // so we can use MAX blend equation
    depth.rg = vec2(-MAX_DEPTH);

    // front color always increases
    // so we can use MAX blend equation
    frontColor = lastFrontColor;

    // back color is separately blend afterwards each pass
    backColor = vec4(0.0);

    float nearestDepth = -lastDepth.x;
    float furthestDepth = lastDepth.y;
    float alphaMultiplier = 1.0 - lastFrontColor.a;

    vec4 color = texture(u_name, v_texcoord);

    if (fragDepth < nearestDepth || fragDepth > furthestDepth || color.a == 0.0f) {
        // Skip this depth since it's been peeled.
        return;
    }

    if (fragDepth > nearestDepth && fragDepth < furthestDepth) {
        // This needs to be peeled.
        // The ones remaining after MAX blended for 
        // all need-to-peel will be peeled next pass.
        depth.rg = vec2(-fragDepth, fragDepth);
        return;
    }

    if (fragDepth == nearestDepth) {
        frontColor.rgb += color.rgb * color.a * alphaMultiplier;
        frontColor.a = 1.0 - alphaMultiplier * (1.0 - color.a);
    } else {
        backColor += color;
    }
}
`,t.exports.MASS_VERT_SHADER_SOURCE=`#version 300 es
precision highp float;
precision highp int;

uniform mat4 u_proj;
uniform vec2 u_uvs[48];

layout(location=0) in vec4 a_position;

out vec2 v_texcoord;
flat out int character;

void main() {
    vec4 world_pos = vec4(a_position.xy, -1.0 / pow(a_position.z, 0.333f), 1.0);
    gl_Position = u_proj * world_pos;
    character = int(a_position.w) >> 2;
    v_texcoord = u_uvs[int(a_position.w)];
}
`,t.exports.MASS_FRAG_PEELING_SHADER_SOURCE=`#version 300 es

precision highp float;
precision highp int;
precision highp sampler2D;
precision highp sampler2DArray;

#define MAX_DEPTH 99999.0

uniform sampler2DArray u_mass_char;

uniform sampler2D u_depth;
uniform sampler2D u_front_color;

in vec2 v_texcoord;
flat in int character;

layout(location=0) out vec2 depth;  // RG32F, R - negative front depth, G - back depth
layout(location=1) out vec4 frontColor;
layout(location=2) out vec4 backColor;

void main() {
    float fragDepth = gl_FragCoord.z;   // 0 - 1

    ivec2 fragCoord = ivec2(gl_FragCoord.xy);
    vec2 lastDepth = texelFetch(u_depth, fragCoord, 0).rg;
    vec4 lastFrontColor = texelFetch(u_front_color, fragCoord, 0);

    // depth value always increases
    // so we can use MAX blend equation
    depth.rg = vec2(-MAX_DEPTH);

    // front color always increases
    // so we can use MAX blend equation
    frontColor = lastFrontColor;

    // back color is separately blend afterwards each pass
    backColor = vec4(0.0);

    float nearestDepth = -lastDepth.x;
    float furthestDepth = lastDepth.y;
    float alphaMultiplier = 1.0 - lastFrontColor.a;

    vec4 color = texture(u_mass_char, vec3(v_texcoord, character));

    if (fragDepth < nearestDepth || fragDepth > furthestDepth || color.a == 0.0f) {
        // Skip this depth since it's been peeled.
        return;
    }

    if (fragDepth > nearestDepth && fragDepth < furthestDepth) {
        // This needs to be peeled.
        // The ones remaining after MAX blended for 
        // all need-to-peel will be peeled next pass.
        depth.rg = vec2(-fragDepth, fragDepth);
        return;
    }

    if (fragDepth == nearestDepth) {
        frontColor.rgb += color.rgb * color.a * alphaMultiplier;
        frontColor.a = 1.0 - alphaMultiplier * (1.0 - color.a);
    } else {
        backColor += color;
    }
}
`,t.exports.QUAD_VERT_SHADER_SOURCE=`#version 300 es
layout(location=0) in vec4 aPosition;
void main() {
    gl_Position = aPosition;
}`,t.exports.BLEND_BACK_FRAG_SHADER_SOURCE=`#version 300 es
precision highp float;

uniform sampler2D u_back_color;

out vec4 fragColor;
void main() {
    fragColor = texelFetch(u_back_color, ivec2(gl_FragCoord.xy), 0);
    if (fragColor.a == 0.0) { 
        discard;
    }
}
`,t.exports.FINAL_FRAG_SHADER_SOURCE=`#version 300 es
precision highp float;

uniform sampler2D u_front_color;
uniform sampler2D u_back_color;

out vec4 fragColor;
void main() {
    ivec2 fragCoord = ivec2(gl_FragCoord.xy);
    vec4 frontColor = texelFetch(u_front_color, fragCoord, 0);
    vec4 backColor = texelFetch(u_back_color, fragCoord, 0);
    float alphaMultiplier = 1.0 - frontColor.a;

    fragColor = vec4(
        frontColor.rgb + alphaMultiplier * backColor.rgb,
        frontColor.a + backColor.a
    );
}`,t.exports.BORDER_VERT_SHADER_SOURCE=`#version 300 es
precision highp float;

layout(location=0) in vec2 a_position;
uniform mat4 u_proj;
uniform vec2 u_map;
void main() {
    vec4 world_pos = vec4(a_position * u_map, 0.0, 1.0);
    gl_Position = u_proj * world_pos;
}
`,t.exports.BORDER_FRAG_SHADER_SOURCE=`#version 300 es
precision highp float;

uniform vec4 u_color;
out vec4 color;
void main() {
    color = u_color;
}
`},{}],27:[function(e,t){t.exports=class{constructor(){this.setBuffer(),this.quality=0}setBuffer(e){e||(self.SharedArrayBuffer?e=new SharedArrayBuffer(100):e=new ArrayBuffer(100)),this.sharedBuffer=e,this.buffer=new Int32Array(this.sharedBuffer)}get resolution(){return[1,.9,.8,.7,.6,.5][this.quality]||1}get spectate(){return Atomics.load(this.buffer,0)}set spectate(e){Atomics.store(this.buffer,0,e)}get splits(){return Atomics.load(this.buffer,1)}set splits(e){Atomics.add(this.buffer,1,e)}get ejects(){return Atomics.load(this.buffer,2)}set ejects(e){Atomics.add(this.buffer,2,e)}get macro(){return Atomics.load(this.buffer,3)}set macro(e){Atomics.store(this.buffer,3,e)}get respawn(){return Atomics.load(this.buffer,4)}set respawn(e){Atomics.store(this.buffer,4,e)}get visible(){return Atomics.load(this.buffer,5)}set visible(e){Atomics.store(this.buffer,5,e)}get lineLock(){return Atomics.load(this.buffer,6)}set lineLock(e){Atomics.store(this.buffer,6,e)}get skin(){return Atomics.load(this.buffer,7)}set skin(e){Atomics.store(this.buffer,7,e)}get name(){return Atomics.load(this.buffer,8)}set name(e){Atomics.store(this.buffer,8,e)}get mass(){return Atomics.load(this.buffer,9)}set mass(e){Atomics.store(this.buffer,9,e)}get draw(){return Atomics.load(this.buffer,10)}set draw(e){Atomics.store(this.buffer,10,e)}get zoom(){return Atomics.load(this.buffer,11)}set zoom(e){Atomics.store(this.buffer,11,e)}get auto_respawn(){return Atomics.load(this.buffer,12)}set auto_respawn(e){Atomics.store(this.buffer,12,e)}get clip(){return Atomics.load(this.buffer,13)}set clip(e){Atomics.store(this.buffer,13,e)}get skin_quality(){return Atomics.load(this.buffer,14)}set skin_quality(e){Atomics.store(this.buffer,14,e)}get text_quality(){return Atomics.load(this.buffer,15)}set text_quality(e){Atomics.store(this.buffer,15,e)}get circle_quality(){return Atomics.load(this.buffer,16)}set circle_quality(e){Atomics.store(this.buffer,16,e)}get circle_radius(){return[1024,512,256,128][this.circle_quality]}get skin_dim(){return[1024,512,256,128][this.skin_quality]}get ignore_skin(){return Atomics.load(this.buffer,17)}set ignore_skin(e){Atomics.store(this.buffer,17,e)}exchange(){return{spectate:Atomics.exchange(this.buffer,0,0),splits:Atomics.exchange(this.buffer,1,0),ejects:Atomics.exchange(this.buffer,2,0),macro:this.macro,respawn:Atomics.exchange(this.buffer,4,0),lineLock:Atomics.exchange(this.buffer,6,0),clip:Atomics.exchange(this.buffer,13,0)}}}},{}],28:[function(e,t){t.exports=class{constructor(){this.setBuffer()}setBuffer(e){e||(self.SharedArrayBuffer?e=new SharedArrayBuffer(32):e=new ArrayBuffer(32)),this.sharedBuffer=e,this.buffer=new Int32Array(this.sharedBuffer)}get fps(){return Atomics.load(this.buffer,0)}set fps(e){Atomics.store(this.buffer,0,e)}get ping(){return Atomics.load(this.buffer,1)}set ping(e){Atomics.store(this.buffer,1,e)}get cells(){return Atomics.load(this.buffer,2)}set cells(e){Atomics.store(this.buffer,2,e)}get text(){return Atomics.load(this.buffer,3)}set text(e){Atomics.store(this.buffer,3,e)}get bandwidth(){return Atomics.load(this.buffer,4)}set bandwidth(e){Atomics.store(this.buffer,4,e)}get mycells(){return Atomics.load(this.buffer,5)}set mycells(e){Atomics.store(this.buffer,5,e)}get linelocked(){return Atomics.load(this.buffer,6)}set linelocked(e){Atomics.store(this.buffer,6,e)}get score(){return Atomics.load(this.buffer,7)}set score(e){Atomics.store(this.buffer,7,e)}reset(){this.buffer.fill(0)}}},{}],29:[function(e,t){class a{constructor(e,t="",a=!1){this.store=e,this.persist=a,this.key=t,this.tex=null,this.dim=[0,0],this.ref=1}incre(){this.persist||this.ref++}decre(){if(!this.persist)return this.ref--,!!(0>=this.ref)&&this.destroy()}destroy(){return!this.persist&&!!this.tex&&(this.store.gl.deleteTexture(this.tex),this.tex=null,!0)}}t.exports=class{constructor(e){this.renderer=e,this.textures=new Map}get gl(){return this.renderer.gl}add(e="",t=!1){return e?this.textures.has(e)?(this.textures.get(e).incre(),!1):(this.textures.set(e,new a(this,e,t)),!0):void 0}get(e=""){return this.textures.get(e)}setData(e="",t){if(t){const a=this.get(e);if(a){const e=this.gl;e.bindTexture(e.TEXTURE_2D,a.tex=e.createTexture()),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!0),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t),e.generateMipmap(e.TEXTURE_2D),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR_MIPMAP_LINEAR),a.dim=[t.width,t.height]}else console.warn(`Trying to call store.setData on none-existing key: "${e}"`);t.close()}}replace(e="",t=""){if(e!=t)return this.textures.has(e)&&this.textures.get(e).decre()&&this.textures.delete(e),this.add(t)}clear(){for(const[e,t]of[...this.textures.entries()])t.persist||(t.destroy(),this.textures.delete(e))}}},{}],30:[function(e,t){t.exports.pick=e=>e[~~(Math.random()*e.length)],t.exports.makeProgram=(e,t,a)=>{const r=e.createShader(e.VERTEX_SHADER),s=e.createShader(e.FRAGMENT_SHADER);e.shaderSource(r,t),e.shaderSource(s,a),e.compileShader(r),e.compileShader(s);const n=e.createProgram();if(e.attachShader(n,r),e.attachShader(n,s),e.linkProgram(n),!e.getProgramParameter(n,e.LINK_STATUS))throw console.error(`vs info-log: ${e.getShaderInfoLog(r)}\n`+`info-log: ${e.getShaderInfoLog(s)}`),new Error(`prog link failed: ${e.getProgramInfoLog(n)}`);return n};const a=[[255,0,0],[255,128,0],[255,255,0],[128,255,0],[0,255,0],[0,255,128],[0,255,255],[0,128,255],[127,0,255],[255,0,255],[255,0,127]].map(e=>e.map(e=>e/255));t.exports.getColor=e=>a[e%a.length]},{}],31:[function(e,t){t.exports=class{constructor(){this.setBuffer()}setBuffer(e){e||(self.SharedArrayBuffer?e=new SharedArrayBuffer(8):e=new ArrayBuffer(8)),this.sharedBuffer=e,this.buffer=new Int32Array(this.sharedBuffer)}get width(){return Atomics.load(this.buffer,0)}set width(e){Atomics.store(this.buffer,0,e)}get height(){return Atomics.load(this.buffer,1)}set height(e){Atomics.store(this.buffer,1,e)}}},{}],32:[function(e,t){t.exports=class{constructor(e){this.renderer=e}async load(e=1024){if(this.loading||this.instance)return!1;this.loading=!0;const t=await fetch("/static/wasm/client.wasm"),a=new WebAssembly.Memory({initial:e,maximum:e});return this.instance=await WebAssembly.instantiate(await WebAssembly.compile(await t.arrayBuffer()),{env:{memory:a,debug:()=>{console.log(this.renderer.cellTypesTable.slice(251))}}}),this.buffer=a.buffer,this.HEAPU8=new Uint8Array(a.buffer),this.HEAPU16=new Uint16Array(a.buffer),this.HEAPF32=new Float32Array(a.buffer),this.HEAPU32=new Uint32Array(a.buffer),this.loading=!1,!0}}},{}]},{},[24]);