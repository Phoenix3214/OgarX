(function(){function b(d,e,g){function a(j,i){if(!e[j]){if(!d[j]){var f="function"==typeof require&&require;if(!i&&f)return f(j,!0);if(h)return h(j,!0);var c=new Error("Cannot find module '"+j+"'");throw c.code="MODULE_NOT_FOUND",c}var k=e[j]={exports:{}};d[j][0].call(k.exports,function(b){var c=d[j][1][b];return a(c||b)},k,k.exports,b,d,e,g)}return e[j].exports}for(var h="function"==typeof require&&require,c=0;c<g.length;c++)a(g[c]);return a}return b})()({1:[function(a,h,i){(function(j){(function(){(function(c,a){"function"==typeof define&&define.amd?define([],a):"undefined"==typeof i?(a(),c.FileSaver={exports:{}}.exports):a()})(this,function(){"use strict";function k(c,a){return"undefined"==typeof a?a={autoBom:!1}:"object"!=typeof a&&(console.warn("Deprecated: Expected third argument to be a object"),a={autoBom:!a}),a.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(c.type)?new Blob(["\uFEFF",c],{type:c.type}):c}function n(e,f,b){var c=new XMLHttpRequest;c.open("GET",e),c.responseType="blob",c.onload=function(){a(c.response,f,b)},c.onerror=function(){console.error("could not download file")},c.send()}function c(c){var a=new XMLHttpRequest;a.open("HEAD",c,!1);try{a.send()}catch(b){}return 200<=a.status&&299>=a.status}function d(d){try{d.dispatchEvent(new MouseEvent("click"))}catch(b){var a=document.createEvent("MouseEvents");a.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),d.dispatchEvent(a)}}var o="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof j&&j.global===j?j:void 0,f=o.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),a=o.saveAs||("object"!=typeof window||window!==o?function(){}:"download"in HTMLAnchorElement.prototype&&!f?function(a,b,e){var f=o.URL||o.webkitURL,h=document.createElement("a");b=b||a.name||"download",h.download=b,h.rel="noopener","string"==typeof a?(h.href=a,h.origin===location.origin?d(h):c(h.href)?n(a,b,e):d(h,h.target="_blank")):(h.href=f.createObjectURL(a),setTimeout(function(){f.revokeObjectURL(h.href)},4E4),setTimeout(function(){d(h)},0))}:"msSaveOrOpenBlob"in navigator?function(a,b,e){if(b=b||a.name||"download","string"!=typeof a)navigator.msSaveOrOpenBlob(k(a,e),b);else if(c(a))n(a,b,e);else{var f=document.createElement("a");f.href=a,f.target="_blank",setTimeout(function(){d(f)})}}:function(a,b,c,d){if(d=d||open("","_blank"),d&&(d.document.title=d.document.body.innerText="downloading..."),"string"==typeof a)return n(a,b,c);var e="application/octet-stream"===a.type,h=/constructor/i.test(o.HTMLElement)||o.safari,i=/CriOS\/[\d]+/.test(navigator.userAgent);if((i||e&&h||f)&&"undefined"!=typeof FileReader){var j=new FileReader;j.onloadend=function(){var b=j.result;b=i?b:b.replace(/^data:[^;]*;/,"data:attachment/file;"),d?d.location.href=b:location=b,d=null},j.readAsDataURL(a)}else{var k=o.URL||o.webkitURL,l=k.createObjectURL(a);d?d.location=l:location.href=l,d=null,setTimeout(function(){k.revokeObjectURL(l)},4E4)}});o.saveAs=a.saveAs=a,"undefined"!=typeof h&&(h.exports=a)})}).call(this)}).call(this,"undefined"==typeof global?"undefined"==typeof self?"undefined"==typeof window?{}:window:self:global)},{}],2:[function(require,module,exports){var _Mathceil=Math.ceil,_Mathround=Math.round;const{COLORS}=require("./util"),Stats=require("./stats"),Mouse=require("./mouse"),State=require("./state"),Input=require("./input"),Skins=require("./skins"),Options=require("./options"),Minimap=require("./minimap"),Viewport=require("./viewport"),ReplayMenu=require("./replay"),msToText=a=>{if(1e3>a)return`${_Mathround(a)}ms`;const b=a/1e3;if(60>b)return`${_Mathround(b)}s`;const c=b/60;if(60>c)return`${_Mathround(c)}min`;return`${(c/60).toFixed(1)}h`},scoreToText=a=>1e6<a?`${(a/1e6).toFixed(2)}M`:1e3<a?`${(a/1e3).toFixed(1)}K`:_Mathround(a),SVG="http://www.w3.org/2000/svg";module.exports=class{constructor(){if(this.canvas=document.getElementById("canvas"),this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight,this.showing=!0,this.stats=new Stats,this.mouse=new Mouse,this.state=new State,this.viewport=new Viewport,this.server="",this.registerEvents(),this.initUIComponents(),navigator.userAgent.includes("Chrome")){this.worker=new Worker("js/renderer.min.js");const a=this.canvas.transferControlToOffscreen(),b={offscreen:a,stats:this.stats.sharedBuffer,mouse:this.mouse.sharedBuffer,state:this.state.sharedBuffer,viewport:this.viewport.sharedBuffer};this.worker.postMessage(b,[a]),this.worker.onmessage=a=>{const{data:b}=a;"ready"===b.event&&(this.ready=!0),"chat"===b.event&&this.onChat(b.pid,b.player,b.message),"leaderboard"===b.event&&this.onLeaderboard(b.lb),"connect"===b.event&&this.onConnect(b.server),"disconnect"===b.event&&this.onDisconnect(),"minimap"===b.event&&this.minimap.onData(b.minimap),"stats"===b.event&&this.onStats(b.kills,b.score,b.surviveTime),"replay"===b.event&&this.onReplay(b.state),"error"===b.event&&this.onError(b.message||"Unknown Error"),"warning"===b.event&&this.onWarning(b.message||"Unknown Warning")}}else navigator.userAgent.includes("Firefox")&&fetch("js/renderer.min.js").then(a=>a.text()).then(code=>{eval(code),this.renderer=new Renderer(this.canvas),this.renderer.stats=this.stats,this.renderer.mouse=this.mouse,this.renderer.state=this.state,this.renderer.viewport=this.viewport}).then(()=>this.renderer.initEngine())}show(a=this.hudElem){a.classList.add("fade-in"),a.classList.remove("fade-out"),a.hidden=!1,a.focus()}hide(a=this.hudElem){a.classList.remove("fade-in"),a.classList.add("fade-out"),setTimeout(()=>a.hidden=!0,250),a.blur()}toggle(a=this.hudElem){a.hidden?this.show(a):this.hide(a)}resize(){const a=window.devicePixelRatio;this.viewport.width=this.canvas.clientWidth*a;const b=this.state.resolution,c=window.innerWidth/window.innerHeight/(b[0]/b[1]);this.viewport.height=1>c?c*this.canvas.clientHeight*a:this.canvas.clientHeight*a}registerEvents(){window.onresize=this.resize.bind(this),document.addEventListener("contextmenu",a=>a.preventDefault()),this.input=new Input(this),this.options=new Options(this),this.state.visible=!document.hidden,document.addEventListener("visibilitychange",()=>this.state.visible=!document.hidden),window.addEventListener("keydown",a=>this.input.keyDown(a)),window.addEventListener("keyup",a=>this.input.keyUp(a)),window.addEventListener("blur",()=>this.input.blur()),window.addEventListener("focus",()=>this.input.focus()),window.addEventListener("mousedown",a=>this.input.keyDown({key:`MOUSE ${a.button}`})),window.addEventListener("mouseup",a=>this.input.keyUp({key:`MOUSE ${a.button}`})),window.addEventListener("mousemove",a=>{let b=2*a.clientX/window.innerWidth-1,c=2*a.clientY/window.innerHeight-1;const d=this.state.resolution,e=window.innerWidth/window.innerHeight/(d[0]/d[1]);1<e?c/=e:b*=e,this.mouse.x=~~(4096*b),this.mouse.y=~~(4096*c)}),canvas.addEventListener("wheel",a=>{a.ctrlKey||this.mouse.updateScroll(a.deltaY)},{passive:!0})}updateSkin(a=!1){if(!this.skin)return void(this.skinElem.src="/static/img/skin.png");const b=new Image;b.onload=()=>this.skins.current=this.skinElem.src=this.skin,a||(b.onerror=()=>{this.onError(`Failed to load skin "${this.skin}"`),this.skinElem.src="/static/img/skin.png"}),b.src=this.skin}initUIComponents(){this.hudElem=document.getElementById("hud"),this.skinElem=document.getElementById("skin"),this.skinInput=document.getElementById("skin-input"),this.serverInput=document.getElementById("server-input"),this.nameInput=document.getElementById("name-input"),this.replays=new ReplayMenu(this),this.replays.init(),this.minimap=new Minimap(this),this.skins=new Skins(this),this.skinInput.value=this.skins.current,this.skinInput.addEventListener("blur",()=>this.updateSkin()),this.playButton=document.getElementById("play"),this.playButton.addEventListener("click",()=>{this.hide(),this.spawn(),this.playButton.blur()}),this.spectateButton=document.getElementById("spectate"),this.respawnButton=document.getElementById("respawn-button"),this.respawnButton.addEventListener("click",()=>this.state.respawn=1),this.chatElem=document.getElementById("chat"),this.chatInput=document.getElementById("chat-input"),this.chatInput.addEventListener("keydown",a=>{if(a.stopPropagation(),"Enter"==a.key){const a=this.chatInput.value.trim();a&&(this.sendChat(a),this.chatInput.value=""),this.hide(this.chatInput),this.canvas.focus()}}),this.chatElem.addEventListener("focus",()=>{this.chatElem.blur(),this.canvas.focus()}),this.chatElem.addEventListener("wheel",a=>a.stopPropagation(),{passive:!0}),this.serverInput.value="Select Server",this.nameInput.value=localStorage.getItem("ogarx-name")||"",this.nameInput.autocomplete=Math.random(),this.skinInput.autocomplete=Math.random(),this.serverTab=UIkit.offcanvas("#server-menu-offcanvas"),this.updateSkin(!0),this.chatInput.addEventListener("blur",()=>this.hide(this.chatInput)),this.lbElem=document.getElementById("leaderboard-data");const a=[...document.querySelectorAll("[gateway]").values()].map(a=>({list:a,gateway:a.getAttribute("gateway")}));/^https?\:\/\/localhost$/.test(window.origin)&&(a.push({list:document.querySelector("[region='Dev']"),gateway:"localhost:6969"}),window.hud=this);const b=new Map,c=new PerformanceObserver(a=>{for(const c of a.getEntries()){if("fetch"!=c.initiatorType)return;const a=b.get(c.name);if(!a)return;const d=~~c.duration,{signal:e}=a;e.setAttribute("uk-tooltip",`${d} ms`),e.className=100>d?"signal-good":200>d?"signal-ok":300>d?"signal-bad":"signal-worse"}});c.observe({type:"resource",buffered:!0});for(const{list:c,gateway:d}of a){const a=new Map,e=new Map,f=c.getAttribute("region"),g=new EventSource(`${window.location.protocol}//${d}/gateway`);let h;const i=async(a="",b=5e3)=>{try{await fetch(`${window.location.protocol}//${a}/ping`)}catch(a){}h=setTimeout(i,b,a)},j=document.getElementById(`${f.toLowerCase()}-server-stats`),k=j.previousElementSibling;g.onopen=()=>{h||(b.set(`${window.location.protocol}//${d}/ping`,{signal:document.getElementById(`signal-${f.toLowerCase()}`)}),i(d,1e3))},g.addEventListener("servers",b=>{const h={servers:JSON.parse(b.data)};let i=0;const l=~~(100*Math.random());for(const k in h.servers){const m=h.servers[k];let n=a.get(m.uid);const[o,p,g]=COLORS[(5*k+l)%COLORS.length],b=`rgb(${o}, ${p}, ${g})`;n?(n.children[0].textContent=m.name,n.children[1].setAttribute("uk-tooltip",`${m.bot} bots`),n.children[1].textContent=`${m.players}/${m.total}`):(n=document.createElement("p"),n.classList.add("servers"),n.innerHTML=`<span>${m.name}</span><span style="float: right" uk-tooltip="${m.bot} bots">${m.players}/${m.total}</span>`,n.style.borderRight=`2px solid ${b}`,c.appendChild(n),a.set(m.uid,n),n.addEventListener("click",()=>{this.server=`${f} ${m.name}`,this.connect(`${d.replace(/\:\d+$/,"")}:${m.endpoint}`)}));const q=100*m.load;let r=e.get(m.uid);r||(r=document.createElementNS(SVG,"circle"),r.setAttribute("cx","21"),r.setAttribute("cy","21"),r.setAttribute("r","15.91549430918954"),r.setAttribute("fill","transparent"),r.setAttribute("stroke-width",(8-~~k/100).toString()),r.setAttribute("stroke",b),r.setAttribute("stroke-dashoffset","25"),j.prepend(r),e.set(m.uid,r)),i=Math.min(100,i+q),r.setAttribute("stroke-dasharray",`${_Mathceil(i)} ${100-_Mathceil(i)}`)}k.textContent=~~i+"%";for(const[c,d]of[...a.entries()])h.servers.some(a=>a.uid==c)||(a.delete(c),e.get(c).remove(),e.delete(c),d.remove())})}document.querySelector("[server=\"local\"]").addEventListener("click",()=>this.connectToLocal()),this.gameoverElem=document.getElementById("game-over"),this.respawnSpinner=document.getElementById("respawn-spinner"),this.pingElem=document.getElementById("ping"),this.fpsElem=document.getElementById("fps"),this.bwElem=document.getElementById("bandwidth"),this.renderCellElem=document.getElementById("cells"),this.mycellsElem=document.getElementById("mycells"),this.linelockElem=document.getElementById("linelock"),this.scoreElem=document.getElementById("score"),this.updateInterval=setInterval(()=>{this.pingElem.innerText=this.stats.ping,this.fpsElem.innerText=this.stats.fps;const a=this.stats.bandwidth/1024;this.bwElem.innerText=1024>a?`${~~a}KBs`:`${(a/1024).toFixed(1)}MBs`,this.renderCellElem.innerText=this.stats.cells;const b=this.mycellsElem.innerText=this.stats.mycells;this.linelockElem.innerText=this.stats.linelocked?"LOCKED":"UNLOCKED",this.stats.linelocked?this.linelockElem.classList.add("text-danger"):this.linelockElem.classList.remove("text-danger"),this.scoreElem.innerText=scoreToText(this.stats.score),b&&!this.gameoverElem.hidden&&this.hide(this.gameoverElem)},50)}replay(a=0){this.hide(),this.worker&&this.worker.postMessage({replay:a})}sendChat(a){this.worker&&this.worker.postMessage({chat:a})}onChat(a,b,c){const d=document.createElement("p");d.textContent=a?`${b.name||"Unnamed"}: ${c}`:c,d.classList.add(`player-${a}`),this.chatElem.appendChild(d),this.chatElem.scrollTo(0,this.chatElem.scrollHeight)}onReplay(a){"starting"===a?this.onWarning("Saving Clip..."):"failed"===a?this.onError("Failed to Save Clip"):"success"===a?this.onSuccess("Clip Saved!"):void 0}onLeaderboard(a){const{players:b,rank:c,me:d}=a;for(const d in this.lbElem.innerHTML="",b){const a=document.createElement("p");a.textContent=`${~~d+1}. ${b[d]?b[d].name:""}`,d==c&&a.classList.add("me"),this.lbElem.appendChild(a)}if(!b[c]&&65535!=c){const a=document.createElement("p");a.textContent=`${c+1}. ${d.name||""}`,a.classList.add("me"),this.lbElem.appendChild(a)}}get skin(){return this.skinInput.value}get name(){return this.nameInput.value}connect(a){a=a.trim(),"local"==a?this.connectToLocal():this.connectToURL(`${window.location.protocol.replace("http","ws")}//${a}`)}onSuccess(a){UIkit.notification({message:a,status:"success",timeout:3e3})}onWarning(a){UIkit.notification({message:a,status:"warning",timeout:3e3})}onError(a){UIkit.notification({message:a,status:"danger",timeout:3e3})}onStats(b,c,d){document.getElementById("kills").innerText=b,document.getElementById("max-score").innerText=scoreToText(c),document.getElementById("survive-time").innerText=msToText(d),this.show(this.gameoverElem);const e=this.state.auto_respawn;e?(this.respawnSpinner.hidden=!1,this.respawnButton.setAttribute("disabled",""),this.respawnButton.innerText="Respawning"):(this.respawnSpinner.hidden=!0,this.respawnButton.removeAttribute("disabled"),this.respawnButton.innerText="Respawn")}showStats(){this.show(document.getElementById("stats1")),this.show(document.getElementById("stats2")),this.show(document.getElementById("stats3"))}hideStats(){this.hide(document.getElementById("stats1")),this.hide(document.getElementById("stats2")),this.hide(document.getElementById("stats3"))}onConnect(a="Server"){this.resize(),this.serverInput.value=this.server,this.show(this.playButton),this.show(this.spectateButton),this.chatElem.innerHTML="",this.onChat(0,null,"Connected"),this.showStats(),this.show(document.getElementById("leaderboard")),document.getElementById("server-name").innerText=a,this.serverTab.hide()}onDisconnect(){this.lbElem.innerHTML="",this.chatElem.innerHTML="",this.hide(this.playButton),this.hide(this.spectateButton),this.show(),this.onError("Disconnected"),this.hide(this.gameoverElem),this.hideStats(),this.hide(document.getElementById("leaderboard")),this.minimap.clear(),document.getElementById("server-name").innerText="",this.serverTab.show()}spawn(){const a=this.name,b=this.skin;if(localStorage.setItem("ogarx-name",a),this.worker)this.worker.postMessage({spawn:!0,name:a,skin:b});else{const c=this.renderer.protocol;c.once("open",()=>c.spawn(a,b))}}connectToLocal(){if(this.sw=new SharedWorker("js/sw.min.js","ogar-x-server"),this.worker)this.worker.postMessage({connect:this.sw.port,name:this.name,skin:this.skin},[this.sw.port]);else{const a=this.renderer.protocol;a.connect(sw.port,this.name,this.skin)}}connectToURL(a){this.worker?this.worker.postMessage({connect:a,name:this.name,skin:this.skin}):this.renderer.protocol.connect(a,this.name,this.skin)}}},{"./input":3,"./minimap":5,"./mouse":6,"./options":7,"./replay":9,"./skins":10,"./state":11,"./stats":12,"./util":13,"./viewport":14}],3:[function(a,b){const c=["Feed","Split","Double Split","Triple Split","Quad Split","Line Lock","Respawn","Clip"],d=["w"," ","g","z","q","f","n","r"],e={" ":"SPACE"};b.exports=class{constructor(a){this.hud=a;try{let a=JSON.parse(localStorage.getItem("ogarx-keys"));if(!Array.isArray(a)||!a.every(a=>"string"==typeof a))throw new Error("Error parsing keybinds, resetting");a.length>c.length?a=a.slice(0,c.length):a.length<c.length&&(a=a.concat(d.slice(a.length))),this.keys=a}catch(a){console.error(a),this.keys=d.concat([])}this.menuElem=document.getElementById("key-menu"),this.pressing=new Set,this.updateKeys(),this.save()}save(){localStorage.setItem("ogarx-keys",JSON.stringify(this.keys))}updateKeys(){const a=document.getElementById("keys");for(const d in a.innerHTML="",this.labels=[],c){const f=document.createElement("span"),g=this.keys[d].toUpperCase();f.textContent=`${c[d]}`;const h=document.createElement("b");h.innerText=(e[g]||g).toUpperCase(),h.classList.add("selectable"),a.appendChild(f),a.appendChild(h),this.labels.push(h),h.addEventListener("mouseenter",()=>{this.hovered=h}),h.addEventListener("mouseleave",()=>{this.hovered=null}),h.addEventListener("click",a=>{this.setKey(h,`MOUSE ${a.button}`),a.preventDefault(),a.stopPropagation()})}}setKey(a=this.hovered,b=""){const c=this.labels.indexOf(a);a.innerText=(e[b]||b).toUpperCase(),this.keys[c]=b,this.save()}keyDown(a){if(!a.ctrlKey&&("Tab"==a.key&&a.preventDefault(),"Escape"==a.key&&this.hud.toggle(),"Enter"==a.key&&this.hud.toggle(this.hud.chatInput),!this.pressing.has(a.key))){this.pressing.add(a.key);const b=a.key;this.hovered&&this.setKey(this.hovered,b);const d=c[this.keys.indexOf(b)];if(d){const a=this.hud.state;"Feed"===d?a.macro=1:"Split"===d?a.splits=1:"Double Split"===d?a.splits=2:"Triple Split"===d?a.splits=3:"Quad Split"===d?a.splits=4:"Line Lock"===d?a.lineLock=1:"Respawn"===d?a.respawn=1:"Clip"===d?a.clip=1:void 0}}}keyUp(a){if(a.ctrlKey)return;this.pressing.delete(a.key);const b=a.key,d=c[this.keys.indexOf(b)];if(d){const a=this.hud.state;"Feed"===d?a.macro=0:void 0}}blur(){}focus(){for(const a of this.pressing)this.keyUp(a);this.pressing.clear()}}},{}],4:[function(a){const b=a("./hud");window.onload=()=>window.app=new b},{"./hud":2}],5:[function(a,b){const c="http://www.w3.org/2000/svg",d=25;b.exports=class{constructor(a,b=512){this.hud=a,this.dim=b,this.circles=document.getElementById("minimap").firstElementChild,this.texts=document.getElementById("minimap").lastElementChild,this.circles.setAttribute("viewBox",`${-d} ${-d} ${b+d} ${b+d}`),this.texts.setAttribute("viewBox",`${-d} ${-d} ${b+d} ${b+d}`),this.nodes=new Map}onData(a){for(const[b,[c,d]]of[...this.nodes.entries()])a.some(a=>a.id==b)||(c.remove(),d.remove(),this.nodes.delete(b));for(const b of a){let a=this.nodes.get(b.id),e=a&&a[0],f=a&&a[1];a||(e=document.createElementNS(c,"circle"),e.classList.add("minimap-node"),f=document.createElementNS(c,"text"),f.classList.add("minimap-text"),f.setAttribute("fill","#eee"),this.circles.appendChild(e),this.texts.appendChild(f),this.nodes.set(b.id,[e,f]));f.textContent=b.name,f.setAttribute("x",b.x*this.dim),f.setAttribute("y",(1-b.y)*this.dim-d),e.setAttribute("fill",b.me?"#93a7e1":"#eee"),e.setAttribute("r",2*Math.max(Math.log2(b.score)/2,3)),e.setAttribute("cx",b.x*this.dim),e.setAttribute("cy",(1-b.y)*this.dim)}}clear(){this.onData([])}}},{}],6:[function(a,b){b.exports=class{constructor(){this.setBuffer()}setBuffer(a){a||(self.SharedArrayBuffer?a=new SharedArrayBuffer(12):a=new ArrayBuffer(12)),this.sharedBuffer=a,this.buffer=new Int32Array(this.sharedBuffer)}get x(){return Atomics.load(this.buffer,0)}set x(a){Atomics.store(this.buffer,0,a)}get y(){return Atomics.load(this.buffer,1)}set y(a){Atomics.store(this.buffer,1,a)}get scroll(){return Atomics.load(this.buffer,2)}set scroll(a){Atomics.store(this.buffer,2,a)}updateScroll(a){Atomics.add(this.buffer,2,a)}resetScroll(){return Atomics.exchange(this.buffer,2,0)}}},{}],7:[function(a,b){const c={zoom:3,skin:1,name:1,mass:1,draw:120,quality:0,auto_respawn:0,skin_quality:1,text_quality:1,circle_quality:1,ignore_skin:0,mouse_sync:0},d=Object.keys(c),e={skin:["Disabled","Enabled"],name:["Disabled","Enabled"],mass:["Disabled","Short","Long"],quality:["1080p","720p","480p"],auto_respawn:["Disabled","Enabled"],skin_quality:["High","Medium","Low","Laptop"],text_quality:["High","Medium","Low","Laptop"],circle_quality:["High","Medium","Low","Laptop"],ignore_skin:["Disabled","Enabled"]};b.exports=class{constructor(a){this.hud=a;try{const a=JSON.parse(localStorage.getItem("ogarx-options"));for(const b of d)"number"!=typeof a[b]&&(a[b]=c[b]);Object.assign(this.hud.state,a)}catch(a){Object.assign(this.hud.state,c)}for(const b in e){const a=document.getElementById(`render-${b}`);a.addEventListener("click",()=>{const c=this.hud.state[b]=(this.hud.state[b]+1)%e[b].length;a.innerText=e[b][c],this.save(),"quality"==b&&this.hud.resize()}),a.innerText=e[b][this.hud.state[b]]}const b=document.getElementById("render-delay-input"),f=document.getElementById("render-delay-display"),g=()=>{this.hud.state.draw=~~b.value,f.innerText=b.value,this.save()};b.addEventListener("change",g),b.addEventListener("mousemove",g),b.value=this.hud.state.draw,g()}save(){const a={};for(const b of d)a[b]=this.hud.state[b];localStorage.setItem("ogarx-options",JSON.stringify(a))}}},{}],8:[function(a,b){b.exports=()=>new Promise((a,b)=>{const c=indexedDB.open("ogar69-replay");c.onupgradeneeded=a=>{console.log("Creating replay object store");const b=a.target.result;b.createObjectStore("replay-meta"),b.createObjectStore("replay-data")},c.onsuccess=()=>a(c.result),c.onerror=b})},{}],9:[function(a,b){var c=Math.ceil;const{saveAs:d}=a("file-saver"),e=a("./replay-db"),f=15;b.exports=class{constructor(a){this.hud=a,this.modal=UIkit.modal("#replay-modal"),this.title=document.getElementById("replay-title"),this.elem=document.getElementById("replay-list"),UIkit.util.on("#replay-modal","beforeshow",()=>this.sync()),this.page=0,this.count=null,this.keys=[],this.components=[]}async init(){this.db=await e(),this.registerEvents()}registerEvents(){this.uploadButton=document.getElementById("upload-replay");const a=this.uploadButton.firstElementChild;a.addEventListener("change",async a=>{const b=a.target.files;for(let c=0;c<b.length;c++){const a=b.item(c);try{await this.upload(a),this.hud.onSuccess(`Loaded replay from "${a.name}"`)}catch(b){this.hud.onError(`Failed to load replay from "${a.name}": ${b.message}`)}}await this.sync()}),this.uploadButton.addEventListener("click",()=>a.click()),this.prevButton=document.querySelector("#prev-clip"),this.prevButton.addEventListener("click",()=>this.prevPage()),this.nextButton=document.querySelector("#next-clip"),this.nextButton.addEventListener("click",()=>this.nextPage())}get canGoPrev(){return 0<this.page}get canGoNext(){return this.page<c(this.count/f)-1}get isOverPage(){return this.page>=c(this.count/f)&&0<this.page}updateButtons(){this.canGoPrev?this.prevButton.classList.remove("disabled"):this.prevButton.classList.add("disabled"),this.canGoNext?this.nextButton.classList.remove("disabled"):this.nextButton.classList.add("disabled")}prevPage(){if(this.canGoPrev)return this.page--,this.sync(!0)}nextPage(){if(this.canGoNext)return this.page++,this.sync(!0)}async upload(a){var b=String.fromCharCode;if("image/gif"!=a.type)throw new Error("Invalid File Type");const c=await a.arrayBuffer(),d=new DataView(c),e=d.getUint32(c.byteLength-4,!0),f=c.byteLength-e-4;if(f>c.byteLength)throw new Error("Unexpected Bytes");if(";"!==b(d.getUint8(f-1)))throw new Error("Unexpected Bytes");await new Promise((a,b)=>{const d=Date.now(),e=c.byteLength,g=new Blob([c.slice(0,f)],{type:"image/gif"}),h=c.slice(f,c.byteLength-4),i=this.db.transaction(["replay-meta","replay-data"],"readwrite"),j=i.objectStore("replay-meta"),k=i.objectStore("replay-data");j.add({size:e,thumbnail:g},d),k.add(h,d),i.oncomplete=a,i.onerror=b})}async sync(a=!1){const b=await this.countReplays();if(a||this.count!==b){if(this.count=b,this.isOverPage)return await this.prevPage();await this.update()}this.updateButtons()}async update(){if(!this.count)this.title.textContent="Clips (empty)",this.components.forEach(a=>a.remove()),this.components=[];else{this.title.textContent="Clips",this.keys=await this.getAllKeys();const a=this.keys.slice(this.page*f,(this.page+1)*f);this.components=this.components.filter(b=>!!a.some(a=>b.getAttribute("replay-id")==a)||(b.remove(),!1));for(const b of a)if(!this.components.some(a=>a.getAttribute("replay-id")==b)){const a=this.createReplayComponent(b),d=this.components.find(a=>~~a.getAttribute("replay-id")<~~b);d?this.elem.insertBefore(a,d):this.elem.appendChild(a),this.components.unshift(a)}}}play(a=0){this.modal.hide(),this.hud.replay(a)}async fetch(a=0,b="image/gif"){const[c,d]=await Promise.all([this.getReplayMeta(a),this.getReplayData(a)]);return new Blob([c.thumbnail,d,new Uint32Array([d.byteLength]).buffer],{type:b})}async delete(a=0){await new Promise((b,c)=>{const d=this.db.transaction(["replay-meta","replay-data"],"readwrite"),e=d.objectStore("replay-meta"),f=d.objectStore("replay-data");e.delete(a),f.delete(a),d.oncomplete=b,d.onerror=c}),this.sync()}async copy(a=0){const b=await this.download(a),c=new ClipboardItem({"image/gif":b});await navigator.clipboard.write([c]),this.hud.onSuccess("Clip copied to clipboard")}getReplayMeta(a=""){return new Promise((b,c)=>{const d=this.db.transaction(["replay-meta"],"readonly").objectStore("replay-meta"),e=d.get(a);e.onsuccess=()=>b(e.result),e.onerror=c})}getReplayData(a=""){return new Promise((b,c)=>{const d=this.db.transaction(["replay-data"],"readonly").objectStore("replay-data"),e=d.get(a);e.onsuccess=()=>b(e.result),e.onerror=c})}getAllKeys(){return new Promise((a,b)=>{const c=this.db.transaction(["replay-meta"],"readonly").objectStore("replay-meta"),d=c.getAllKeys();d.onsuccess=()=>a(d.result.reverse()),d.onerror=b})}countReplays(){return new Promise((a,b)=>{const c=this.db.transaction(["replay-meta"],"readonly").objectStore("replay-meta"),d=c.count();d.onsuccess=()=>a(d.result),d.onerror=b})}createReplayComponent(a=0){const b=document.createElement("div");b.classList.add("replay-item","uk-inline","uk-width-1-5@l","uk-width-1-3@m","uk-width-1-1@s"),b.setAttribute("replay-id",a),this.getReplayMeta(a).then(a=>{const c=new Image;c.classList.add("replay-thumbnail");const d=URL.createObjectURL(a.thumbnail);c.onload=()=>URL.revokeObjectURL(d),c.src=d,b.appendChild(c)});const c=document.createElement("div");c.classList.add("uk-position-center");const e=document.createElement("a"),f=document.createElement("a");f.classList.add("uk-position-small","uk-position-bottom-right","ogarx-icon"),f.setAttribute("uk-icon","icon: trash; ratio: 1.5"),f.setAttribute("uk-tooltip","Delete Clip"),f.addEventListener("click",b=>{b.stopPropagation(),this.delete(a).then(()=>this.hud.onSuccess("Clip Deleted"))});const g=document.createElement("a");g.classList.add("uk-position-small","uk-position-bottom-left","ogarx-icon"),g.setAttribute("uk-icon","icon: download; ratio: 1.5"),g.setAttribute("uk-tooltip","Download Clip"),g.addEventListener("click",b=>{b.stopPropagation(),this.fetch(a).then(b=>d(b,`ogarx-${a}.gif`)).then(()=>this.hud.onSuccess("Downloading Clip"))}),e.classList.add("play-icon","ogarx-icon"),e.setAttribute("uk-icon","icon: play; ratio: 3;"),e.addEventListener("click",()=>this.play(a)),c.appendChild(e);const h=[g,f,c];return h.forEach(a=>a.style.opacity=0),h.forEach(a=>b.appendChild(a)),b.addEventListener("mouseenter",()=>h.forEach(a=>a.style.opacity=1)),b.addEventListener("mouseleave",()=>h.forEach(a=>a.style.opacity=0)),b}}},{"./replay-db":8,"file-saver":1}],10:[function(a,b){var c=Math.min;b.exports=class{constructor(a){this.hud=a;let b;try{if(b=JSON.parse(localStorage.getItem("ogarx-skins")),!Array.isArray(b)||!b.every(a=>"string"==typeof a))throw new Error("Failed to load skin")}catch(a){console.error(a),b=[]}const d=localStorage.getItem("ogarx_skin");d?(localStorage.removeItem("ogarx_skin"),b.push(d)):!b.length&&b.push("");let e=c(~~localStorage.getItem("ogarx-skin-index")||0,b.length-1);for(const c in this.listElem=document.getElementById("skins"),document.getElementById("prev-skin").addEventListener("click",()=>this.prev()),document.getElementById("next-skin").addEventListener("click",()=>this.next()),this.selectedImg=null,this.elems=[],b){const a=document.createElement("div");a.classList.add("skin-item");const d=document.createElement("img");this.initImg(d),a.appendChild(d),d.onerror=()=>d.src="/static/img/skin.png",d.src=b[c],this.listElem.appendChild(a),this.elems.push(d)}this.selectedImg=this.elems[e],this.selectedImg.classList.add("selected"),this.selectedImg.addEventListener("load",()=>this.sync(),{once:!0}),document.getElementById("add-skin").addEventListener("click",()=>this.addSlot()),document.getElementById("delete-skin").addEventListener("click",()=>this.delete()),this.save()}initImg(a){a.onclick=()=>{a.classList.contains("selected")||(this.selectedImg.classList.remove("selected"),a.classList.add("selected"),this.selectedImg=a,this.sync(),this.saveIndex())}}addSlot(){const a=document.createElement("div");a.classList.add("skin-item");const b=document.createElement("img");this.initImg(b),a.appendChild(b),this.listElem.appendChild(a),b.src="/static/img/skin.png",this.elems.push(b),this.save()}delete(){if(1===this.elems.length)return this.selectedImg.src="/static/img/skin.png",this.sync(),void this.save();const a=this.index;this.selectedImg.parentNode.remove(),this.elems.splice(a,1),this.elems[a]?(this.elems[a].click(),this.save()):(this.elems[a-1].click(),this.save())}get index(){return this.elems.indexOf(this.selectedImg)}set current(a){this.current!=a&&(this.selectedImg.src=a,this.save())}get current(){return this.getUrl(this.selectedImg.src)}getUrl(a){return a.endsWith("/static/img/skin.png")?"":a}prev(){1>=this.elems.length||(this.elems[(this.index-1+this.elems.length)%this.elems.length].click(),this.sync(),this.saveIndex())}next(){1>=this.elems.length||(this.elems[(this.index+1)%this.elems.length].click(),this.sync(),this.saveIndex())}sync(){this.hud.skin!=this.current&&(this.hud.skinInput.value=this.current,this.hud.updateSkin())}saveIndex(){localStorage.setItem("ogarx-skin-index",this.index)}save(){this.saveIndex(),localStorage.setItem("ogarx-skins",JSON.stringify(this.elems.map(a=>this.getUrl(a.src))))}}},{}],11:[function(a,b){b.exports=class{constructor(){this.setBuffer()}setBuffer(a){a||(self.SharedArrayBuffer?a=new SharedArrayBuffer(200):a=new ArrayBuffer(200)),this.sharedBuffer=a,this.buffer=new Int32Array(this.sharedBuffer)}get resolution(){return[[1920,1080],[1280,720],[854,480]][this.quality]||[1920,1080]}get spectate(){return Atomics.load(this.buffer,0)}set spectate(a){Atomics.store(this.buffer,0,a)}get splits(){return Atomics.load(this.buffer,1)}set splits(a){Atomics.add(this.buffer,1,a)}get ejects(){return Atomics.load(this.buffer,2)}set ejects(a){Atomics.add(this.buffer,2,a)}get macro(){return Atomics.load(this.buffer,3)}set macro(a){Atomics.store(this.buffer,3,a)}get respawn(){return Atomics.load(this.buffer,4)}set respawn(a){Atomics.store(this.buffer,4,a)}get visible(){return Atomics.load(this.buffer,5)}set visible(a){Atomics.store(this.buffer,5,a)}get lineLock(){return Atomics.load(this.buffer,6)}set lineLock(a){Atomics.store(this.buffer,6,a)}get skin(){return Atomics.load(this.buffer,7)}set skin(a){Atomics.store(this.buffer,7,a)}get name(){return Atomics.load(this.buffer,8)}set name(a){Atomics.store(this.buffer,8,a)}get mass(){return Atomics.load(this.buffer,9)}set mass(a){Atomics.store(this.buffer,9,a)}get draw(){return Atomics.load(this.buffer,10)}set draw(a){Atomics.store(this.buffer,10,a)}get zoom(){return Atomics.load(this.buffer,11)}set zoom(a){Atomics.store(this.buffer,11,a)}get auto_respawn(){return Atomics.load(this.buffer,12)}set auto_respawn(a){Atomics.store(this.buffer,12,a)}get clip(){return Atomics.load(this.buffer,13)}set clip(a){Atomics.store(this.buffer,13,a)}get skin_quality(){return Atomics.load(this.buffer,14)}set skin_quality(a){Atomics.store(this.buffer,14,a)}get text_quality(){return Atomics.load(this.buffer,15)}set text_quality(a){Atomics.store(this.buffer,15,a)}get circle_quality(){return Atomics.load(this.buffer,16)}set circle_quality(a){Atomics.store(this.buffer,16,a)}get circle_radius(){return[1024,512,256,128][this.circle_quality]}get skin_dim(){return[1024,512,256,128][this.skin_quality]}get ignore_skin(){return Atomics.load(this.buffer,17)}set ignore_skin(a){Atomics.store(this.buffer,17,a)}get mouse_sync(){return Atomics.load(this.buffer,18)}set mouse_sync(a){Atomics.store(this.buffer,18,a)}get quality(){return Atomics.load(this.buffer,19)}set quality(a){Atomics.store(this.buffer,19,a)}exchange(){return{spectate:Atomics.exchange(this.buffer,0,0),splits:Atomics.exchange(this.buffer,1,0),ejects:Atomics.exchange(this.buffer,2,0),macro:this.macro,respawn:Atomics.exchange(this.buffer,4,0),lineLock:Atomics.exchange(this.buffer,6,0),clip:Atomics.exchange(this.buffer,13,0)}}}},{}],12:[function(a,b){b.exports=class{constructor(){this.setBuffer()}setBuffer(a){a||(self.SharedArrayBuffer?a=new SharedArrayBuffer(32):a=new ArrayBuffer(32)),this.sharedBuffer=a,this.buffer=new Int32Array(this.sharedBuffer)}get fps(){return Atomics.load(this.buffer,0)}set fps(a){Atomics.store(this.buffer,0,a)}get ping(){return Atomics.load(this.buffer,1)}set ping(a){Atomics.store(this.buffer,1,a)}get cells(){return Atomics.load(this.buffer,2)}set cells(a){Atomics.store(this.buffer,2,a)}get text(){return Atomics.load(this.buffer,3)}set text(a){Atomics.store(this.buffer,3,a)}get bandwidth(){return Atomics.load(this.buffer,4)}set bandwidth(a){Atomics.store(this.buffer,4,a)}get mycells(){return Atomics.load(this.buffer,5)}set mycells(a){Atomics.store(this.buffer,5,a)}get linelocked(){return Atomics.load(this.buffer,6)}set linelocked(a){Atomics.store(this.buffer,6,a)}get score(){return Atomics.load(this.buffer,7)}set score(a){Atomics.store(this.buffer,7,a)}reset(){this.buffer.fill(0)}}},{}],13:[function(a,b){b.exports.pick=a=>a[~~(Math.random()*a.length)],b.exports.makeProgram=(a,b,c)=>{const d=a.createShader(a.VERTEX_SHADER),e=a.createShader(a.FRAGMENT_SHADER);a.shaderSource(d,b),a.shaderSource(e,c),a.compileShader(d),a.compileShader(e);const f=a.createProgram();if(a.attachShader(f,d),a.attachShader(f,e),a.linkProgram(f),!a.getProgramParameter(f,a.LINK_STATUS))throw console.error(`vs info-log: ${a.getShaderInfoLog(d)}\n`+`info-log: ${a.getShaderInfoLog(e)}`),new Error(`prog link failed: ${a.getProgramInfoLog(f)}`);return f},b.exports.COLORS=[[255,0,0],[255,128,0],[255,255,0],[128,255,0],[0,255,0],[0,255,128],[0,255,255],[0,128,255],[127,0,255],[255,0,255],[255,0,127]]},{}],14:[function(a,b){b.exports=class{constructor(){this.setBuffer()}setBuffer(a){a||(self.SharedArrayBuffer?a=new SharedArrayBuffer(8):a=new ArrayBuffer(8)),this.sharedBuffer=a,this.buffer=new Int32Array(this.sharedBuffer)}get width(){return Atomics.load(this.buffer,0)}set width(a){Atomics.store(this.buffer,0,a)}get height(){return Atomics.load(this.buffer,1)}set height(a){Atomics.store(this.buffer,1,a)}}},{}]},{},[4]);